<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>readme – Dario's Learning Journey</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
q { quotes: "“" "”" "‘" "’"; }
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-de84f8d6bb715db06a919283c2d1e787.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-3a5c9839406ebf6b9042eb0df0f87657.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Learning Hub</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../index.html" aria-current="page"> <i class="bi bi-house-fill" role="img">
</i> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-events" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Events</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-events">    
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/Readme.html">
 <span class="dropdown-text">Build 2025: Conference Overview</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK101 Dotnet app modernization/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: BRK101 - .NET App Modernization</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK103 Microsoft Developers Use AI/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: BRK103 - Microsoft Developers Use AI</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK104 Building the Next Generation of Apps with AI and .NET/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: BRK104 - Next Gen Apps with AI &amp; .NET</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK106 Elevating Development with .NET Aspire AI/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: BRK106 - .NET Aspire AI &amp; Cloud</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK114 C# 14 Language Features and Beyond/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: BRK114 - What’s New in C# 14</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK119 Debug Like a Pro - Improve Your Efficiency/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: BRK119 - Debug Like a Pro with Visual Studio &amp; Copilot</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK122 Supercharge Your Git workflow with VS Code/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: BRK122 - ASP.NET Core &amp; Blazor Future</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK123 Build AI Apps with Microsoft Graph Data/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: BRK123 - Build AI Apps with Microsoft Graph</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK127 Unleash developer potential with AI and Dev Box/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: BRK127 - Unleash Developer Potential with AI and Dev Box</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK141 RAG for enterprise agents with Azure AI Search/SUMMARY.html">
 <span class="dropdown-text">Build 2025: BRK141 - RAG for Enterprise Agents with Azure AI Search</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK155 Azure AI Foundry - app and Agent Factory/SUMMARY.html">
 <span class="dropdown-text">Build 2025: BRK155 - Azure AI Foundry: The AI App and Agent Factory</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK163 Create agents for 365 Copilot with 365 Agents SDK/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: BRK163 - Create Agents with M365 Agents SDK</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK165 Building agents for Microsoft 365 Copilot/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: BRK165 - Building Agents for Microsoft 365 Copilot</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK176 agent solutions with Copilot Studio and M365 Agents SDK/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: BRK176 - Multi-Agent Solutions with Copilot Studio and SDK</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK195 Inside Azure innovations with Mark Russinovich/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: BRK195 - Inside Azure Innovations with Mark Russinovich</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK199 Accelerate Modernization/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: BRK199 - Accelerate Modernization at Scale</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK204 Whats new in Microsoft Databases/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: BRK204 - What’s New in Microsoft Databases</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK223 An overview of Windows AI Foundry/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: BRK223 - Windows AI Foundry Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK224 Integrate AI using Windows AI APIs/SUMMARY.html">
 <span class="dropdown-text">Build 2025: BRK224 - Integrate AI using Windows AI APIs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK225 Bring your own model to Windows using Windows ML/SUMMARY.html">
 <span class="dropdown-text">Build 2025: BRK225 - Bring Your Own Model to Windows using Windows ML</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK226 Boost Development Productivity/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: BRK226 - Windows Developer Tools</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK229 Unlock agents for your apps using MCP on Windows/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: BRK229 - Unlock Agentic Interactions with MCP on Windows</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/BRK229 Introducing Copilot Solutions/SUMMARY.html">
 <span class="dropdown-text">Build 2025: BRK229 - Introducing Copilot Solutions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/DEM508 Streamlining Application Testing with .NET Aspire and Playwright/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: DEM508 - .NET Aspire and Playwright Testing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/DEM509 Essential AI Prompts for Developers/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: DEM509 - Essential AI Prompts for Developers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/DEM515 Write better C# code/README.GPT5.html">
 <span class="dropdown-text">Build 2025: DEM515 - Write Better C# Code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/DEM517 Build, Deploy, &amp; Use Your First MCP Server/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: DEM517 - Model Context Protocol</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/DEM518 dotnet run app/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: DEM518 - Direct C# File Execution</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/DEM519 Agent mode for serious developers/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: DEM519 - Agent Mode for Serious Developers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/DEM520 Local AI Development with Foundry Local and .NET Aspire/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: DEM520 - Local AI Development</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/DEM524 Running Large Language Models on your local machine/SUMMARY.html">
 <span class="dropdown-text">Build 2025: DEM524 - Running Large Language Models Locally</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/DEM571 Extending your application with powertoys/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: DEM571 - PowerToys Command Palette Extensions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/DEM581 Transforming Microsoft Learn with AI/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: DEM581 - Transforming Microsoft Learn with AI</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/ODFP957 Sentry and Copilot Integration for AI Debugging/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: ODFP957 - Sentry &amp; Copilot AI Debugging</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../202506 Build 2025/STUDIO14 Agents AI and Azure AI Foundry/README.Sonnet4.html">
 <span class="dropdown-text">Build 2025: STUDIO14 - Agents &amp; Azure AI Foundry</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-culture--travel" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Culture &amp; Travel</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-culture--travel">    
        <li>
    <a class="dropdown-item" href="../Travel/Paris 2025/README.html">
 <span class="dropdown-text">Paris Cultural Journey 2025</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/darioairoldi/Learn"> <i class="bi bi-github" role="img" aria-label="GitHub Repository">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-house-fill" role="img">
</i> 
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true"><i class="bi bi-calendar-event" role="img">
</i> 
 <span class="menu-text">Events</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../202506 Build 2025/Readme.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Build Conference 2025</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/Readme.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conference Overview</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK101: AI-Powered .NET Modernization</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK101 Dotnet app modernization/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK101 Dotnet app modernization/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK103: Microsoft Developers Use AI</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK103 Microsoft Developers Use AI/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK103 Microsoft Developers Use AI/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK104: Building Next Gen Apps with AI &amp; .NET</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK104 Building the Next Generation of Apps with AI and .NET/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK104 Building the Next Generation of Apps with AI and .NET/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK106: .NET Aspire AI &amp; Cloud</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK106 Elevating Development with .NET Aspire AI/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK114: What’s New in C# 14</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK114 C# 14 Language Features and Beyond/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK114 C# 14 Language Features and Beyond/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK119: Debug Like a Pro</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK119 Debug Like a Pro - Improve Your Efficiency/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK119 Debug Like a Pro - Improve Your Efficiency/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK122: ASP.NET Core &amp; Blazor Future</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK122 Supercharge Your Git workflow with VS Code/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK123: Build AI Apps with Microsoft Graph</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK123 Build AI Apps with Microsoft Graph Data/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK123 Build AI Apps with Microsoft Graph Data/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK127: AI and Dev Box Developer Potential</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK127 Unleash developer potential with AI and Dev Box/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK127 Unleash developer potential with AI and Dev Box/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK141: RAG for Enterprise Agents</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK141 RAG for enterprise agents with Azure AI Search/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK155: Azure AI Foundry - App &amp; Agent Factory</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-13" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK155 Azure AI Foundry - app and Agent Factory/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK163: M365 Agents SDK Custom Engine Development</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-14" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK163 Create agents for 365 Copilot with 365 Agents SDK/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK163 Create agents for 365 Copilot with 365 Agents SDK/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-15" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK165: Building Agents for Microsoft 365 Copilot</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-15" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-15" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK165 Building agents for Microsoft 365 Copilot/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK165 Building agents for Microsoft 365 Copilot/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-16" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK176: Multi-Agent Solutions with Copilot Studio</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-16" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-16" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK176 agent solutions with Copilot Studio and M365 Agents SDK/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK176 agent solutions with Copilot Studio and M365 Agents SDK/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-17" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK195: Inside Azure Innovations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-17" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-17" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK195 Inside Azure innovations with Mark Russinovich/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK195 Inside Azure innovations with Mark Russinovich/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-18" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK199: Accelerate Modernization</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-18" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-18" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK199 Accelerate Modernization/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK199 Accelerate Modernization/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-19" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK204: Microsoft Databases</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-19" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-19" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK204 Whats new in Microsoft Databases/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK204 Whats new in Microsoft Databases/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-20" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK223: Windows AI Foundry</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-20" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-20" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK223 An overview of Windows AI Foundry/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK223 An overview of Windows AI Foundry/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-21" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK224: Integrate AI using Windows AI APIs</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-21" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-21" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK224 Integrate AI using Windows AI APIs/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-22" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK225: Windows ML - Bring Your Own Model</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-22" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-22" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK225 Bring your own model to Windows using Windows ML/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-23" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK226: Windows Developer Tools</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-23" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-23" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK226 Boost Development Productivity/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK226 Boost Development Productivity/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-24" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK229: MCP on Windows for Agentic Apps</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-24" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-24" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK229 Unlock agents for your apps using MCP on Windows/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK229 Unlock agents for your apps using MCP on Windows/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-25" role="navigation" aria-expanded="false">
 <span class="menu-text">BRK229: Introducing Copilot Solutions</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-25" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-25" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/BRK229 Introducing Copilot Solutions/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-26" role="navigation" aria-expanded="false">
 <span class="menu-text">DEM508: .NET Aspire Testing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-26" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-26" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/DEM508 Streamlining Application Testing with .NET Aspire and Playwright/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-27" role="navigation" aria-expanded="false">
 <span class="menu-text">DEM509: Essential AI Prompts</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-27" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-27" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/DEM509 Essential AI Prompts for Developers/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/DEM509 Essential AI Prompts for Developers/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-28" role="navigation" aria-expanded="false">
 <span class="menu-text">DEM515: Write Better C#</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-28" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-28" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/DEM515 Write better C# code/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/DEM515 Write better C# code/README.GPT5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-29" role="navigation" aria-expanded="false">
 <span class="menu-text">DEM517: MCP Server</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-29" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-29" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/DEM517 Build, Deploy, &amp; Use Your First MCP Server/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-30" role="navigation" aria-expanded="false">
 <span class="menu-text">DEM518: Direct C# File Execution</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-30" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-30" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/DEM518 dotnet run app/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/DEM518 dotnet run app/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-31" role="navigation" aria-expanded="false">
 <span class="menu-text">DEM519: Agent Mode for Serious Developers</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-31" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-31" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/DEM519 Agent mode for serious developers/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/DEM519 Agent mode for serious developers/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-32" role="navigation" aria-expanded="false">
 <span class="menu-text">DEM520: Local AI Development</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-32" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-32" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/DEM520 Local AI Development with Foundry Local and .NET Aspire/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-33" role="navigation" aria-expanded="false">
 <span class="menu-text">DEM524: Running LLMs Locally</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-33" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-33" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/DEM524 Running Large Language Models on your local machine/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-34" role="navigation" aria-expanded="false">
 <span class="menu-text">DEM571: PowerToys Extensions</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-34" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-34" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/DEM571 Extending your application with powertoys/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/DEM571 Extending your application with powertoys/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-35" role="navigation" aria-expanded="false">
 <span class="menu-text">DEM581: Transforming Microsoft Learn with AI</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-35" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-35" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/DEM581 Transforming Microsoft Learn with AI/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/DEM581 Transforming Microsoft Learn with AI/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-36" role="navigation" aria-expanded="false">
 <span class="menu-text">ODFP957: Sentry &amp; Copilot AI Debugging</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-36" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-36" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/ODFP957 Sentry and Copilot Integration for AI Debugging/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/ODFP957 Sentry and Copilot Integration for AI Debugging/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-37" role="navigation" aria-expanded="false">
 <span class="menu-text">STUDIO14: Agents &amp; Azure AI Foundry</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-37" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-37" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/STUDIO14 Agents AI and Azure AI Foundry/SUMMARY.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../202506 Build 2025/STUDIO14 Agents AI and Azure AI Foundry/README.Sonnet4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Details</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-38" role="navigation" aria-expanded="true"><i class="bi bi-tools" role="img">
</i> 
 <span class="menu-text">Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-38" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-38" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../20250709 Manage GitRepo from commandline/README.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Development Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-39" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-39" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../20250709 Manage GitRepo from commandline/README.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Git Command Line</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../20250711 Use http files for easy and repeatable test/README.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HTTP Files Testing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../20250712 Use QUARTO doc for Github repos doc/README.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto Documentation</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-40" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-40" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../20250712 Use QUARTO doc for Github repos doc/README.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using Quarto</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../20250712 Use QUARTO doc for Github repos doc/001.01. Quarto.yml document structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto.yml document structure</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../20250712 Use QUARTO doc for Github repos doc/003.01. Quarto specific markdown features.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto specific markdown features</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../20250712 Use QUARTO doc for Github repos doc/002.03. Quarto Theming and Styling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto Theming and Styling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../20250712 Use QUARTO doc for Github repos doc/009.00 How does sidebar works.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How does sidebar works</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../20250713 Use http files for easy and repeatable test/README.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HTTP Files (Extended)</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-41" role="navigation" aria-expanded="true"><i class="bi bi-wrench-adjustable" role="img">
</i> 
 <span class="menu-text">Issues &amp; Solutions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-41" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-41" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../_ISSUES/20250709 fatal error cloning a repo with Visual Studio/README.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Development Issues</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-42" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-42" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../_ISSUES/20250709 fatal error cloning a repo with Visual Studio/README.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">VS Clone Error Fix (solved)</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-43" role="navigation" aria-expanded="true"><i class="bi bi-lightning-charge" role="img">
</i> 
 <span class="menu-text">Other Technologies</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-43" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-43" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../20250815 DIY Battery Pack/README.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DIY Li-Ion Battery Packs</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-44" role="navigation" aria-expanded="true"><i class="bi bi-geo-alt" role="img">
</i> 
 <span class="menu-text">Culture &amp; Travel</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-44" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-44" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Travel/Paris 2025/README.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Paris Cultural Journey 2025</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On This Page</h2>
   
  <ul>
  <li><a href="#azure-cosmosdb-access-with-c" id="toc-azure-cosmosdb-access-with-c" class="nav-link active" data-scroll-target="#azure-cosmosdb-access-with-c">Azure CosmosDB Access with C</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#table-of-contents" id="toc-table-of-contents" class="nav-link" data-scroll-target="#table-of-contents">Table of Contents</a></li>
  <li><a href="#available-approaches" id="toc-available-approaches" class="nav-link" data-scroll-target="#available-approaches">Available Approaches</a>
  <ul class="collapse">
  <li><a href="#sql-api-core" id="toc-sql-api-core" class="nav-link" data-scroll-target="#sql-api-core">1. <strong>SQL API (Core)</strong></a></li>
  <li><a href="#mongodb-api" id="toc-mongodb-api" class="nav-link" data-scroll-target="#mongodb-api">2. <strong>MongoDB API</strong></a></li>
  <li><a href="#other-apis" id="toc-other-apis" class="nav-link" data-scroll-target="#other-apis">3. <strong>Other APIs</strong></a></li>
  </ul></li>
  <li><a href="#key-libraries" id="toc-key-libraries" class="nav-link" data-scroll-target="#key-libraries">Key Libraries</a>
  <ul class="collapse">
  <li><a href="#primary-library" id="toc-primary-library" class="nav-link" data-scroll-target="#primary-library">Primary Library</a></li>
  <li><a href="#deprecated-libraries-do-not-use" id="toc-deprecated-libraries-do-not-use" class="nav-link" data-scroll-target="#deprecated-libraries-do-not-use"><strong>Deprecated Libraries ⚠️ (Do Not Use)</strong></a></li>
  <li><a href="#supporting-libraries-optional" id="toc-supporting-libraries-optional" class="nav-link" data-scroll-target="#supporting-libraries-optional">Supporting Libraries (Optional)</a></li>
  </ul></li>
  <li><a href="#basic-operations" id="toc-basic-operations" class="nav-link" data-scroll-target="#basic-operations">Basic Operations</a>
  <ul class="collapse">
  <li><a href="#setting-up-a-cosmos-client" id="toc-setting-up-a-cosmos-client" class="nav-link" data-scroll-target="#setting-up-a-cosmos-client">Setting Up a Cosmos Client</a></li>
  <li><a href="#managing-databases-and-containers" id="toc-managing-databases-and-containers" class="nav-link" data-scroll-target="#managing-databases-and-containers">Managing Databases and Containers</a></li>
  <li><a href="#working-with-items" id="toc-working-with-items" class="nav-link" data-scroll-target="#working-with-items">Working with Items</a></li>
  </ul></li>
  <li><a href="#crud-operations" id="toc-crud-operations" class="nav-link" data-scroll-target="#crud-operations">CRUD Operations</a>
  <ul class="collapse">
  <li><a href="#query-read" id="toc-query-read" class="nav-link" data-scroll-target="#query-read">Query (Read)</a></li>
  <li><a href="#working-with-dynamic-entities" id="toc-working-with-dynamic-entities" class="nav-link" data-scroll-target="#working-with-dynamic-entities">Working with Dynamic Entities</a></li>
  <li><a href="#working-with-raw-json-responses" id="toc-working-with-raw-json-responses" class="nav-link" data-scroll-target="#working-with-raw-json-responses">Working with Raw JSON Responses</a></li>
  <li><a href="#performance-comparison" id="toc-performance-comparison" class="nav-link" data-scroll-target="#performance-comparison">Performance Comparison</a></li>
  <li><a href="#create" id="toc-create" class="nav-link" data-scroll-target="#create">Create</a></li>
  <li><a href="#update" id="toc-update" class="nav-link" data-scroll-target="#update">Update</a></li>
  <li><a href="#delete" id="toc-delete" class="nav-link" data-scroll-target="#delete">Delete</a></li>
  </ul></li>
  <li><a href="#advanced-patterns" id="toc-advanced-patterns" class="nav-link" data-scroll-target="#advanced-patterns">Advanced Patterns</a>
  <ul class="collapse">
  <li><a href="#bulk-operations" id="toc-bulk-operations" class="nav-link" data-scroll-target="#bulk-operations">Bulk Operations</a></li>
  <li><a href="#change-feed-processing" id="toc-change-feed-processing" class="nav-link" data-scroll-target="#change-feed-processing">Change Feed Processing</a></li>
  <li><a href="#server-side-programming" id="toc-server-side-programming" class="nav-link" data-scroll-target="#server-side-programming">Server-Side Programming</a></li>
  <li><a href="#retry-policies" id="toc-retry-policies" class="nav-link" data-scroll-target="#retry-policies">Retry Policies</a></li>
  <li><a href="#dependency-injection-setup" id="toc-dependency-injection-setup" class="nav-link" data-scroll-target="#dependency-injection-setup">Dependency Injection Setup</a></li>
  </ul></li>
  <li><a href="#authentication-approaches" id="toc-authentication-approaches" class="nav-link" data-scroll-target="#authentication-approaches">Authentication Approaches</a>
  <ul class="collapse">
  <li><a href="#primary-key-authentication-connection-string" id="toc-primary-key-authentication-connection-string" class="nav-link" data-scroll-target="#primary-key-authentication-connection-string">1. <strong>Primary Key Authentication (Connection String)</strong></a></li>
  <li><a href="#azure-active-directory-aad-authentication" id="toc-azure-active-directory-aad-authentication" class="nav-link" data-scroll-target="#azure-active-directory-aad-authentication">2. <strong>Azure Active Directory (AAD) Authentication</strong></a></li>
  <li><a href="#resource-token-authentication" id="toc-resource-token-authentication" class="nav-link" data-scroll-target="#resource-token-authentication">3. <strong>Resource Token Authentication</strong></a></li>
  <li><a href="#authentication-comparison" id="toc-authentication-comparison" class="nav-link" data-scroll-target="#authentication-comparison">Authentication Comparison</a></li>
  <li><a href="#best-practices" id="toc-best-practices" class="nav-link" data-scroll-target="#best-practices">Best Practices</a></li>
  </ul></li>
  <li><a href="#migration-from-legacy-sdk" id="toc-migration-from-legacy-sdk" class="nav-link" data-scroll-target="#migration-from-legacy-sdk">Migration from Legacy SDK</a>
  <ul class="collapse">
  <li><a href="#legacy-sdks-overview" id="toc-legacy-sdks-overview" class="nav-link" data-scroll-target="#legacy-sdks-overview">Legacy SDKs Overview</a></li>
  <li><a href="#why-legacy-sdks-were-discontinued" id="toc-why-legacy-sdks-were-discontinued" class="nav-link" data-scroll-target="#why-legacy-sdks-were-discontinued">Why Legacy SDKs Were Discontinued</a></li>
  <li><a href="#comprehensive-library-comparison" id="toc-comprehensive-library-comparison" class="nav-link" data-scroll-target="#comprehensive-library-comparison">Comprehensive Library Comparison</a></li>
  <li><a href="#migration-paths-code-examples" id="toc-migration-paths-code-examples" class="nav-link" data-scroll-target="#migration-paths-code-examples">Migration Paths &amp; Code Examples</a></li>
  <li><a href="#migration-decision-matrix" id="toc-migration-decision-matrix" class="nav-link" data-scroll-target="#migration-decision-matrix">Migration Decision Matrix</a></li>
  <li><a href="#key-migration-considerations" id="toc-key-migration-considerations" class="nav-link" data-scroll-target="#key-migration-considerations">Key Migration Considerations</a></li>
  <li><a href="#migration-benefits" id="toc-migration-benefits" class="nav-link" data-scroll-target="#migration-benefits">Migration Benefits</a></li>
  <li><a href="#support-timeline" id="toc-support-timeline" class="nav-link" data-scroll-target="#support-timeline">Support Timeline</a></li>
  </ul></li>
  <li><a href="#useful-resources" id="toc-useful-resources" class="nav-link" data-scroll-target="#useful-resources">Useful Resources</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/darioairoldi/Learn/edit/main/20250706 CosmosDB Access options/README.md" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/darioairoldi/Learn/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"><h1 class="title display-7"></h1></header><div class="quarto-title-block"><div class="quarto-title-tools-only"><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>




<section id="azure-cosmosdb-access-with-c" class="level1">
<h1>Azure CosmosDB Access with C</h1>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p><strong>Azure Cosmos DB</strong> is a fully managed NoSQL database service that provides <strong>global distribution, elastic scaling, and multi-model support</strong> with comprehensive SLAs for throughput, latency, availability, and consistency. It offers multiple APIs including <strong>SQL (Core)</strong>, <strong>MongoDB</strong>, <strong>Cassandra</strong>, <strong>Gremlin</strong>, and <strong>Table</strong>, making it highly versatile for various application patterns.</p>
</section>
<section id="table-of-contents" class="level2">
<h2 class="anchored" data-anchor-id="table-of-contents">Table of Contents</h2>
<ol type="1">
<li>Overview</li>
<li>Available Approaches
<ul>
<li>SQL API (Core)</li>
<li>MongoDB API</li>
<li>Other APIs</li>
</ul></li>
<li>Key Libraries
<ul>
<li>Primary Library</li>
<li>Supporting Libraries</li>
</ul></li>
<li>Basic Operations
<ul>
<li>Setting Up a Cosmos Client</li>
<li>Managing Databases and Containers</li>
<li>Working with Items</li>
</ul></li>
<li>CRUD Operations
<ul>
<li>Query (Read)</li>
<li>Create</li>
<li>Update</li>
<li>Delete</li>
</ul></li>
<li>Advanced Patterns
<ul>
<li>Bulk Operations</li>
<li>Change Feed Processing</li>
<li>Server-Side Programming</li>
<li>Retry Policies</li>
<li>Dependency Injection Setup</li>
</ul></li>
<li>Authentication Approaches</li>
<li>Migration from Legacy SDK</li>
<li>Useful Resources</li>
<li>Summary</li>
</ol>
</section>
<section id="available-approaches" class="level2">
<h2 class="anchored" data-anchor-id="available-approaches">Available Approaches</h2>
<section id="sql-api-core" class="level3">
<h3 class="anchored" data-anchor-id="sql-api-core">1. <strong>SQL API (Core)</strong></h3>
<ul>
<li><strong>Native JSON document model</strong> with rich <mark>SQL querying</mark> capabilities</li>
<li>Recommended for new applications with flexible schema requirements</li>
<li><strong>Primary C# SDK</strong>: <mark><code>Microsoft.Azure.Cosmos</code></mark></li>
<li>Best performance and feature support</li>
</ul>
</section>
<section id="mongodb-api" class="level3">
<h3 class="anchored" data-anchor-id="mongodb-api">2. <strong>MongoDB API</strong></h3>
<ul>
<li><mark>MongoDB-compatible API</mark> for existing MongoDB applications</li>
<li>Use standard MongoDB drivers and tools</li>
<li>No code changes required for MongoDB applications</li>
<li><strong>C# SDK</strong>: MongoDB .NET Driver</li>
</ul>
</section>
<section id="other-apis" class="level3">
<h3 class="anchored" data-anchor-id="other-apis">3. <strong>Other APIs</strong></h3>
<ul>
<li><strong>Cassandra API</strong>: For existing Cassandra workloads (<mark>CassandraCSharpDriver</mark>)</li>
<li><strong>Gremlin API</strong>: For graph databases (<mark>Gremlin.Net</mark>)</li>
<li><strong>Table API</strong>: For Table Storage compatibility
<ul>
<li><strong>Recommended</strong>: Use unified <mark><code>Microsoft.Azure.Cosmos</code></mark> SDK</li>
<li><strong>Alternative</strong>: <mark><code>Azure.Data.Tables</code></mark> for Azure Table Storage</li>
<li><strong>Deprecated (⚠️)</strong>: <mark><code>Microsoft.Azure.Cosmos.Table</code></mark> (discontinued)</li>
</ul></li>
</ul>
</section>
</section>
<section id="key-libraries" class="level2">
<h2 class="anchored" data-anchor-id="key-libraries">Key Libraries</h2>
<section id="primary-library" class="level3">
<h3 class="anchored" data-anchor-id="primary-library">Primary Library</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- For SQL API (Recommended) --&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">"Microsoft.Azure.Cosmos"</span><span class="ot"> Version=</span><span class="st">"3.37.0"</span> /&gt;</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- For MongoDB API --&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">"MongoDB.Driver"</span><span class="ot"> Version=</span><span class="st">"2.22.0"</span> /&gt;</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- For Table API (if not using unified Cosmos SDK) --&gt;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">"Azure.Data.Tables"</span><span class="ot"> Version=</span><span class="st">"12.8.0"</span> /&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="deprecated-libraries-do-not-use" class="level3">
<h3 class="anchored" data-anchor-id="deprecated-libraries-do-not-use"><strong>Deprecated Libraries ⚠️ (Do Not Use)</strong></h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">DEPRECATED</span><span class="co">: Legacy SQL API SDK --&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- &lt;PackageReference Include="Microsoft.Azure.DocumentDB" Version="2.x.x" /&gt; --&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">DEPRECATED</span><span class="co">: Legacy Table API SDK --&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- &lt;PackageReference Include="Microsoft.Azure.Cosmos.Table" Version="1.x.x" /&gt; --&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">DEPRECATED</span><span class="co">: Original Table Storage SDK --&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- &lt;PackageReference Include="WindowsAzure.Storage" Version="9.x.x" /&gt; --&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="supporting-libraries-optional" class="level3">
<h3 class="anchored" data-anchor-id="supporting-libraries-optional">Supporting Libraries (Optional)</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- For dependency injection --&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">"Microsoft.Extensions.DependencyInjection"</span><span class="ot"> Version=</span><span class="st">"7.0.0"</span> /&gt;</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">"Microsoft.Extensions.Configuration"</span><span class="ot"> Version=</span><span class="st">"7.0.0"</span> /&gt;</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- For managed identity authentication --&gt;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">"Azure.Identity"</span><span class="ot"> Version=</span><span class="st">"1.10.4"</span> /&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="basic-operations" class="level2">
<h2 class="anchored" data-anchor-id="basic-operations">Basic Operations</h2>
<section id="setting-up-a-cosmos-client" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-a-cosmos-client">Setting Up a Cosmos Client</h3>
<p>The <strong>CosmosClient class</strong> is the primary interface for interacting with Azure Cosmos DB SQL API. It provides a thread-safe client that manages connections, handles retries, and implements the Azure Cosmos DB protocol.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/001.01 CosmosClientClass.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="alt text"><img src="images/001.01 CosmosClientClass.png" class="img-fluid figure-img" alt="alt text"></a></p>
<figcaption>alt text</figcaption>
</figure>
</div>
<div class="sourceCode" id="cb4"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span><span class="op">;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Connection using endpoint and key (basic example)</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> endpoint <span class="op">=</span> <span class="st">"https://your-account.documents.azure.com:443/"</span><span class="op">;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> key <span class="op">=</span> <span class="st">"your-primary-key"</span><span class="op">;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> cosmosClient <span class="op">=</span> <span class="kw">new</span> <span class="fu">CosmosClient</span><span class="op">(</span>endpoint<span class="op">,</span> key<span class="op">,</span> <span class="kw">new</span> CosmosClientOptions</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    ConnectionMode <span class="op">=</span> ConnectionMode<span class="op">.</span><span class="fu">Direct</span><span class="op">,</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    SerializerOptions <span class="op">=</span> <span class="kw">new</span> CosmosSerializationOptions</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        PropertyNamingPolicy <span class="op">=</span> CosmosPropertyNamingPolicy<span class="op">.</span><span class="fu">CamelCase</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="key-cosmosclientoptions" class="level4">
<h4 class="anchored" data-anchor-id="key-cosmosclientoptions">Key CosmosClientOptions</h4>
<p>The CosmosClient behavior can be customized with CosmosClientOptions:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> clientOptions <span class="op">=</span> <span class="kw">new</span> CosmosClientOptions</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Performance options</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    ConnectionMode <span class="op">=</span> ConnectionMode<span class="op">.</span><span class="fu">Direct</span><span class="op">,</span> <span class="co">// Direct for better performance</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    ApplicationName <span class="op">=</span> <span class="st">"YourApplication"</span><span class="op">,</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Consistency level</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    ConsistencyLevel <span class="op">=</span> ConsistencyLevel<span class="op">.</span><span class="fu">Session</span><span class="op">,</span> <span class="co">// Default</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Regional preferences</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    ApplicationRegion <span class="op">=</span> <span class="st">"West US 2"</span><span class="op">,</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Serialization</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    SerializerOptions <span class="op">=</span> <span class="kw">new</span> CosmosSerializationOptions</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        PropertyNamingPolicy <span class="op">=</span> CosmosPropertyNamingPolicy<span class="op">.</span><span class="fu">CamelCase</span><span class="op">,</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        IgnoreNullValues <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Resilience</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    MaxRetryAttemptsOnRateLimitedRequests <span class="op">=</span> <span class="dv">9</span><span class="op">,</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    MaxRetryWaitTimeOnRateLimitedRequests <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromSeconds</span><span class="op">(</span><span class="dv">30</span><span class="op">)</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> cosmosClient <span class="op">=</span> <span class="kw">new</span> <span class="fu">CosmosClient</span><span class="op">(</span>endpoint<span class="op">,</span> key<span class="op">,</span> clientOptions<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="managing-databases-and-containers" class="level3">
<h3 class="anchored" data-anchor-id="managing-databases-and-containers">Managing Databases and Containers</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Create or get a database</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>Database database <span class="op">=</span> await cosmosClient<span class="op">.</span><span class="fu">CreateDatabaseIfNotExistsAsync</span><span class="op">(</span><span class="st">"MyDatabase"</span><span class="op">);</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Create container with RU/s provisioning and partition key</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>ContainerProperties containerProperties <span class="op">=</span> <span class="kw">new</span> ContainerProperties</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="st">"MyContainer"</span><span class="op">,</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    PartitionKeyPath <span class="op">=</span> <span class="st">"/partitionKey"</span><span class="op">,</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Optional: configure indexing policy</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    IndexingPolicy <span class="op">=</span> <span class="kw">new</span> IndexingPolicy</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        Automatic <span class="op">=</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        IndexingMode <span class="op">=</span> IndexingMode<span class="op">.</span><span class="fu">Consistent</span><span class="op">,</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        IncludedPaths <span class="op">=</span> <span class="op">{</span> <span class="kw">new</span> IncludedPath <span class="op">{</span> Path <span class="op">=</span> <span class="st">"/*"</span> <span class="op">}</span> <span class="op">},</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        ExcludedPaths <span class="op">=</span> <span class="op">{</span> <span class="kw">new</span> ExcludedPath <span class="op">{</span> Path <span class="op">=</span> <span class="st">"/path/to/exclude/*"</span> <span class="op">}</span> <span class="op">}</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co">// Create with 400 RU/s throughput</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>Container container <span class="op">=</span> await database<span class="op">.</span><span class="fu">CreateContainerIfNotExistsAsync</span><span class="op">(</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    containerProperties<span class="op">,</span> </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    ThroughputProperties<span class="op">.</span><span class="fu">CreateManualThroughput</span><span class="op">(</span><span class="dv">400</span><span class="op">));</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="working-with-items" class="level3">
<h3 class="anchored" data-anchor-id="working-with-items">Working with Items</h3>
<p>In Azure Cosmos DB’s SQL API, you work with <q>items</q> - JSON documents with unique IDs:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Define a model class</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> TodoItem</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">JsonProperty</span><span class="op">(</span><span class="st">"id"</span><span class="op">)]</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> Id <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> Guid<span class="op">.</span><span class="fu">NewGuid</span><span class="op">().</span><span class="fu">ToString</span><span class="op">();</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">JsonProperty</span><span class="op">(</span><span class="st">"partitionKey"</span><span class="op">)]</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> PartitionKey <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> Title <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">bool</span> Completed <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> DateTime CreatedDate <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> DateTime<span class="op">.</span><span class="fu">UtcNow</span><span class="op">;</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Alternative: Using System.Text.Json attributes</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> TodoItemWithSystemTextJson</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">JsonPropertyName</span><span class="op">(</span><span class="st">"id"</span><span class="op">)]</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> Id <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> Guid<span class="op">.</span><span class="fu">NewGuid</span><span class="op">().</span><span class="fu">ToString</span><span class="op">();</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">JsonPropertyName</span><span class="op">(</span><span class="st">"partitionKey"</span><span class="op">)]</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> PartitionKey <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> Title <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">bool</span> Completed <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> DateTime CreatedDate <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> DateTime<span class="op">.</span><span class="fu">UtcNow</span><span class="op">;</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="crud-operations" class="level2">
<h2 class="anchored" data-anchor-id="crud-operations">CRUD Operations</h2>
<section id="query-read" class="level3">
<h3 class="anchored" data-anchor-id="query-read">Query (Read)</h3>
<p>CosmosDB SQL API provides a rich SQL-like query language for JSON documents. You can query using strongly-typed entities, dynamic objects, or raw JSON responses:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Point read by ID and partition key (most efficient)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">try</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    ItemResponse<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> response <span class="op">=</span> await container<span class="op">.</span><span class="fu">ReadItemAsync</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        id<span class="op">:</span> <span class="st">"task-1"</span><span class="op">,</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        partitionKey<span class="op">:</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    TodoItem item <span class="op">=</span> response<span class="op">.</span><span class="fu">Resource</span><span class="op">;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Retrieved item: {item.Title}, RUs consumed: {response.RequestCharge}"</span><span class="op">);</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="kw">catch</span> <span class="op">(</span>CosmosException ex<span class="op">)</span> <span class="fu">when</span> <span class="op">(</span>ex<span class="op">.</span><span class="fu">StatusCode</span> <span class="op">==</span> HttpStatusCode<span class="op">.</span><span class="fu">NotFound</span><span class="op">)</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">"Item not found"</span><span class="op">);</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. SQL Query</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>QueryDefinition query <span class="op">=</span> <span class="kw">new</span> <span class="fu">QueryDefinition</span><span class="op">(</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SELECT * FROM c WHERE c.partitionKey = @partitionKey AND c.completed = @status"</span><span class="op">)</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">WithParameter</span><span class="op">(</span><span class="st">"@partitionKey"</span><span class="op">,</span> <span class="st">"personal"</span><span class="op">)</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">WithParameter</span><span class="op">(</span><span class="st">"@status"</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>FeedIterator<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> resultSet <span class="op">=</span> container<span class="op">.</span><span class="fu">GetItemQueryIterator</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    query<span class="op">,</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    requestOptions<span class="op">:</span> <span class="kw">new</span> QueryRequestOptions</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        MaxItemCount <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>        PartitionKey <span class="op">=</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">)</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> totalRequestCharge <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>List<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> results <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>TodoItem<span class="op">&gt;();</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="op">(</span>resultSet<span class="op">.</span><span class="fu">HasMoreResults</span><span class="op">)</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    FeedResponse<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> response <span class="op">=</span> await resultSet<span class="op">.</span><span class="fu">ReadNextAsync</span><span class="op">();</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    totalRequestCharge <span class="op">+=</span> response<span class="op">.</span><span class="fu">RequestCharge</span><span class="op">;</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    results<span class="op">.</span><span class="fu">AddRange</span><span class="op">(</span>response<span class="op">.</span><span class="fu">ToList</span><span class="op">());</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Found {results.Count} items, total RU consumed: {totalRequestCharge}"</span><span class="op">);</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. LINQ query </span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span><span class="op">.</span><span class="fu">Linq</span><span class="op">;</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>IOrderedQueryable<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> linqQueryable <span class="op">=</span> container<span class="op">.</span><span class="fu">GetItemLinqQueryable</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;();</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> query <span class="op">=</span> linqQueryable</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">Where</span><span class="op">(</span>t <span class="op">=&gt;</span> t<span class="op">.</span><span class="fu">PartitionKey</span> <span class="op">==</span> <span class="st">"personal"</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>t<span class="op">.</span><span class="fu">Completed</span><span class="op">)</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">OrderBy</span><span class="op">(</span>t <span class="op">=&gt;</span> t<span class="op">.</span><span class="fu">CreatedDate</span><span class="op">);</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> FeedIterator<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> linqResultSet <span class="op">=</span> query<span class="op">.</span><span class="fu">ToFeedIterator</span><span class="op">();</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="op">(</span>linqResultSet<span class="op">.</span><span class="fu">HasMoreResults</span><span class="op">)</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="op">(</span><span class="dt">var</span> item <span class="kw">in</span> await linqResultSet<span class="op">.</span><span class="fu">ReadNextAsync</span><span class="op">())</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"{item.Title}: {item.CreatedDate}"</span><span class="op">);</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="working-with-dynamic-entities" class="level3">
<h3 class="anchored" data-anchor-id="working-with-dynamic-entities">Working with Dynamic Entities</h3>
<p>You can work with dynamic objects when you don’t want to define strongly-typed classes:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Point read with dynamic object</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>ItemResponse<span class="op">&lt;</span>dynamic<span class="op">&gt;</span> dynamicResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">ReadItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    id<span class="op">:</span> <span class="st">"task-1"</span><span class="op">,</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    partitionKey<span class="op">:</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>dynamic item <span class="op">=</span> dynamicResponse<span class="op">.</span><span class="fu">Resource</span><span class="op">;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Title: {item.title}, Completed: {item.completed}"</span><span class="op">);</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Query with dynamic objects</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>QueryDefinition dynamicQuery <span class="op">=</span> <span class="kw">new</span> <span class="fu">QueryDefinition</span><span class="op">(</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SELECT * FROM c WHERE c.partitionKey = @partitionKey"</span><span class="op">)</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">WithParameter</span><span class="op">(</span><span class="st">"@partitionKey"</span><span class="op">,</span> <span class="st">"personal"</span><span class="op">);</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>FeedIterator<span class="op">&lt;</span>dynamic<span class="op">&gt;</span> dynamicResultSet <span class="op">=</span> container<span class="op">.</span><span class="fu">GetItemQueryIterator</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    dynamicQuery<span class="op">,</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    requestOptions<span class="op">:</span> <span class="kw">new</span> QueryRequestOptions</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        PartitionKey <span class="op">=</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">)</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="op">(</span>dynamicResultSet<span class="op">.</span><span class="fu">HasMoreResults</span><span class="op">)</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    FeedResponse<span class="op">&lt;</span>dynamic<span class="op">&gt;</span> response <span class="op">=</span> await dynamicResultSet<span class="op">.</span><span class="fu">ReadNextAsync</span><span class="op">();</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="op">(</span>dynamic item <span class="kw">in</span> response<span class="op">)</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"ID: {item.id}, Title: {item.title}"</span><span class="op">);</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Creating items with dynamic objects</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>dynamic newDynamicItem <span class="op">=</span> <span class="kw">new</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    id <span class="op">=</span> <span class="st">"dynamic-task-1"</span><span class="op">,</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    partitionKey <span class="op">=</span> <span class="st">"personal"</span><span class="op">,</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> <span class="st">"Task created with dynamic object"</span><span class="op">,</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    completed <span class="op">=</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    tags <span class="op">=</span> <span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> <span class="st">"dynamic"</span><span class="op">,</span> <span class="st">"example"</span> <span class="op">}</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>    newDynamicItem<span class="op">,</span> </span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="working-with-raw-json-responses" class="level3">
<h3 class="anchored" data-anchor-id="working-with-raw-json-responses">Working with Raw JSON Responses</h3>
<p>For maximum flexibility, you can work directly with JSON strings:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Query returning raw JSON stream</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>QueryDefinition jsonQuery <span class="op">=</span> <span class="kw">new</span> <span class="fu">QueryDefinition</span><span class="op">(</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SELECT * FROM c WHERE c.partitionKey = @partitionKey"</span><span class="op">)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">WithParameter</span><span class="op">(</span><span class="st">"@partitionKey"</span><span class="op">,</span> <span class="st">"personal"</span><span class="op">);</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>FeedIterator jsonIterator <span class="op">=</span> container<span class="op">.</span><span class="fu">GetItemQueryStreamIterator</span><span class="op">(</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    jsonQuery<span class="op">,</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    requestOptions<span class="op">:</span> <span class="kw">new</span> QueryRequestOptions</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        PartitionKey <span class="op">=</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">)</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="op">(</span>jsonIterator<span class="op">.</span><span class="fu">HasMoreResults</span><span class="op">)</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> ResponseMessage response <span class="op">=</span> await jsonIterator<span class="op">.</span><span class="fu">ReadNextAsync</span><span class="op">();</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>response<span class="op">.</span><span class="fu">IsSuccessStatusCode</span><span class="op">)</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> StreamReader reader <span class="op">=</span> <span class="kw">new</span> <span class="fu">StreamReader</span><span class="op">(</span>response<span class="op">.</span><span class="fu">Content</span><span class="op">);</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">string</span> jsonContent <span class="op">=</span> await reader<span class="op">.</span><span class="fu">ReadToEndAsync</span><span class="op">();</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Raw JSON Response: {jsonContent}"</span><span class="op">);</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Parse manually if needed</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> JsonDocument document <span class="op">=</span> JsonDocument<span class="op">.</span><span class="fu">Parse</span><span class="op">(</span>jsonContent<span class="op">);</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>        JsonElement root <span class="op">=</span> document<span class="op">.</span><span class="fu">RootElement</span><span class="op">;</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>root<span class="op">.</span><span class="fu">TryGetProperty</span><span class="op">(</span><span class="st">"Documents"</span><span class="op">,</span> <span class="kw">out</span> JsonElement documents<span class="op">))</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>            <span class="kw">foreach</span> <span class="op">(</span>JsonElement item <span class="kw">in</span> documents<span class="op">.</span><span class="fu">EnumerateArray</span><span class="op">())</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>item<span class="op">.</span><span class="fu">TryGetProperty</span><span class="op">(</span><span class="st">"title"</span><span class="op">,</span> <span class="kw">out</span> JsonElement title<span class="op">))</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>                    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Title from JSON: {title.GetString()}"</span><span class="op">);</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Point read with raw JSON</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> ResponseMessage jsonResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">ReadItemStreamAsync</span><span class="op">(</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"task-1"</span><span class="op">,</span> </span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>jsonResponse<span class="op">.</span><span class="fu">IsSuccessStatusCode</span><span class="op">)</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> StreamReader reader <span class="op">=</span> <span class="kw">new</span> <span class="fu">StreamReader</span><span class="op">(</span>jsonResponse<span class="op">.</span><span class="fu">Content</span><span class="op">);</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> itemJson <span class="op">=</span> await reader<span class="op">.</span><span class="fu">ReadToEndAsync</span><span class="op">();</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Raw JSON Item: {itemJson}"</span><span class="op">);</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Create item with raw JSON</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a><span class="dt">string</span> newItemJson <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>    <span class="st">"id"</span><span class="op">:</span> <span class="st">"json-task-1"</span><span class="op">,</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>    <span class="st">"partitionKey"</span><span class="op">:</span> <span class="st">"personal"</span><span class="op">,</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>    <span class="st">"title"</span><span class="op">:</span> <span class="st">"Task created with raw JSON"</span><span class="op">,</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>    <span class="st">"completed"</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>    <span class="st">"metadata"</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>        <span class="st">"createdBy"</span><span class="op">:</span> <span class="st">"system"</span><span class="op">,</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>        <span class="st">"priority"</span><span class="op">:</span> <span class="st">"high"</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a><span class="st">""";</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> MemoryStream stream <span class="op">=</span> <span class="kw">new</span> <span class="fu">MemoryStream</span><span class="op">(</span>Encoding<span class="op">.</span><span class="fu">UTF8</span><span class="op">.</span><span class="fu">GetBytes</span><span class="op">(</span>newItemJson<span class="op">));</span></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> ResponseMessage createResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">CreateItemStreamAsync</span><span class="op">(</span></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>    stream<span class="op">,</span> </span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>createResponse<span class="op">.</span><span class="fu">IsSuccessStatusCode</span><span class="op">)</span></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Created item with status: {createResponse.StatusCode}"</span><span class="op">);</span></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="performance-comparison" class="level3">
<h3 class="anchored" data-anchor-id="performance-comparison">Performance Comparison</h3>
<p>Different approaches have different performance characteristics:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Performance comparison example</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> stopwatch <span class="op">=</span> Stopwatch<span class="op">.</span><span class="fu">StartNew</span><span class="op">();</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Strongly-typed (fastest deserialization)</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> typedResults <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>TodoItem<span class="op">&gt;();</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> typedIterator <span class="op">=</span> container<span class="op">.</span><span class="fu">GetItemQueryIterator</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">QueryDefinition</span><span class="op">(</span><span class="st">"SELECT * FROM c WHERE c.partitionKey = 'personal'"</span><span class="op">),</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    requestOptions<span class="op">:</span> <span class="kw">new</span> QueryRequestOptions <span class="op">{</span> PartitionKey <span class="op">=</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">)</span> <span class="op">});</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="op">(</span>typedIterator<span class="op">.</span><span class="fu">HasMoreResults</span><span class="op">)</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    typedResults<span class="op">.</span><span class="fu">AddRange</span><span class="op">(</span>await typedIterator<span class="op">.</span><span class="fu">ReadNextAsync</span><span class="op">());</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Strongly-typed query: {stopwatch.ElapsedMilliseconds}ms"</span><span class="op">);</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Restart</span><span class="op">();</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Dynamic objects (flexible but slower)</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> dynamicResults <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>dynamic<span class="op">&gt;();</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> dynamicIterator <span class="op">=</span> container<span class="op">.</span><span class="fu">GetItemQueryIterator</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">QueryDefinition</span><span class="op">(</span><span class="st">"SELECT * FROM c WHERE c.partitionKey = 'personal'"</span><span class="op">),</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    requestOptions<span class="op">:</span> <span class="kw">new</span> QueryRequestOptions <span class="op">{</span> PartitionKey <span class="op">=</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">)</span> <span class="op">});</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="op">(</span>dynamicIterator<span class="op">.</span><span class="fu">HasMoreResults</span><span class="op">)</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    dynamicResults<span class="op">.</span><span class="fu">AddRange</span><span class="op">(</span>await dynamicIterator<span class="op">.</span><span class="fu">ReadNextAsync</span><span class="op">());</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Dynamic query: {stopwatch.ElapsedMilliseconds}ms"</span><span class="op">);</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Restart</span><span class="op">();</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Raw JSON (fastest network transfer, manual parsing required)</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> jsonIterator <span class="op">=</span> container<span class="op">.</span><span class="fu">GetItemQueryStreamIterator</span><span class="op">(</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">QueryDefinition</span><span class="op">(</span><span class="st">"SELECT * FROM c WHERE c.partitionKey = 'personal'"</span><span class="op">),</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    requestOptions<span class="op">:</span> <span class="kw">new</span> QueryRequestOptions <span class="op">{</span> PartitionKey <span class="op">=</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">)</span> <span class="op">});</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="op">(</span>jsonIterator<span class="op">.</span><span class="fu">HasMoreResults</span><span class="op">)</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="dt">var</span> response <span class="op">=</span> await jsonIterator<span class="op">.</span><span class="fu">ReadNextAsync</span><span class="op">();</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="dt">var</span> reader <span class="op">=</span> <span class="kw">new</span> <span class="fu">StreamReader</span><span class="op">(</span>response<span class="op">.</span><span class="fu">Content</span><span class="op">);</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> json <span class="op">=</span> await reader<span class="op">.</span><span class="fu">ReadToEndAsync</span><span class="op">();</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Process JSON as needed</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Raw JSON query: {stopwatch.ElapsedMilliseconds}ms"</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="query-performance-tips" class="level4">
<h4 class="anchored" data-anchor-id="query-performance-tips">Query Performance Tips</h4>
<ul>
<li><strong>Always include the partition key</strong> in your queries when possible</li>
<li><strong>Point reads</strong> (id + partition key) are the most efficient operations</li>
<li>Use <strong>parameterized queries</strong> to prevent SQL injection and improve caching</li>
<li>Monitor <strong>request charge (RUs)</strong> to optimize queries</li>
<li>Use <strong>projections</strong> (<code>SELECT VALUE c.name</code>) to return only needed properties</li>
<li>Consider <strong>paging</strong> with continuation tokens for large result sets</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Query with continuation token (pagination)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>QueryDefinition largeQuery <span class="op">=</span> <span class="kw">new</span> <span class="fu">QueryDefinition</span><span class="op">(</span><span class="st">"SELECT * FROM c"</span><span class="op">);</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>QueryRequestOptions options <span class="op">=</span> <span class="kw">new</span> QueryRequestOptions</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    MaxItemCount <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>FeedIterator<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> iterator <span class="op">=</span> container<span class="op">.</span><span class="fu">GetItemQueryIterator</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    largeQuery<span class="op">,</span> </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    requestOptions<span class="op">:</span> options<span class="op">);</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="dt">string</span> continuationToken <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co">// First page</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>FeedResponse<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> page <span class="op">=</span> await iterator<span class="op">.</span><span class="fu">ReadNextAsync</span><span class="op">();</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>continuationToken <span class="op">=</span> page<span class="op">.</span><span class="fu">ContinuationToken</span><span class="op">;</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ProcessItems</span><span class="op">(</span>page<span class="op">);</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co">// Later, get the next page using the continuation token</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>options<span class="op">.</span><span class="fu">RequestContinuation</span> <span class="op">=</span> continuationToken<span class="op">;</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>iterator <span class="op">=</span> container<span class="op">.</span><span class="fu">GetItemQueryIterator</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span>largeQuery<span class="op">,</span> requestOptions<span class="op">:</span> options<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="create" class="level3">
<h3 class="anchored" data-anchor-id="create">Create</h3>
<p>You can create items using strongly-typed entities, dynamic objects, or raw JSON:</p>
<section id="creating-with-strongly-typed-entities" class="level4">
<h4 class="anchored" data-anchor-id="creating-with-strongly-typed-entities">Creating with Strongly-Typed Entities</h4>
<div class="sourceCode" id="cb13"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a new item with strongly-typed class</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> newItem <span class="op">=</span> <span class="kw">new</span> TodoItem</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="st">"task-1"</span><span class="op">,</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    PartitionKey <span class="op">=</span> <span class="st">"personal"</span><span class="op">,</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    Title <span class="op">=</span> <span class="st">"Complete Azure Cosmos DB documentation"</span><span class="op">,</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    Completed <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Insert the item</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="kw">try</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    ItemResponse<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> response <span class="op">=</span> await container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">(</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        newItem<span class="op">,</span> </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span>newItem<span class="op">.</span><span class="fu">PartitionKey</span><span class="op">));</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Created item: {newItem.Id}"</span><span class="op">);</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Request charge: {response.RequestCharge} RUs"</span><span class="op">);</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="kw">catch</span> <span class="op">(</span>CosmosException ex<span class="op">)</span> <span class="fu">when</span> <span class="op">(</span>ex<span class="op">.</span><span class="fu">StatusCode</span> <span class="op">==</span> HttpStatusCode<span class="op">.</span><span class="fu">Conflict</span><span class="op">)</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">"Item already exists"</span><span class="op">);</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="co">// Upsert - create if not exists, replace if exists</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">UpsertItemAsync</span><span class="op">(</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    newItem<span class="op">,</span> </span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span>newItem<span class="op">.</span><span class="fu">PartitionKey</span><span class="op">));</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="co">// Create with custom options</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>ItemRequestOptions requestOptions <span class="op">=</span> <span class="kw">new</span> ItemRequestOptions</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>    EnableContentResponseOnWrite <span class="op">=</span> <span class="kw">false</span><span class="op">,</span> <span class="co">// Saves RUs by not returning the created item</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    ConsistencyLevel <span class="op">=</span> ConsistencyLevel<span class="op">.</span><span class="fu">Session</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">(</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>    newItem<span class="op">,</span> </span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span>newItem<span class="op">.</span><span class="fu">PartitionKey</span><span class="op">),</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>    requestOptions<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="creating-with-dynamic-objects" class="level4">
<h4 class="anchored" data-anchor-id="creating-with-dynamic-objects">Creating with Dynamic Objects</h4>
<div class="sourceCode" id="cb14"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Create with anonymous object</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>dynamic dynamicItem <span class="op">=</span> <span class="kw">new</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    id <span class="op">=</span> <span class="st">"dynamic-task-2"</span><span class="op">,</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    partitionKey <span class="op">=</span> <span class="st">"personal"</span><span class="op">,</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> <span class="st">"Task created with dynamic object"</span><span class="op">,</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    completed <span class="op">=</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    priority <span class="op">=</span> <span class="st">"high"</span><span class="op">,</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    tags <span class="op">=</span> <span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> <span class="st">"dynamic"</span><span class="op">,</span> <span class="st">"flexible"</span> <span class="op">},</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    metadata <span class="op">=</span> <span class="kw">new</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>        createdBy <span class="op">=</span> <span class="st">"system"</span><span class="op">,</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>        version <span class="op">=</span> <span class="st">"1.0"</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>ItemResponse<span class="op">&lt;</span>dynamic<span class="op">&gt;</span> dynamicResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    dynamicItem<span class="op">,</span> </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Created dynamic item: {dynamicResponse.Resource.id}"</span><span class="op">);</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co">// Create with ExpandoObject for runtime flexibility</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>dynamic expandoItem <span class="op">=</span> <span class="kw">new</span> <span class="fu">ExpandoObject</span><span class="op">();</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>expandoItem<span class="op">.</span><span class="fu">id</span> <span class="op">=</span> <span class="st">"expando-task-1"</span><span class="op">;</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>expandoItem<span class="op">.</span><span class="fu">partitionKey</span> <span class="op">=</span> <span class="st">"personal"</span><span class="op">;</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>expandoItem<span class="op">.</span><span class="fu">title</span> <span class="op">=</span> <span class="st">"Task created with ExpandoObject"</span><span class="op">;</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>expandoItem<span class="op">.</span><span class="fu">completed</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="co">// Add properties dynamically</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="op">((</span>IDictionary<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">object</span><span class="op">&gt;)</span>expandoItem<span class="op">)[</span><span class="st">"customField"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"customValue"</span><span class="op">;</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="op">((</span>IDictionary<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">object</span><span class="op">&gt;)</span>expandoItem<span class="op">)[</span><span class="st">"timestamp"</span><span class="op">]</span> <span class="op">=</span> DateTime<span class="op">.</span><span class="fu">UtcNow</span><span class="op">;</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    expandoItem<span class="op">,</span> </span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="co">// Upsert with dynamic objects</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">UpsertItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    dynamicItem<span class="op">,</span> </span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="creating-with-raw-json" class="level4">
<h4 class="anchored" data-anchor-id="creating-with-raw-json">Creating with Raw JSON</h4>
<div class="sourceCode" id="cb15"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Create item with JSON string</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="dt">string</span> newItemJson <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"id"</span><span class="op">:</span> <span class="st">"json-task-2"</span><span class="op">,</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"partitionKey"</span><span class="op">:</span> <span class="st">"personal"</span><span class="op">,</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"title"</span><span class="op">:</span> <span class="st">"Task created with raw JSON"</span><span class="op">,</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"completed"</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"priority"</span><span class="op">:</span> <span class="st">"medium"</span><span class="op">,</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tags"</span><span class="op">:</span> <span class="op">[</span><span class="st">"json"</span><span class="op">,</span> <span class="st">"manual"</span><span class="op">],</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"metadata"</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"createdBy"</span><span class="op">:</span> <span class="st">"api"</span><span class="op">,</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"source"</span><span class="op">:</span> <span class="st">"external-system"</span><span class="op">,</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"timestamp"</span><span class="op">:</span> <span class="st">"2025-01-15T10:30:00Z"</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"customProperties"</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nested"</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"value"</span><span class="op">:</span> <span class="dv">42</span><span class="op">,</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">"active"</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="st">""";</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co">// Create using stream for maximum performance</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> MemoryStream stream <span class="op">=</span> <span class="kw">new</span> <span class="fu">MemoryStream</span><span class="op">(</span>Encoding<span class="op">.</span><span class="fu">UTF8</span><span class="op">.</span><span class="fu">GetBytes</span><span class="op">(</span>newItemJson<span class="op">));</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> ResponseMessage createResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">CreateItemStreamAsync</span><span class="op">(</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    stream<span class="op">,</span> </span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>createResponse<span class="op">.</span><span class="fu">IsSuccessStatusCode</span><span class="op">)</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Created JSON item with status: {createResponse.StatusCode}"</span><span class="op">);</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Request charge: {createResponse.Headers.RequestCharge} RUs"</span><span class="op">);</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Read the created item from response if needed</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> StreamReader reader <span class="op">=</span> <span class="kw">new</span> <span class="fu">StreamReader</span><span class="op">(</span>createResponse<span class="op">.</span><span class="fu">Content</span><span class="op">);</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> createdItemJson <span class="op">=</span> await reader<span class="op">.</span><span class="fu">ReadToEndAsync</span><span class="op">();</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Created item: {createdItemJson}"</span><span class="op">);</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a><span class="kw">else</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Failed to create item: {createResponse.StatusCode}"</span><span class="op">);</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> StreamReader errorReader <span class="op">=</span> <span class="kw">new</span> <span class="fu">StreamReader</span><span class="op">(</span>createResponse<span class="op">.</span><span class="fu">Content</span><span class="op">);</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> errorMessage <span class="op">=</span> await errorReader<span class="op">.</span><span class="fu">ReadToEndAsync</span><span class="op">();</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Error: {errorMessage}"</span><span class="op">);</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a><span class="co">// Upsert with JSON stream</span></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> MemoryStream upsertStream <span class="op">=</span> <span class="kw">new</span> <span class="fu">MemoryStream</span><span class="op">(</span>Encoding<span class="op">.</span><span class="fu">UTF8</span><span class="op">.</span><span class="fu">GetBytes</span><span class="op">(</span>newItemJson<span class="op">));</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> ResponseMessage upsertResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">UpsertItemStreamAsync</span><span class="op">(</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>    upsertStream<span class="op">,</span> </span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a><span class="co">// Create with custom request options using JSON</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>ItemRequestOptions jsonRequestOptions <span class="op">=</span> <span class="kw">new</span> ItemRequestOptions</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>    EnableContentResponseOnWrite <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> MemoryStream customStream <span class="op">=</span> <span class="kw">new</span> <span class="fu">MemoryStream</span><span class="op">(</span>Encoding<span class="op">.</span><span class="fu">UTF8</span><span class="op">.</span><span class="fu">GetBytes</span><span class="op">(</span>newItemJson<span class="op">));</span></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> ResponseMessage customResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">CreateItemStreamAsync</span><span class="op">(</span></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>    customStream<span class="op">,</span> </span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">),</span></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>    jsonRequestOptions<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="performance-comparison-for-create-operations" class="level4">
<h4 class="anchored" data-anchor-id="performance-comparison-for-create-operations">Performance Comparison for Create Operations</h4>
<div class="sourceCode" id="cb16"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> stopwatch <span class="op">=</span> Stopwatch<span class="op">.</span><span class="fu">StartNew</span><span class="op">();</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Strongly-typed (good balance of performance and type safety)</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> typedItem <span class="op">=</span> <span class="kw">new</span> TodoItem <span class="op">{</span> Id <span class="op">=</span> <span class="st">"perf-typed"</span><span class="op">,</span> PartitionKey <span class="op">=</span> <span class="st">"test"</span><span class="op">,</span> Title <span class="op">=</span> <span class="st">"Typed"</span> <span class="op">};</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">(</span>typedItem<span class="op">,</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"test"</span><span class="op">));</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Strongly-typed create: {stopwatch.ElapsedMilliseconds}ms"</span><span class="op">);</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Restart</span><span class="op">();</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Dynamic object (flexible but slower serialization)</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>dynamic dynamicItem <span class="op">=</span> <span class="kw">new</span> <span class="op">{</span> id <span class="op">=</span> <span class="st">"perf-dynamic"</span><span class="op">,</span> partitionKey <span class="op">=</span> <span class="st">"test"</span><span class="op">,</span> title <span class="op">=</span> <span class="st">"Dynamic"</span> <span class="op">};</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span>dynamicItem<span class="op">,</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"test"</span><span class="op">));</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Dynamic create: {stopwatch.ElapsedMilliseconds}ms"</span><span class="op">);</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Restart</span><span class="op">();</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Raw JSON (fastest, no serialization overhead)</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="dt">string</span> jsonItem <span class="op">=</span> <span class="st">"""{"</span>id<span class="st">": "</span>perf<span class="op">-</span>json<span class="st">", "</span>partitionKey<span class="st">": "</span>test<span class="st">", "</span>title<span class="st">": "</span>JSON<span class="st">"}"""</span><span class="op">;</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="dt">var</span> stream <span class="op">=</span> <span class="kw">new</span> <span class="fu">MemoryStream</span><span class="op">(</span>Encoding<span class="op">.</span><span class="fu">UTF8</span><span class="op">.</span><span class="fu">GetBytes</span><span class="op">(</span>jsonItem<span class="op">));</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">CreateItemStreamAsync</span><span class="op">(</span>stream<span class="op">,</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"test"</span><span class="op">));</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Raw JSON create: {stopwatch.ElapsedMilliseconds}ms"</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="update" class="level3">
<h3 class="anchored" data-anchor-id="update">Update</h3>
<p>You can update items using strongly-typed entities, dynamic objects, or raw JSON through replace operations or patch operations:</p>
<section id="updating-with-strongly-typed-entities" class="level4">
<h4 class="anchored" data-anchor-id="updating-with-strongly-typed-entities">Updating with Strongly-Typed Entities</h4>
<div class="sourceCode" id="cb17"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Read first, then update</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">try</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the existing item</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    ItemResponse<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> response <span class="op">=</span> await container<span class="op">.</span><span class="fu">ReadItemAsync</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"task-1"</span><span class="op">,</span> </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    TodoItem item <span class="op">=</span> response<span class="op">.</span><span class="fu">Resource</span><span class="op">;</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Modify properties</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    item<span class="op">.</span><span class="fu">Title</span> <span class="op">=</span> <span class="st">"Updated title"</span><span class="op">;</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    item<span class="op">.</span><span class="fu">Completed</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update with optimistic concurrency control using ETag</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    ItemRequestOptions options <span class="op">=</span> <span class="kw">new</span> ItemRequestOptions</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>        IfMatchEtag <span class="op">=</span> response<span class="op">.</span><span class="fu">ETag</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Replace the item</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    await container<span class="op">.</span><span class="fu">ReplaceItemAsync</span><span class="op">(</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>        item<span class="op">,</span> </span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>        item<span class="op">.</span><span class="fu">Id</span><span class="op">,</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span>item<span class="op">.</span><span class="fu">PartitionKey</span><span class="op">),</span> </span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>        options<span class="op">);</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">"Item updated successfully"</span><span class="op">);</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="kw">catch</span> <span class="op">(</span>CosmosException ex<span class="op">)</span> <span class="fu">when</span> <span class="op">(</span>ex<span class="op">.</span><span class="fu">StatusCode</span> <span class="op">==</span> HttpStatusCode<span class="op">.</span><span class="fu">PreconditionFailed</span><span class="op">)</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">"Item was modified by another process"</span><span class="op">);</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a><span class="kw">catch</span> <span class="op">(</span>CosmosException ex<span class="op">)</span> <span class="fu">when</span> <span class="op">(</span>ex<span class="op">.</span><span class="fu">StatusCode</span> <span class="op">==</span> HttpStatusCode<span class="op">.</span><span class="fu">NotFound</span><span class="op">)</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">"Item not found"</span><span class="op">);</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a><span class="co">// Direct patch operations without reading first</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>PatchItemRequestOptions patchOptions <span class="op">=</span> <span class="kw">new</span> <span class="fu">PatchItemRequestOptions</span><span class="op">();</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>List<span class="op">&lt;</span>PatchOperation<span class="op">&gt;</span> patchOperations <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>PatchOperation<span class="op">&gt;</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Replace</span><span class="op">(</span><span class="st">"/title"</span><span class="op">,</span> <span class="st">"New patched title"</span><span class="op">),</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Replace</span><span class="op">(</span><span class="st">"/completed"</span><span class="op">,</span> <span class="kw">true</span><span class="op">),</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="st">"/tags"</span><span class="op">,</span> <span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> <span class="st">"important"</span><span class="op">,</span> <span class="st">"documentation"</span> <span class="op">})</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">PatchItemAsync</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">"task-1"</span><span class="op">,</span> </span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">),</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>    patchOperations<span class="op">,</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>    patchOptions<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="updating-with-dynamic-objects" class="level4">
<h4 class="anchored" data-anchor-id="updating-with-dynamic-objects">Updating with Dynamic Objects</h4>
<div class="sourceCode" id="cb18"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Read and update with dynamic objects</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>ItemResponse<span class="op">&lt;</span>dynamic<span class="op">&gt;</span> dynamicResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">ReadItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"dynamic-task-1"</span><span class="op">,</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>dynamic item <span class="op">=</span> dynamicResponse<span class="op">.</span><span class="fu">Resource</span><span class="op">;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Modify properties</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>item<span class="op">.</span><span class="fu">title</span> <span class="op">=</span> <span class="st">"Updated dynamic title"</span><span class="op">;</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>item<span class="op">.</span><span class="fu">completed</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>item<span class="op">.</span><span class="fu">lastModified</span> <span class="op">=</span> DateTime<span class="op">.</span><span class="fu">UtcNow</span><span class="op">;</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Add new properties dynamically</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>item<span class="op">.</span><span class="fu">updatedBy</span> <span class="op">=</span> <span class="st">"system"</span><span class="op">;</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>item<span class="op">.</span><span class="fu">version</span> <span class="op">=</span> <span class="st">"2.0"</span><span class="op">;</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co">// Replace with dynamic object</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">ReplaceItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    item<span class="op">,</span> </span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span><span class="dt">string</span><span class="op">)</span>item<span class="op">.</span><span class="fu">id</span><span class="op">,</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">((</span><span class="dt">string</span><span class="op">)</span>item<span class="op">.</span><span class="fu">partitionKey</span><span class="op">));</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="co">// Patch operations with dynamic values</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>List<span class="op">&lt;</span>PatchOperation<span class="op">&gt;</span> dynamicPatchOps <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>PatchOperation<span class="op">&gt;</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Replace</span><span class="op">(</span><span class="st">"/title"</span><span class="op">,</span> <span class="st">"Patched dynamic title"</span><span class="op">),</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="st">"/metadata/lastUpdated"</span><span class="op">,</span> DateTime<span class="op">.</span><span class="fu">UtcNow</span><span class="op">.</span><span class="fu">ToString</span><span class="op">(</span><span class="st">"O"</span><span class="op">)),</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Replace</span><span class="op">(</span><span class="st">"/priority"</span><span class="op">,</span> <span class="st">"urgent"</span><span class="op">),</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Remove</span><span class="op">(</span><span class="st">"/tags/0"</span><span class="op">)</span> <span class="co">// Remove first tag</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">PatchItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"dynamic-task-1"</span><span class="op">,</span> </span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">),</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>    dynamicPatchOps<span class="op">);</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="co">// Create or update with ExpandoObject</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>dynamic expandoUpdate <span class="op">=</span> <span class="kw">new</span> <span class="fu">ExpandoObject</span><span class="op">();</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> expandoDict <span class="op">=</span> <span class="op">(</span>IDictionary<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">object</span><span class="op">&gt;)</span>expandoUpdate<span class="op">;</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>expandoDict<span class="op">[</span><span class="st">"id"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"expando-task-1"</span><span class="op">;</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>expandoDict<span class="op">[</span><span class="st">"partitionKey"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"personal"</span><span class="op">;</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>expandoDict<span class="op">[</span><span class="st">"title"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Updated ExpandoObject"</span><span class="op">;</span></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>expandoDict<span class="op">[</span><span class="st">"completed"</span><span class="op">]</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>expandoDict<span class="op">[</span><span class="st">"updatedAt"</span><span class="op">]</span> <span class="op">=</span> DateTime<span class="op">.</span><span class="fu">UtcNow</span><span class="op">;</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a><span class="co">// Add nested objects</span></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>expandoDict<span class="op">[</span><span class="st">"metadata"</span><span class="op">]</span> <span class="op">=</span> <span class="kw">new</span> Dictionary<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">object</span><span class="op">&gt;</span></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="st">"lastModifiedBy"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"api"</span><span class="op">,</span></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="st">"version"</span><span class="op">]</span> <span class="op">=</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="st">"changes"</span><span class="op">]</span> <span class="op">=</span> <span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> <span class="st">"title"</span><span class="op">,</span> <span class="st">"status"</span> <span class="op">}</span></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">UpsertItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>    expandoUpdate<span class="op">,</span> </span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="updating-with-raw-json" class="level4">
<h4 class="anchored" data-anchor-id="updating-with-raw-json">Updating with Raw JSON</h4>
<div class="sourceCode" id="cb19"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Replace using JSON stream</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="dt">string</span> updatedItemJson <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"id"</span><span class="op">:</span> <span class="st">"json-task-1"</span><span class="op">,</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"partitionKey"</span><span class="op">:</span> <span class="st">"personal"</span><span class="op">,</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"title"</span><span class="op">:</span> <span class="st">"Updated JSON task"</span><span class="op">,</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"completed"</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"priority"</span><span class="op">:</span> <span class="st">"high"</span><span class="op">,</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tags"</span><span class="op">:</span> <span class="op">[</span><span class="st">"json"</span><span class="op">,</span> <span class="st">"updated"</span><span class="op">],</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"metadata"</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"lastModified"</span><span class="op">:</span> <span class="st">"2025-01-15T15:30:00Z"</span><span class="op">,</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"modifiedBy"</span><span class="op">:</span> <span class="st">"api-service"</span><span class="op">,</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"version"</span><span class="op">:</span> <span class="dv">2</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"history"</span><span class="op">:</span> <span class="op">[</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"action"</span><span class="op">:</span> <span class="st">"created"</span><span class="op">,</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">"timestamp"</span><span class="op">:</span> <span class="st">"2025-01-15T10:30:00Z"</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">"action"</span><span class="op">:</span> <span class="st">"updated"</span><span class="op">,</span> </span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">"timestamp"</span><span class="op">:</span> <span class="st">"2025-01-15T15:30:00Z"</span><span class="op">,</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">"changes"</span><span class="op">:</span> <span class="op">[</span><span class="st">"title"</span><span class="op">,</span> <span class="st">"completed"</span><span class="op">,</span> <span class="st">"priority"</span><span class="op">]</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">]</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="st">""";</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="co">// Replace with JSON stream</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> MemoryStream replaceStream <span class="op">=</span> <span class="kw">new</span> <span class="fu">MemoryStream</span><span class="op">(</span>Encoding<span class="op">.</span><span class="fu">UTF8</span><span class="op">.</span><span class="fu">GetBytes</span><span class="op">(</span>updatedItemJson<span class="op">));</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> ResponseMessage replaceResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">ReplaceItemStreamAsync</span><span class="op">(</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>    replaceStream<span class="op">,</span> </span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"json-task-1"</span><span class="op">,</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>replaceResponse<span class="op">.</span><span class="fu">IsSuccessStatusCode</span><span class="op">)</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Updated JSON item with status: {replaceResponse.StatusCode}"</span><span class="op">);</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Request charge: {replaceResponse.Headers.RequestCharge} RUs"</span><span class="op">);</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a><span class="co">// Upsert with JSON stream (create if not exists, replace if exists)</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> MemoryStream upsertStream <span class="op">=</span> <span class="kw">new</span> <span class="fu">MemoryStream</span><span class="op">(</span>Encoding<span class="op">.</span><span class="fu">UTF8</span><span class="op">.</span><span class="fu">GetBytes</span><span class="op">(</span>updatedItemJson<span class="op">));</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> ResponseMessage upsertResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">UpsertItemStreamAsync</span><span class="op">(</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>    upsertStream<span class="op">,</span> </span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a><span class="co">// Optimistic concurrency with ETag using JSON</span></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>ItemRequestOptions etagOptions <span class="op">=</span> <span class="kw">new</span> ItemRequestOptions</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>    IfMatchEtag <span class="op">=</span> <span class="st">"</span><span class="sc">\"</span><span class="st">some-etag-value</span><span class="sc">\"</span><span class="st">"</span> <span class="co">// Get this from a previous read operation</span></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> MemoryStream concurrencyStream <span class="op">=</span> <span class="kw">new</span> <span class="fu">MemoryStream</span><span class="op">(</span>Encoding<span class="op">.</span><span class="fu">UTF8</span><span class="op">.</span><span class="fu">GetBytes</span><span class="op">(</span>updatedItemJson<span class="op">));</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a><span class="kw">try</span></span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> ResponseMessage concurrencyResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">ReplaceItemStreamAsync</span><span class="op">(</span></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>        concurrencyStream<span class="op">,</span> </span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">"json-task-1"</span><span class="op">,</span></span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">),</span></span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>        etagOptions<span class="op">);</span></span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a><span class="kw">catch</span> <span class="op">(</span>CosmosException ex<span class="op">)</span> <span class="fu">when</span> <span class="op">(</span>ex<span class="op">.</span><span class="fu">StatusCode</span> <span class="op">==</span> HttpStatusCode<span class="op">.</span><span class="fu">PreconditionFailed</span><span class="op">)</span></span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">"Item was modified by another process - ETag mismatch"</span><span class="op">);</span></span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="advanced-patch-operations" class="level4">
<h4 class="anchored" data-anchor-id="advanced-patch-operations">Advanced Patch Operations</h4>
<div class="sourceCode" id="cb20"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Complex patch operations with different data types</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>List<span class="op">&lt;</span>PatchOperation<span class="op">&gt;</span> advancedPatchOps <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>PatchOperation<span class="op">&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Replace operations</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Replace</span><span class="op">(</span><span class="st">"/title"</span><span class="op">,</span> <span class="st">"Advanced patched title"</span><span class="op">),</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Replace</span><span class="op">(</span><span class="st">"/completed"</span><span class="op">,</span> <span class="kw">true</span><span class="op">),</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Replace</span><span class="op">(</span><span class="st">"/priority"</span><span class="op">,</span> <span class="st">"critical"</span><span class="op">),</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add operations</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="st">"/tags/-"</span><span class="op">,</span> <span class="st">"new-tag"</span><span class="op">),</span> <span class="co">// Add to end of array</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="st">"/metadata/patchedAt"</span><span class="op">,</span> DateTime<span class="op">.</span><span class="fu">UtcNow</span><span class="op">),</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="st">"/assignee"</span><span class="op">,</span> <span class="kw">new</span> <span class="op">{</span> name <span class="op">=</span> <span class="st">"John Doe"</span><span class="op">,</span> id <span class="op">=</span> <span class="st">"user123"</span> <span class="op">}),</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Remove operations</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Remove</span><span class="op">(</span><span class="st">"/oldProperty"</span><span class="op">),</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Remove</span><span class="op">(</span><span class="st">"/tags/0"</span><span class="op">),</span> <span class="co">// Remove first element from array</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Increment operation (for numeric values)</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Increment</span><span class="op">(</span><span class="st">"/retryCount"</span><span class="op">,</span> <span class="dv">1</span><span class="op">),</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set operation (like replace, but creates the path if it doesn't exist)</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Set</span><span class="op">(</span><span class="st">"/status/lastChecked"</span><span class="op">,</span> DateTime<span class="op">.</span><span class="fu">UtcNow</span><span class="op">)</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co">// Apply patch with conditional predicate</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>PatchItemRequestOptions advancedPatchOptions <span class="op">=</span> <span class="kw">new</span> PatchItemRequestOptions</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    FilterPredicate <span class="op">=</span> <span class="st">"FROM c WHERE c.version &lt; 5"</span> <span class="co">// Only apply if version is less than 5</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="kw">try</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>    ItemResponse<span class="op">&lt;</span>dynamic<span class="op">&gt;</span> patchResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">PatchItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">"task-1"</span><span class="op">,</span> </span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">),</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>        advancedPatchOps<span class="op">,</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>        advancedPatchOptions<span class="op">);</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Patch applied successfully. New version: {patchResponse.Resource.version}"</span><span class="op">);</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a><span class="kw">catch</span> <span class="op">(</span>CosmosException ex<span class="op">)</span> <span class="fu">when</span> <span class="op">(</span>ex<span class="op">.</span><span class="fu">StatusCode</span> <span class="op">==</span> HttpStatusCode<span class="op">.</span><span class="fu">PreconditionFailed</span><span class="op">)</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">"Patch condition not met - item version is &gt;= 5"</span><span class="op">);</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="performance-comparison-for-update-operations" class="level4">
<h4 class="anchored" data-anchor-id="performance-comparison-for-update-operations">Performance Comparison for Update Operations</h4>
<div class="sourceCode" id="cb21"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> stopwatch <span class="op">=</span> Stopwatch<span class="op">.</span><span class="fu">StartNew</span><span class="op">();</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Full replace with strongly-typed (type-safe but requires full object)</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> typedItem <span class="op">=</span> await container<span class="op">.</span><span class="fu">ReadItemAsync</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span><span class="st">"perf-typed"</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"test"</span><span class="op">));</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>typedItem<span class="op">.</span><span class="fu">Resource</span><span class="op">.</span><span class="fu">Title</span> <span class="op">=</span> <span class="st">"Updated"</span><span class="op">;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">ReplaceItemAsync</span><span class="op">(</span>typedItem<span class="op">.</span><span class="fu">Resource</span><span class="op">,</span> <span class="st">"perf-typed"</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"test"</span><span class="op">));</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Strongly-typed replace: {stopwatch.ElapsedMilliseconds}ms"</span><span class="op">);</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Restart</span><span class="op">();</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Patch operation (most efficient for partial updates)</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">PatchItemAsync</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"perf-typed"</span><span class="op">,</span> </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"test"</span><span class="op">),</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> PatchOperation<span class="op">.</span><span class="fu">Replace</span><span class="op">(</span><span class="st">"/title"</span><span class="op">,</span> <span class="st">"Patched"</span><span class="op">)</span> <span class="op">});</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Patch operation: {stopwatch.ElapsedMilliseconds}ms"</span><span class="op">);</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Restart</span><span class="op">();</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. JSON stream replace (fastest for full updates, no serialization)</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="dt">string</span> jsonUpdate <span class="op">=</span> <span class="st">"""{"</span>id<span class="st">": "</span>perf<span class="op">-</span>json<span class="st">", "</span>partitionKey<span class="st">": "</span>test<span class="st">", "</span>title<span class="st">": "</span>JSON Updated<span class="st">"}"""</span><span class="op">;</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="dt">var</span> stream <span class="op">=</span> <span class="kw">new</span> <span class="fu">MemoryStream</span><span class="op">(</span>Encoding<span class="op">.</span><span class="fu">UTF8</span><span class="op">.</span><span class="fu">GetBytes</span><span class="op">(</span>jsonUpdate<span class="op">));</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">ReplaceItemStreamAsync</span><span class="op">(</span>stream<span class="op">,</span> <span class="st">"perf-json"</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"test"</span><span class="op">));</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Raw JSON replace: {stopwatch.ElapsedMilliseconds}ms"</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="delete" class="level3">
<h3 class="anchored" data-anchor-id="delete">Delete</h3>
<div class="sourceCode" id="cb22"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Delete an item</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">try</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    await container<span class="op">.</span><span class="fu">DeleteItemAsync</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"task-1"</span><span class="op">,</span> </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">"Item deleted successfully"</span><span class="op">);</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="kw">catch</span> <span class="op">(</span>CosmosException ex<span class="op">)</span> <span class="fu">when</span> <span class="op">(</span>ex<span class="op">.</span><span class="fu">StatusCode</span> <span class="op">==</span> HttpStatusCode<span class="op">.</span><span class="fu">NotFound</span><span class="op">)</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">"Item not found"</span><span class="op">);</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Delete with optimistic concurrency</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="dt">string</span> etag <span class="op">=</span> <span class="st">"</span><span class="sc">\"</span><span class="st">00000000-0000-0000-0000-000000000000</span><span class="sc">\"</span><span class="st">"</span><span class="op">;</span> <span class="co">// ETag from previous read</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>ItemRequestOptions deleteOptions <span class="op">=</span> <span class="kw">new</span> ItemRequestOptions</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    IfMatchEtag <span class="op">=</span> etag</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">DeleteItemAsync</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"task-1"</span><span class="op">,</span> </span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">),</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    deleteOptions<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="advanced-patterns" class="level2">
<h2 class="anchored" data-anchor-id="advanced-patterns">Advanced Patterns</h2>
<section id="bulk-operations" class="level3">
<h3 class="anchored" data-anchor-id="bulk-operations">Bulk Operations</h3>
<p>For high-throughput scenarios, Cosmos DB provides bulk operations through parallel tasks:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Prepare items to create</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>List<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> itemsToCreate <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>TodoItem<span class="op">&gt;();</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">100</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    itemsToCreate<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> TodoItem</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        Id <span class="op">=</span> $<span class="st">"bulk-task-{i}"</span><span class="op">,</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        PartitionKey <span class="op">=</span> <span class="st">"bulk"</span><span class="op">,</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        Title <span class="op">=</span> $<span class="st">"Bulk created item {i}"</span><span class="op">,</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>        Completed <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a list of tasks for parallel execution</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>List<span class="op">&lt;</span>Task<span class="op">&gt;</span> concurrentTasks <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>Task<span class="op">&gt;();</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="op">(</span><span class="dt">var</span> item <span class="kw">in</span> itemsToCreate<span class="op">)</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    concurrentTasks<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">(</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>        item<span class="op">,</span> </span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span>item<span class="op">.</span><span class="fu">PartitionKey</span><span class="op">))</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">ContinueWith</span><span class="op">(</span>itemTask <span class="op">=&gt;</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>itemTask<span class="op">.</span><span class="fu">IsCompletedSuccessfully</span><span class="op">)</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>                ItemResponse<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> response <span class="op">=</span> itemTask<span class="op">.</span><span class="fu">Result</span><span class="op">;</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>                Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Created item {item.Id}: {response.RequestCharge} RUs"</span><span class="op">);</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>            <span class="kw">else</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>                AggregateException exceptions <span class="op">=</span> itemTask<span class="op">.</span><span class="fu">Exception</span><span class="op">;</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>                Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Failed to create item {item.Id}: {exceptions.InnerException.Message}"</span><span class="op">);</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">}));</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="co">// Wait for all operations to complete</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>await Task<span class="op">.</span><span class="fu">WhenAll</span><span class="op">(</span>concurrentTasks<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="change-feed-processing" class="level3">
<h3 class="anchored" data-anchor-id="change-feed-processing">Change Feed Processing</h3>
<p>The Change Feed is a powerful feature that provides a log of all changes to your containers:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Basic change feed processor</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>Container leaseContainer <span class="op">=</span> await database<span class="op">.</span><span class="fu">CreateContainerIfNotExistsAsync</span><span class="op">(</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"leases"</span><span class="op">,</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"/id"</span><span class="op">,</span> </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">400</span><span class="op">);</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> changeFeedProcessor <span class="op">=</span> container<span class="op">.</span><span class="fu">GetChangeFeedProcessorBuilder</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    processorName<span class="op">:</span> <span class="st">"todoChanges"</span><span class="op">,</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    onChangesDelegate<span class="op">:</span> HandleChangesAsync<span class="op">)</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">WithInstanceName</span><span class="op">(</span><span class="st">"workerInstance1"</span><span class="op">)</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">WithLeaseContainer</span><span class="op">(</span>leaseContainer<span class="op">)</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">Build</span><span class="op">();</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>await changeFeedProcessor<span class="op">.</span><span class="fu">StartAsync</span><span class="op">();</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Handle changes</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>async Task <span class="fu">HandleChangesAsync</span><span class="op">(</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    ChangeFeedProcessorContext context<span class="op">,</span> </span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    IReadOnlyCollection<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> changes<span class="op">,</span> </span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    CancellationToken cancellationToken<span class="op">)</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Detected {changes.Count} document changes"</span><span class="op">);</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="op">(</span>TodoItem item <span class="kw">in</span> changes<span class="op">)</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Changed item: {item.Id}, Title: {item.Title}"</span><span class="op">);</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Process changes - update cache, trigger workflows, etc.</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a><span class="co">// Later - stop the processor</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>await changeFeedProcessor<span class="op">.</span><span class="fu">StopAsync</span><span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="server-side-programming" class="level3">
<h3 class="anchored" data-anchor-id="server-side-programming">Server-Side Programming</h3>
<p>CosmosDB supports stored procedures, triggers, and UDFs for server-side logic:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Create a stored procedure</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="dt">string</span> sprocId <span class="op">=</span> <span class="st">"createTodoItem"</span><span class="op">;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="dt">string</span> sprocBody <span class="op">=</span> @<span class="st">"</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>function <span class="fu">createTodoItem</span><span class="op">(</span>itemBody<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> context <span class="op">=</span> <span class="fu">getContext</span><span class="op">();</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> container <span class="op">=</span> context<span class="op">.</span><span class="fu">getCollection</span><span class="op">();</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> response <span class="op">=</span> context<span class="op">.</span><span class="fu">getResponse</span><span class="op">();</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Generate ID if not provided</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(!</span>itemBody<span class="op">.</span><span class="fu">id</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>        itemBody<span class="op">.</span><span class="fu">id</span> <span class="op">=</span> <span class="fu">generateGuid</span><span class="op">();</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add creation timestamp</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    itemBody<span class="op">.</span><span class="fu">createdAt</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">Date</span><span class="op">().</span><span class="fu">toISOString</span><span class="op">();</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create document</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> accepted <span class="op">=</span> container<span class="op">.</span><span class="fu">createDocument</span><span class="op">(</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>        container<span class="op">.</span><span class="fu">getSelfLink</span><span class="op">(),</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>        itemBody<span class="op">,</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">function</span><span class="op">(</span>err<span class="op">,</span> documentCreated<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>err<span class="op">)</span> <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">Error</span><span class="op">(</span>'Error<span class="op">:</span> ' <span class="op">+</span> err<span class="op">.</span><span class="fu">message</span><span class="op">);</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>            response<span class="op">.</span><span class="fu">setBody</span><span class="op">(</span>documentCreated<span class="op">);</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(!</span>accepted<span class="op">)</span> <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">Error</span><span class="op">(</span>'The item create was not accepted'<span class="op">);</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>    function <span class="fu">generateGuid</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> 'xxxxxxxx<span class="op">-</span>xxxx<span class="dv">-4</span>xxx<span class="op">-</span>yxxx<span class="op">-</span>xxxxxxxxxxxx'<span class="op">.</span><span class="fu">replace</span><span class="op">(/[</span>xy<span class="op">]/</span>g<span class="op">,</span> <span class="fu">function</span><span class="op">(</span>c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>            <span class="dt">var</span> r <span class="op">=</span> Math<span class="op">.</span><span class="fu">random</span><span class="op">()</span> <span class="op">*</span> <span class="dv">16</span> <span class="op">|</span> <span class="dv">0</span><span class="op">,</span> v <span class="op">=</span> c <span class="op">==</span> <span class="ch">'x'</span> <span class="op">?</span> r <span class="op">:</span> <span class="op">(</span>r <span class="op">&amp;</span> <span class="bn">0x3</span> <span class="op">|</span> <span class="bn">0x8</span><span class="op">);</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> v<span class="op">.</span><span class="fu">toString</span><span class="op">(</span><span class="dv">16</span><span class="op">);</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span><span class="st">";</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>StoredProcedureResponse response <span class="op">=</span> await container<span class="op">.</span><span class="fu">Scripts</span><span class="op">.</span><span class="fu">CreateStoredProcedureAsync</span><span class="op">(</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> StoredProcedureProperties</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>        Id <span class="op">=</span> sprocId<span class="op">,</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>        Body <span class="op">=</span> sprocBody</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Execute a stored procedure</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>dynamic todoItem <span class="op">=</span> <span class="kw">new</span></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>    partitionKey <span class="op">=</span> <span class="st">"personal"</span><span class="op">,</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> <span class="st">"Learn about stored procedures"</span><span class="op">,</span></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>    completed <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>StoredProcedureExecuteResponse<span class="op">&lt;</span>dynamic<span class="op">&gt;</span> executeResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">Scripts</span><span class="op">.</span><span class="fu">ExecuteStoredProcedureAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>    sprocId<span class="op">,</span></span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">),</span></span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> todoItem <span class="op">});</span></span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>dynamic createdItem <span class="op">=</span> executeResponse<span class="op">.</span><span class="fu">Resource</span><span class="op">;</span></span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Created item ID: {createdItem.id}"</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="retry-policies" class="level3">
<h3 class="anchored" data-anchor-id="retry-policies">Retry Policies</h3>
<p>The Cosmos SDK has built-in retry policies, but you can customize them:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Custom retry policy for handling rate limiting (429) errors</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>CosmosClientOptions options <span class="op">=</span> <span class="kw">new</span> CosmosClientOptions</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    MaxRetryAttemptsOnRateLimitedRequests <span class="op">=</span> <span class="dv">9</span><span class="op">,</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    MaxRetryWaitTimeOnRateLimitedRequests <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromSeconds</span><span class="op">(</span><span class="dv">30</span><span class="op">)</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> cosmosClient <span class="op">=</span> <span class="kw">new</span> <span class="fu">CosmosClient</span><span class="op">(</span>endpoint<span class="op">,</span> key<span class="op">,</span> options<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For more complex scenarios, you can use Polly:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Polly<span class="op">;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Define policy</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> retryPolicy <span class="op">=</span> Policy</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">Handle</span><span class="op">&lt;</span>CosmosException<span class="op">&gt;(</span>ex <span class="op">=&gt;</span> ex<span class="op">.</span><span class="fu">StatusCode</span> <span class="op">==</span> HttpStatusCode<span class="op">.</span><span class="fu">TooManyRequests</span><span class="op">)</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">WaitAndRetryAsync</span><span class="op">(</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        retryCount<span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        sleepDurationProvider<span class="op">:</span> <span class="op">(</span>attempt<span class="op">)</span> <span class="op">=&gt;</span> TimeSpan<span class="op">.</span><span class="fu">FromSeconds</span><span class="op">(</span>Math<span class="op">.</span><span class="fu">Pow</span><span class="op">(</span><span class="dv">2</span><span class="op">,</span> attempt<span class="op">)),</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>        onRetry<span class="op">:</span> <span class="op">(</span>exception<span class="op">,</span> timespan<span class="op">,</span> retryCount<span class="op">,</span> context<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Retry {retryCount} after {timespan.TotalSeconds}s due to {exception.Message}"</span><span class="op">);</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Execute with policy</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>await retryPolicy<span class="op">.</span><span class="fu">ExecuteAsync</span><span class="op">(</span><span class="fu">async</span> <span class="op">()</span> <span class="op">=&gt;</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    await container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">(</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>        newItem<span class="op">,</span> </span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span>newItem<span class="op">.</span><span class="fu">PartitionKey</span><span class="op">));</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="dependency-injection-setup" class="level3">
<h3 class="anchored" data-anchor-id="dependency-injection-setup">Dependency Injection Setup</h3>
<div class="sourceCode" id="cb28"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Program.cs or Startup.cs</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span><span class="op">;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Microsoft<span class="op">.</span><span class="fu">Extensions</span><span class="op">.</span><span class="fu">DependencyInjection</span><span class="op">;</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">ConfigureServices</span><span class="op">(</span>IServiceCollection services<span class="op">)</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Register CosmosClient as singleton</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    services<span class="op">.</span><span class="fu">AddSingleton</span><span class="op">(</span>serviceProvider <span class="op">=&gt;</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> configuration <span class="op">=</span> serviceProvider<span class="op">.</span><span class="fu">GetRequiredService</span><span class="op">&lt;</span>IConfiguration<span class="op">&gt;();</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="kw">new</span> <span class="fu">CosmosClient</span><span class="op">(</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>            configuration<span class="op">[</span><span class="st">"CosmosDb:EndpointUrl"</span><span class="op">],</span> </span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>            configuration<span class="op">[</span><span class="st">"CosmosDb:PrimaryKey"</span><span class="op">],</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>            <span class="kw">new</span> CosmosClientOptions</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>                SerializerOptions <span class="op">=</span> <span class="kw">new</span> CosmosSerializationOptions</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>                    PropertyNamingPolicy <span class="op">=</span> CosmosPropertyNamingPolicy<span class="op">.</span><span class="fu">CamelCase</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">});</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Register database and container clients</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    services<span class="op">.</span><span class="fu">AddSingleton</span><span class="op">(</span>serviceProvider <span class="op">=&gt;</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> cosmosClient <span class="op">=</span> serviceProvider<span class="op">.</span><span class="fu">GetRequiredService</span><span class="op">&lt;</span>CosmosClient<span class="op">&gt;();</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> cosmosClient<span class="op">.</span><span class="fu">GetDatabase</span><span class="op">(</span><span class="st">"MyDatabase"</span><span class="op">);</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>    services<span class="op">.</span><span class="fu">AddSingleton</span><span class="op">(</span>serviceProvider <span class="op">=&gt;</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> database <span class="op">=</span> serviceProvider<span class="op">.</span><span class="fu">GetRequiredService</span><span class="op">&lt;</span>Database<span class="op">&gt;();</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> database<span class="op">.</span><span class="fu">GetContainer</span><span class="op">(</span><span class="st">"TodoItems"</span><span class="op">);</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Register your services</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>    services<span class="op">.</span><span class="fu">AddScoped</span><span class="op">&lt;</span>ITodoService<span class="op">,</span> TodoService<span class="op">&gt;();</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a><span class="co">// Service implementation</span></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> ITodoService</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>    Task<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> <span class="fu">GetItemAsync</span><span class="op">(</span><span class="dt">string</span> id<span class="op">,</span> <span class="dt">string</span> partitionKey<span class="op">);</span></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>    Task<span class="op">&lt;</span>IEnumerable<span class="op">&lt;</span>TodoItem<span class="op">&gt;&gt;</span> <span class="fu">GetIncompleteItemsAsync</span><span class="op">(</span><span class="dt">string</span> partitionKey<span class="op">);</span></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>    Task<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> <span class="fu">CreateItemAsync</span><span class="op">(</span>TodoItem item<span class="op">);</span></span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>    Task <span class="fu">UpdateItemAsync</span><span class="op">(</span>TodoItem item<span class="op">);</span></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>    Task <span class="fu">DeleteItemAsync</span><span class="op">(</span><span class="dt">string</span> id<span class="op">,</span> <span class="dt">string</span> partitionKey<span class="op">);</span></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> TodoService <span class="op">:</span> ITodoService</span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> Container _container<span class="op">;</span></span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">TodoService</span><span class="op">(</span>Container container<span class="op">)</span></span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>        _container <span class="op">=</span> container<span class="op">;</span></span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> <span class="fu">GetItemAsync</span><span class="op">(</span><span class="dt">string</span> id<span class="op">,</span> <span class="dt">string</span> partitionKey<span class="op">)</span></span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>        <span class="kw">try</span></span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a>            <span class="dt">var</span> response <span class="op">=</span> await _container<span class="op">.</span><span class="fu">ReadItemAsync</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>                id<span class="op">,</span> </span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a>                <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span>partitionKey<span class="op">));</span></span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> response<span class="op">.</span><span class="fu">Resource</span><span class="op">;</span></span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a>        <span class="kw">catch</span> <span class="op">(</span>CosmosException ex<span class="op">)</span> <span class="fu">when</span> <span class="op">(</span>ex<span class="op">.</span><span class="fu">StatusCode</span> <span class="op">==</span> HttpStatusCode<span class="op">.</span><span class="fu">NotFound</span><span class="op">)</span></span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task<span class="op">&lt;</span>IEnumerable<span class="op">&lt;</span>TodoItem<span class="op">&gt;&gt;</span> <span class="fu">GetIncompleteItemsAsync</span><span class="op">(</span><span class="dt">string</span> partitionKey<span class="op">)</span></span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> query <span class="op">=</span> <span class="kw">new</span> <span class="fu">QueryDefinition</span><span class="op">(</span></span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a>            <span class="st">"SELECT * FROM c WHERE c.partitionKey = @pk AND c.completed = false"</span><span class="op">)</span></span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">WithParameter</span><span class="op">(</span><span class="st">"@pk"</span><span class="op">,</span> partitionKey<span class="op">);</span></span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> results <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>TodoItem<span class="op">&gt;();</span></span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> iterator <span class="op">=</span> _container<span class="op">.</span><span class="fu">GetItemQueryIterator</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true" tabindex="-1"></a>            query<span class="op">,</span> </span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true" tabindex="-1"></a>            requestOptions<span class="op">:</span> <span class="kw">new</span> QueryRequestOptions</span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true" tabindex="-1"></a>                PartitionKey <span class="op">=</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span>partitionKey<span class="op">)</span></span>
<span id="cb28-88"><a href="#cb28-88" aria-hidden="true" tabindex="-1"></a>            <span class="op">});</span></span>
<span id="cb28-89"><a href="#cb28-89" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb28-90"><a href="#cb28-90" aria-hidden="true" tabindex="-1"></a>        <span class="kw">while</span> <span class="op">(</span>iterator<span class="op">.</span><span class="fu">HasMoreResults</span><span class="op">)</span></span>
<span id="cb28-91"><a href="#cb28-91" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb28-92"><a href="#cb28-92" aria-hidden="true" tabindex="-1"></a>            <span class="dt">var</span> response <span class="op">=</span> await iterator<span class="op">.</span><span class="fu">ReadNextAsync</span><span class="op">();</span></span>
<span id="cb28-93"><a href="#cb28-93" aria-hidden="true" tabindex="-1"></a>            results<span class="op">.</span><span class="fu">AddRange</span><span class="op">(</span>response<span class="op">);</span></span>
<span id="cb28-94"><a href="#cb28-94" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb28-95"><a href="#cb28-95" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb28-96"><a href="#cb28-96" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> results<span class="op">;</span></span>
<span id="cb28-97"><a href="#cb28-97" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb28-98"><a href="#cb28-98" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-99"><a href="#cb28-99" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> <span class="fu">CreateItemAsync</span><span class="op">(</span>TodoItem item<span class="op">)</span></span>
<span id="cb28-100"><a href="#cb28-100" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb28-101"><a href="#cb28-101" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> response <span class="op">=</span> await _container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">(</span></span>
<span id="cb28-102"><a href="#cb28-102" aria-hidden="true" tabindex="-1"></a>            item<span class="op">,</span> </span>
<span id="cb28-103"><a href="#cb28-103" aria-hidden="true" tabindex="-1"></a>            <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span>item<span class="op">.</span><span class="fu">PartitionKey</span><span class="op">));</span></span>
<span id="cb28-104"><a href="#cb28-104" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb28-105"><a href="#cb28-105" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> response<span class="op">.</span><span class="fu">Resource</span><span class="op">;</span></span>
<span id="cb28-106"><a href="#cb28-106" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb28-107"><a href="#cb28-107" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-108"><a href="#cb28-108" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Additional methods...</span></span>
<span id="cb28-109"><a href="#cb28-109" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="authentication-approaches" class="level2">
<h2 class="anchored" data-anchor-id="authentication-approaches">Authentication Approaches</h2>
<p>Azure Cosmos DB supports multiple authentication methods, each with its own security characteristics and use cases:</p>
<section id="primary-key-authentication-connection-string" class="level3">
<h3 class="anchored" data-anchor-id="primary-key-authentication-connection-string">1. <strong>Primary Key Authentication (Connection String)</strong></h3>
<div class="sourceCode" id="cb29"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Basic endpoint and key authentication</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> endpoint <span class="op">=</span> <span class="st">"https://your-account.documents.azure.com:443/"</span><span class="op">;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> primaryKey <span class="op">=</span> <span class="st">"your-primary-key"</span><span class="op">;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> cosmosClient <span class="op">=</span> <span class="kw">new</span> <span class="fu">CosmosClient</span><span class="op">(</span>endpoint<span class="op">,</span> primaryKey<span class="op">);</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Alternative: Connection string</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> connectionString <span class="op">=</span> <span class="st">"AccountEndpoint=https://your-account.documents.azure.com:443/;AccountKey=your-primary-key;"</span><span class="op">;</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> cosmosClient <span class="op">=</span> <span class="kw">new</span> <span class="fu">CosmosClient</span><span class="op">(</span>connectionString<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Best for</strong>: Development environments, simple applications, single-service scenarios. <strong>Security considerations</strong>: Keys provide full access to the account and should be carefully protected.</p>
</section>
<section id="azure-active-directory-aad-authentication" class="level3">
<h3 class="anchored" data-anchor-id="azure-active-directory-aad-authentication">2. <strong>Azure Active Directory (AAD) Authentication</strong></h3>
<div class="sourceCode" id="cb30"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Azure<span class="op">.</span><span class="fu">Identity</span><span class="op">;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Using Managed Identity</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> credential <span class="op">=</span> <span class="kw">new</span> <span class="fu">DefaultAzureCredential</span><span class="op">();</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> cosmosClient <span class="op">=</span> <span class="kw">new</span> <span class="fu">CosmosClient</span><span class="op">(</span>endpoint<span class="op">,</span> credential<span class="op">);</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Using Service Principal</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> servicePrincipalCredential <span class="op">=</span> <span class="kw">new</span> <span class="fu">ClientSecretCredential</span><span class="op">(</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    tenantId<span class="op">:</span> <span class="st">"your-tenant-id"</span><span class="op">,</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    clientId<span class="op">:</span> <span class="st">"your-client-id"</span><span class="op">,</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    clientSecret<span class="op">:</span> <span class="st">"your-client-secret"</span><span class="op">);</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> cosmosClient <span class="op">=</span> <span class="kw">new</span> <span class="fu">CosmosClient</span><span class="op">(</span>endpoint<span class="op">,</span> servicePrincipalCredential<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Best for</strong>: Production environments, multi-service applications, Azure-hosted services. <strong>Security considerations</strong>: No secrets in code, integrated with Azure RBAC, supports key rotation.</p>
</section>
<section id="resource-token-authentication" class="level3">
<h3 class="anchored" data-anchor-id="resource-token-authentication">3. <strong>Resource Token Authentication</strong></h3>
<div class="sourceCode" id="cb31"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">// First, create a permission (typically on a server with master key)</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> permissionResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">CreatePermissionAsync</span><span class="op">(</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> PermissionProperties</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>        Id <span class="op">=</span> <span class="st">"read-only-permission"</span><span class="op">,</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>        PermissionMode <span class="op">=</span> PermissionMode<span class="op">.</span><span class="fu">Read</span><span class="op">,</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>        ResourceLink <span class="op">=</span> container<span class="op">.</span><span class="fu">Link</span><span class="op">,</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>        ResourcePartitionKey <span class="op">=</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"user123"</span><span class="op">)</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="dt">string</span> resourceToken <span class="op">=</span> permissionResponse<span class="op">.</span><span class="fu">Resource</span><span class="op">.</span><span class="fu">Token</span><span class="op">;</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co">// On client side - use the limited resource token</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> resourceTokenCosmosClient <span class="op">=</span> <span class="kw">new</span> <span class="fu">CosmosClient</span><span class="op">(</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    endpoint<span class="op">,</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    resourceToken<span class="op">,</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> CosmosClientOptions</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>        ApplicationRegion <span class="op">=</span> <span class="st">"West US 2"</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Best for</strong>: Client-side applications, multi-tenant scenarios, granular access control. <strong>Security considerations</strong>: Fine-grained access control, short-lived tokens, limited to specific containers/partitions.</p>
</section>
<section id="authentication-comparison" class="level3">
<h3 class="anchored" data-anchor-id="authentication-comparison">Authentication Comparison</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 17%">
<col style="width: 29%">
<col style="width: 21%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Security Level</th>
<th>Best For</th>
<th>Considerations</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Primary Key</strong></td>
<td>⚠️ Basic</td>
<td>Development, Simple apps</td>
<td>Full account access, difficult to rotate</td>
</tr>
<tr class="even">
<td><strong>AAD Authentication</strong></td>
<td>✅ High</td>
<td>Production, Azure services</td>
<td>No secrets in code, easy to manage access</td>
</tr>
<tr class="odd">
<td><strong>Managed Identity</strong></td>
<td>✅ Highest</td>
<td>Azure-hosted services</td>
<td>No secrets anywhere, automatic rotation</td>
</tr>
<tr class="even">
<td><strong>Resource Tokens</strong></td>
<td>✅ High</td>
<td>Client apps, Multi-tenant</td>
<td>Fine-grained, time-limited access</td>
</tr>
</tbody>
</table>
</section>
<section id="best-practices" class="level3">
<h3 class="anchored" data-anchor-id="best-practices">Best Practices</h3>
<ol type="1">
<li><strong>Always use Managed Identity</strong> for Azure-hosted applications</li>
<li><strong>Never store primary keys</strong> in code or configuration files</li>
<li><strong>Use Azure Key Vault</strong> to securely store connection strings when needed</li>
<li><strong>Apply Principle of Least Privilege</strong> with resource tokens or RBAC</li>
<li><strong>Implement token caching</strong> when using resource tokens</li>
<li><strong>Set up alerts</strong> for unusual access patterns</li>
<li><strong>Regularly rotate keys</strong> to limit exposure from potential leaks</li>
</ol>
</section>
</section>
<section id="migration-from-legacy-sdk" class="level2">
<h2 class="anchored" data-anchor-id="migration-from-legacy-sdk">Migration from Legacy SDK</h2>
<p>Azure Cosmos DB has evolved significantly, and several legacy SDKs have been <strong>deprecated and discontinued</strong>. Understanding the migration path is crucial for maintaining secure, performant applications.</p>
<section id="legacy-sdks-overview" class="level3">
<h3 class="anchored" data-anchor-id="legacy-sdks-overview">Legacy SDKs Overview</h3>
<section id="microsoft.azure.documentdb-sql-api-legacy" class="level4">
<h4 class="anchored" data-anchor-id="microsoft.azure.documentdb-sql-api-legacy"><strong>1. Microsoft.Azure.DocumentDB (SQL API Legacy)</strong></h4>
<p>The original SDK for Cosmos DB SQL API, discontinued in March 2020.</p>
</section>
<section id="microsoft.azure.cosmos.table-table-api-legacy" class="level4">
<h4 class="anchored" data-anchor-id="microsoft.azure.cosmos.table-table-api-legacy"><strong>2. Microsoft.Azure.Cosmos.Table (Table API Legacy)</strong></h4>
<p>A specialized SDK for accessing Cosmos DB Table API, based on Azure Table Storage patterns. <strong>Also deprecated</strong> in favor of the unified <code>Microsoft.Azure.Cosmos</code> approach.</p>
</section>
<section id="windowsazure.storage-azure-table-storage" class="level4">
<h4 class="anchored" data-anchor-id="windowsazure.storage-azure-table-storage"><strong>3. WindowsAzure.Storage (Azure Table Storage)</strong></h4>
<p>The original Azure Table Storage SDK that many developers used before Cosmos DB Table API existed.</p>
</section>
</section>
<section id="why-legacy-sdks-were-discontinued" class="level3">
<h3 class="anchored" data-anchor-id="why-legacy-sdks-were-discontinued">Why Legacy SDKs Were Discontinued</h3>
<section id="architecture-design-issues" class="level4">
<h4 class="anchored" data-anchor-id="architecture-design-issues"><strong>1. Architecture &amp; Design Issues</strong></h4>
<ul>
<li><strong>Callback-Based Patterns</strong>: Legacy SDKs were designed around callback patterns predating modern async/await</li>
<li><strong>Inadequate Error Handling</strong>: Limited status code mapping and retry policies</li>
<li><strong>Complex Object Model</strong>: Overly complex inheritance chains and abstractions</li>
<li><strong>Fragmented APIs</strong>: Different SDKs for different APIs led to inconsistent developer experience</li>
</ul>
</section>
<section id="modern-development-standards" class="level4">
<h4 class="anchored" data-anchor-id="modern-development-standards"><strong>2. Modern Development Standards</strong></h4>
<ul>
<li><strong>Async/Await Patterns</strong>: Modern applications require efficient async operations from the ground up</li>
<li><strong>Performance</strong>: Legacy SDKs had performance bottlenecks and inefficient memory usage</li>
<li><strong>Target Framework Support</strong>: Limited support for newer .NET versions and .NET Core</li>
<li><strong>Unified Experience</strong>: Microsoft moved towards a single, unified SDK approach</li>
</ul>
</section>
<section id="service-evolution" class="level4">
<h4 class="anchored" data-anchor-id="service-evolution"><strong>3. Service Evolution</strong></h4>
<ul>
<li><strong>New Features</strong>: Legacy SDKs couldn’t support newer features like change feed, bulk operations, and AAD auth</li>
<li><strong>Consistency</strong>: Microsoft moved to consistent Azure SDK guidelines across all services</li>
<li><strong>Maintenance</strong>: Supporting multiple SDKs was inefficient and led to inconsistencies</li>
<li><strong>Multi-Model Support</strong>: Modern SDK supports multiple APIs from a single package</li>
</ul>
</section>
</section>
<section id="comprehensive-library-comparison" class="level3">
<h3 class="anchored" data-anchor-id="comprehensive-library-comparison">Comprehensive Library Comparison</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 7%">
<col style="width: 25%">
<col style="width: 26%">
<col style="width: 17%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th><code>Microsoft.Azure.DocumentDB</code></th>
<th><code>Microsoft.Azure.Cosmos.Table</code></th>
<th><code>Azure.Data.Tables</code></th>
<th><code>Microsoft.Azure.Cosmos</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Status</strong></td>
<td>❌ Deprecated (2020)</td>
<td>❌ Deprecated (2021)</td>
<td>✅ Active (Table Storage)</td>
<td>✅ Active &amp; Recommended</td>
</tr>
<tr class="even">
<td><strong>Target Service</strong></td>
<td>Cosmos DB SQL API</td>
<td>Cosmos DB Table API</td>
<td>Azure Table Storage</td>
<td>All Cosmos DB APIs</td>
</tr>
<tr class="odd">
<td><strong>API Design</strong></td>
<td>Callback-heavy</td>
<td>Table Storage patterns</td>
<td>Modern async/await</td>
<td>Modern async/await</td>
</tr>
<tr class="even">
<td><strong>Performance</strong></td>
<td>Poor</td>
<td>Moderate</td>
<td>Good</td>
<td>Excellent</td>
</tr>
<tr class="odd">
<td><strong>Bulk Operations</strong></td>
<td>Limited</td>
<td>Limited</td>
<td>Basic</td>
<td>Advanced</td>
</tr>
<tr class="even">
<td><strong>Authentication</strong></td>
<td>Primary key only</td>
<td>Primary key + SAS</td>
<td>AAD + SAS + Key</td>
<td>AAD + Managed Identity + Key</td>
</tr>
<tr class="odd">
<td><strong>.NET Core Support</strong></td>
<td>Limited</td>
<td>Full</td>
<td>Full</td>
<td>Full</td>
</tr>
<tr class="even">
<td><strong>Multi-Model</strong></td>
<td>SQL only</td>
<td>Table only</td>
<td>Table only</td>
<td>SQL, Table, MongoDB, etc.</td>
</tr>
<tr class="odd">
<td><strong>Change Feed</strong></td>
<td>Basic</td>
<td>❌ Not supported</td>
<td>❌ Not supported</td>
<td>Comprehensive</td>
</tr>
<tr class="even">
<td><strong>Global Distribution</strong></td>
<td>Basic</td>
<td>Basic</td>
<td>❌ Limited</td>
<td>Advanced</td>
</tr>
<tr class="odd">
<td><strong>Diagnostics</strong></td>
<td>Limited</td>
<td>Limited</td>
<td>Good</td>
<td>Excellent</td>
</tr>
</tbody>
</table>
</section>
<section id="migration-paths-code-examples" class="level3">
<h3 class="anchored" data-anchor-id="migration-paths-code-examples">Migration Paths &amp; Code Examples</h3>
<section id="path-1-from-microsoft.azure.documentdb-sql-api" class="level4">
<h4 class="anchored" data-anchor-id="path-1-from-microsoft.azure.documentdb-sql-api"><strong>Path 1: From Microsoft.Azure.DocumentDB (SQL API)</strong></h4>
<p><strong>Step 1: Update Package References</strong></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- REMOVE legacy package --&gt;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- &lt;PackageReference Include="Microsoft.Azure.DocumentDB" Version="2.x.x" /&gt; --&gt;</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ADD modern package --&gt;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">"Microsoft.Azure.Cosmos"</span><span class="ot"> Version=</span><span class="st">"3.37.0"</span> /&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Step 2: Update Namespace Imports</strong></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">// OLD namespaces</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co">// using Microsoft.Azure.Documents;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co">// using Microsoft.Azure.Documents.Client;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co">// NEW namespace</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Step 3: Update Client Initialization</strong></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">// OLD - DocumentDB</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">DocumentClient client = new DocumentClient(</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">    new Uri("https://your-account.documents.azure.com:443/"),</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">    "your-primary-key");</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co">await client.OpenAsync();</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co">// NEW - Cosmos SDK</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>CosmosClient cosmosClient <span class="op">=</span> <span class="kw">new</span> <span class="fu">CosmosClient</span><span class="op">(</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://your-account.documents.azure.com:443/"</span><span class="op">,</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"your-primary-key"</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Step 4: Update CRUD Operations</strong></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">// OLD - Create Document</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">Document document = await client.CreateDocumentAsync(</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">    UriFactory.CreateDocumentCollectionUri("MyDatabase", "MyCollection"),</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">    new { id = "item1", name = "Item 1", partitionKey = "pk1" });</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">// NEW - Create Item</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>ItemResponse<span class="op">&lt;</span>dynamic<span class="op">&gt;</span> response <span class="op">=</span> await container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="op">{</span> id <span class="op">=</span> <span class="st">"item1"</span><span class="op">,</span> name <span class="op">=</span> <span class="st">"Item 1"</span><span class="op">,</span> partitionKey <span class="op">=</span> <span class="st">"pk1"</span> <span class="op">},</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"pk1"</span><span class="op">));</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co">// OLD - Query Documents</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co">FeedOptions options = new FeedOptions { EnableCrossPartitionQuery = true };</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co">IDocumentQuery&lt;dynamic&gt; query = client.CreateDocumentQuery&lt;dynamic&gt;(</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co">    UriFactory.CreateDocumentCollectionUri("MyDatabase", "MyCollection"),</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co">    "SELECT * FROM c WHERE c.name = 'Item 1'", </span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="co">    options).AsDocumentQuery();</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="co">while (query.HasMoreResults)</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="co">{</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="co">    FeedResponse&lt;dynamic&gt; results = await query.ExecuteNextAsync&lt;dynamic&gt;();</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="co">    foreach (var item in results)</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="co">    {</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="co">        Console.WriteLine(item.name);</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="co">    }</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="co">// NEW - Query Items</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>QueryDefinition queryDefinition <span class="op">=</span> <span class="kw">new</span> <span class="fu">QueryDefinition</span><span class="op">(</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SELECT * FROM c WHERE c.name = 'Item 1'"</span><span class="op">);</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>FeedIterator<span class="op">&lt;</span>dynamic<span class="op">&gt;</span> resultSet <span class="op">=</span> container<span class="op">.</span><span class="fu">GetItemQueryIterator</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>    queryDefinition<span class="op">,</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>    requestOptions<span class="op">:</span> <span class="kw">new</span> QueryRequestOptions <span class="op">{</span> MaxItemCount <span class="op">=</span> <span class="dv">10</span> <span class="op">});</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="op">(</span>resultSet<span class="op">.</span><span class="fu">HasMoreResults</span><span class="op">)</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>    FeedResponse<span class="op">&lt;</span>dynamic<span class="op">&gt;</span> response <span class="op">=</span> await resultSet<span class="op">.</span><span class="fu">ReadNextAsync</span><span class="op">();</span></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="op">(</span><span class="dt">var</span> item <span class="kw">in</span> response<span class="op">)</span></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>item<span class="op">.</span><span class="fu">name</span><span class="op">);</span></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="path-2-from-microsoft.azure.cosmos.table-table-api" class="level4">
<h4 class="anchored" data-anchor-id="path-2-from-microsoft.azure.cosmos.table-table-api"><strong>Path 2: From Microsoft.Azure.Cosmos.Table (Table API)</strong></h4>
<p><strong>Step 1: Update Package References</strong></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- REMOVE legacy Table API package --&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- &lt;PackageReference Include="Microsoft.Azure.Cosmos.Table" Version="1.x.x" /&gt; --&gt;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ADD modern unified package --&gt;</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">"Microsoft.Azure.Cosmos"</span><span class="ot"> Version=</span><span class="st">"3.37.0"</span> /&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Step 2: Update Namespace Imports</strong></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">// OLD namespaces</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co">// using Microsoft.Azure.Cosmos.Table;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">// using Microsoft.Azure.Cosmos.Table.Protocol;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co">// NEW namespace</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Step 3: Client &amp; Container Setup</strong></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">// OLD - Table Client</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co">CloudStorageAccount storageAccount = CloudStorageAccount.Parse(connectionString);</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co">CloudTableClient tableClient = storageAccount.CreateCloudTableClient();</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co">CloudTable table = tableClient.GetTableReference("MyTable");</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co">await table.CreateIfNotExistsAsync();</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co">// NEW - Cosmos Container (Table API via SQL API)</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>CosmosClient cosmosClient <span class="op">=</span> <span class="kw">new</span> <span class="fu">CosmosClient</span><span class="op">(</span>endpoint<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>Database database <span class="op">=</span> await cosmosClient<span class="op">.</span><span class="fu">CreateDatabaseIfNotExistsAsync</span><span class="op">(</span><span class="st">"MyDatabase"</span><span class="op">);</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>Container container <span class="op">=</span> await database<span class="op">.</span><span class="fu">CreateContainerIfNotExistsAsync</span><span class="op">(</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    id<span class="op">:</span> <span class="st">"MyTable"</span><span class="op">,</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    partitionKeyPath<span class="op">:</span> <span class="st">"/PartitionKey"</span><span class="op">,</span> <span class="co">// Note: PartitionKey is the property name</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    throughput<span class="op">:</span> <span class="dv">400</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Step 4: Entity Model Changes</strong></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">// OLD - Table Entity</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co">public class CustomerEntity : TableEntity</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">{</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">    public CustomerEntity(string lastName, string firstName)</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co">    {</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">        this.PartitionKey = lastName;</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co">        this.RowKey = firstName;</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co">    }</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co">    public CustomerEntity() { }</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co">    public string Email { get; set; }</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co">    public string PhoneNumber { get; set; }</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="co">// NEW - Cosmos Document Model</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> Customer</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">JsonProperty</span><span class="op">(</span><span class="st">"id"</span><span class="op">)]</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> Id <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="co">// Combination of PartitionKey + RowKey</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">JsonProperty</span><span class="op">(</span><span class="st">"PartitionKey"</span><span class="op">)]</span> </span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> PartitionKey <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="co">// Same as Table PartitionKey</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> LastName <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> FirstName <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> Email <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> PhoneNumber <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> DateTime Timestamp <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> DateTime<span class="op">.</span><span class="fu">UtcNow</span><span class="op">;</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Constructor to maintain Table API compatibility</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">Customer</span><span class="op">(</span><span class="dt">string</span> lastName<span class="op">,</span> <span class="dt">string</span> firstName<span class="op">)</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>        PartitionKey <span class="op">=</span> lastName<span class="op">;</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>        LastName <span class="op">=</span> lastName<span class="op">;</span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>        FirstName <span class="op">=</span> firstName<span class="op">;</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>        Id <span class="op">=</span> $<span class="st">"{lastName}#{firstName}"</span><span class="op">;</span> <span class="co">// Composite key</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">Customer</span><span class="op">()</span> <span class="op">{</span> <span class="op">}</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Step 5: CRUD Operations Migration</strong></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode csharp code-with-copy"><code class="sourceCode cs"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">// OLD - Insert Entity</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co">CustomerEntity customer = new CustomerEntity("Doe", "John")</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co">{</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Email = "john.doe@example.com",</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co">    PhoneNumber = "555-1234"</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co">};</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co">TableOperation insertOperation = TableOperation.Insert(customer);</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co">TableResult result = await table.ExecuteAsync(insertOperation);</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co">// NEW - Create Item</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>Customer customer <span class="op">=</span> <span class="kw">new</span> <span class="fu">Customer</span><span class="op">(</span><span class="st">"Doe"</span><span class="op">,</span> <span class="st">"John"</span><span class="op">)</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    Email <span class="op">=</span> <span class="st">"john.doe@example.com"</span><span class="op">,</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    PhoneNumber <span class="op">=</span> <span class="st">"555-1234"</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>ItemResponse<span class="op">&lt;</span>Customer<span class="op">&gt;</span> response <span class="op">=</span> await container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">(</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    customer<span class="op">,</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span>customer<span class="op">.</span><span class="fu">PartitionKey</span><span class="op">));</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a><span class="co">// OLD - Retrieve Entity</span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a><span class="co">TableOperation retrieveOperation = TableOperation.Retrieve&lt;CustomerEntity&gt;("Doe", "John");</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a><span class="co">TableResult retrievedResult = await table.ExecuteAsync(retrieveOperation);</span></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a><span class="co">CustomerEntity customer = retrievedResult.Result as CustomerEntity;</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a><span class="co">// NEW - Read Item</span></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>ItemResponse<span class="op">&lt;</span>Customer<span class="op">&gt;</span> response <span class="op">=</span> await container<span class="op">.</span><span class="fu">ReadItemAsync</span><span class="op">&lt;</span>Customer<span class="op">&gt;(</span></span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Doe#John"</span><span class="op">,</span> <span class="co">// Composite ID</span></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"Doe"</span><span class="op">));</span></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>Customer customer <span class="op">=</span> response<span class="op">.</span><span class="fu">Resource</span><span class="op">;</span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a><span class="co">// OLD - Query Entities</span></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a><span class="co">TableQuery&lt;CustomerEntity&gt; query = new TableQuery&lt;CustomerEntity&gt;()</span></span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a><span class="co">    .Where(TableQuery.GenerateFilterCondition("PartitionKey", QueryComparisons.Equal, "Doe"));</span></span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a><span class="co">TableContinuationToken token = null;</span></span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a><span class="co">var customers = new List&lt;CustomerEntity&gt;();</span></span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a><span class="co">do</span></span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a><span class="co">{</span></span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a><span class="co">    TableQuerySegment&lt;CustomerEntity&gt; segment = await table.ExecuteQuerySegmentedAsync(query, token);</span></span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a><span class="co">    customers.AddRange(segment.Results);</span></span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a><span class="co">    token = segment.ContinuationToken;</span></span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a><span class="co">} while (token != null);</span></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a><span class="co">// NEW - Query Items</span></span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a>QueryDefinition query <span class="op">=</span> <span class="kw">new</span> <span class="fu">QueryDefinition</span><span class="op">(</span></span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SELECT * FROM c WHERE c.PartitionKey = @partitionKey"</span><span class="op">)</span></span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">WithParameter</span><span class="op">(</span><span class="st">"@partitionKey"</span><span class="op">,</span> <span class="st">"Doe"</span><span class="op">);</span></span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a>FeedIterator<span class="op">&lt;</span>Customer<span class="op">&gt;</span> resultSet <span class="op">=</span> container<span class="op">.</span><span class="fu">GetItemQueryIterator</span><span class="op">&lt;</span>Customer<span class="op">&gt;(</span></span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a>    query<span class="op">,</span></span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a>    requestOptions<span class="op">:</span> <span class="kw">new</span> QueryRequestOptions</span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a>        PartitionKey <span class="op">=</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"Doe"</span><span class="op">)</span></span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a>List<span class="op">&lt;</span>Customer<span class="op">&gt;</span> customers <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>Customer<span class="op">&gt;();</span></span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="op">(</span>resultSet<span class="op">.</span><span class="fu">HasMoreResults</span><span class="op">)</span></span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb40-68"><a href="#cb40-68" aria-hidden="true" tabindex="-1"></a>    FeedResponse<span class="op">&lt;</span>Customer<span class="op">&gt;</span> response <span class="op">=</span> await resultSet<span class="op">.</span><span class="fu">ReadNextAsync</span><span class="op">();</span></span>
<span id="cb40-69"><a href="#cb40-69" aria-hidden="true" tabindex="-1"></a>    customers<span class="op">.</span><span class="fu">AddRange</span><span class="op">(</span>response<span class="op">);</span></span>
<span id="cb40-70"><a href="#cb40-70" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="path-3-from-windowsazure.storage-to-modern-options" class="level4">
<h4 class="anchored" data-anchor-id="path-3-from-windowsazure.storage-to-modern-options"><strong>Path 3: From WindowsAzure.Storage to Modern Options</strong></h4>
<p>If you’re coming from Azure Table Storage and want to access Cosmos DB:</p>
<p><strong>Option A: Stay with Table Storage using Azure.Data.Tables</strong></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">"Azure.Data.Tables"</span><span class="ot"> Version=</span><span class="st">"12.8.0"</span> /&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Option B: Migrate to Cosmos DB with Microsoft.Azure.Cosmos</strong></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">"Microsoft.Azure.Cosmos"</span><span class="ot"> Version=</span><span class="st">"3.37.0"</span> /&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The migration from <code>WindowsAzure.Storage</code> to <code>Azure.Data.Tables</code> is straightforward and maintains Table API semantics. However, migrating to Cosmos DB provides global distribution, better performance, and additional features.</p>
</section>
</section>
<section id="migration-decision-matrix" class="level3">
<h3 class="anchored" data-anchor-id="migration-decision-matrix">Migration Decision Matrix</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 23%">
<col style="width: 26%">
<col style="width: 17%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>Current SDK</th>
<th>Target Service</th>
<th>Recommended Path</th>
<th>Complexity</th>
<th>Benefits</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Microsoft.Azure.DocumentDB</strong></td>
<td>Cosmos DB SQL</td>
<td>→ <code>Microsoft.Azure.Cosmos</code></td>
<td>Medium</td>
<td>Modern API, Performance, Features</td>
</tr>
<tr class="even">
<td><strong>Microsoft.Azure.Cosmos.Table</strong></td>
<td>Cosmos DB Table</td>
<td>→ <code>Microsoft.Azure.Cosmos</code></td>
<td>High</td>
<td>Unified SDK, Better Performance</td>
</tr>
<tr class="odd">
<td><strong>Microsoft.Azure.Cosmos.Table</strong></td>
<td>Azure Table Storage</td>
<td>→ <code>Azure.Data.Tables</code></td>
<td>Low</td>
<td>Modern Table API, Simpler Migration</td>
</tr>
<tr class="even">
<td><strong>WindowsAzure.Storage</strong></td>
<td>Azure Table Storage</td>
<td>→ <code>Azure.Data.Tables</code></td>
<td>Low</td>
<td>Modern SDK, Better Performance</td>
</tr>
<tr class="odd">
<td><strong>WindowsAzure.Storage</strong></td>
<td>Cosmos DB</td>
<td>→ <code>Microsoft.Azure.Cosmos</code></td>
<td>High</td>
<td>Global Distribution, Advanced Features</td>
</tr>
</tbody>
</table>
</section>
<section id="key-migration-considerations" class="level3">
<h3 class="anchored" data-anchor-id="key-migration-considerations">Key Migration Considerations</h3>
<section id="data-model-changes" class="level4">
<h4 class="anchored" data-anchor-id="data-model-changes"><strong>1. Data Model Changes</strong></h4>
<ul>
<li><strong>Table API → SQL API</strong>: Convert <code>PartitionKey/RowKey</code> to composite <code>id</code> field</li>
<li><strong>Entity inheritance</strong>: Replace <code>TableEntity</code> base class with POCO models</li>
<li><strong>Property mapping</strong>: Handle special Table Storage types (byte arrays, etc.)</li>
</ul>
</section>
<section id="performance-implications" class="level4">
<h4 class="anchored" data-anchor-id="performance-implications"><strong>2. Performance Implications</strong></h4>
<ul>
<li><strong>Throughput provisioning</strong>: Cosmos DB uses RU/s instead of storage-based pricing</li>
<li><strong>Indexing</strong>: SQL API provides richer indexing than Table API</li>
<li><strong>Query patterns</strong>: SQL queries vs Table queries have different performance characteristics</li>
</ul>
</section>
<section id="feature-migration" class="level4">
<h4 class="anchored" data-anchor-id="feature-migration"><strong>3. Feature Migration</strong></h4>
<ul>
<li><strong>Authentication</strong>: Migrate from connection strings to AAD/Managed Identity</li>
<li><strong>Error handling</strong>: Update exception handling for new exception types</li>
<li><strong>Batch operations</strong>: Leverage bulk operations in modern SDKs</li>
<li><strong>Monitoring</strong>: Implement RU consumption monitoring</li>
</ul>
</section>
</section>
<section id="migration-benefits" class="level3">
<h3 class="anchored" data-anchor-id="migration-benefits">Migration Benefits</h3>
<p>Moving to <code>Microsoft.Azure.Cosmos</code> provides:</p>
<p>✅ <strong>Unified Experience</strong> - Single SDK for all Cosmos DB APIs<br>
✅ <strong>Better Performance</strong> - Optimized for modern async patterns<br>
✅ <strong>Advanced Features</strong> - Bulk operations, change feed, global distribution<br>
✅ <strong>Enhanced Authentication</strong> - AAD, Managed Identity, fine-grained access<br>
✅ <strong>Rich Diagnostics</strong> - Detailed metrics and performance insights<br>
✅ <strong>Future-Proof</strong> - Active development and new feature support</p>
</section>
<section id="support-timeline" class="level3">
<h3 class="anchored" data-anchor-id="support-timeline">Support Timeline</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 7%">
<col style="width: 21%">
<col style="width: 22%">
<col style="width: 25%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th>SDK</th>
<th>Final Version</th>
<th>End of Support</th>
<th>Security Updates</th>
<th>Recommendation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>Microsoft.Azure.DocumentDB</code></td>
<td>2.18.0</td>
<td>March 2020</td>
<td>❌ None</td>
<td>⚠️ Migrate immediately</td>
</tr>
<tr class="even">
<td><code>Microsoft.Azure.Cosmos.Table</code></td>
<td>1.0.8</td>
<td>August 2021</td>
<td>❌ None</td>
<td>⚠️ Migrate immediately</td>
</tr>
<tr class="odd">
<td><code>WindowsAzure.Storage</code></td>
<td>9.3.3</td>
<td>November 2023</td>
<td>❌ None</td>
<td>⚠️ Migrate immediately</td>
</tr>
<tr class="even">
<td><code>Azure.Data.Tables</code></td>
<td>Current</td>
<td>✅ Active</td>
<td>✅ Yes</td>
<td>✅ Use for Table Storage</td>
</tr>
<tr class="odd">
<td><code>Microsoft.Azure.Cosmos</code></td>
<td>Current</td>
<td>✅ Active</td>
<td>✅ Yes</td>
<td>✅ Use for Cosmos DB</td>
</tr>
</tbody>
</table>
<blockquote class="blockquote">
<p><strong>⚠️ Important</strong>: Microsoft will not provide security updates or bug fixes for legacy SDKs. Migration to <code>Microsoft.Azure.Cosmos</code> is strongly recommended for security and compatibility reasons.</p>
</blockquote>
</section>
</section>
<section id="useful-resources" class="level2">
<h2 class="anchored" data-anchor-id="useful-resources">Useful Resources</h2>
<ul>
<li><p><strong>Official Documentation</strong>: <a href="https://learn.microsoft.com/en-us/azure/cosmos-db/">Azure Cosmos DB Documentation</a><br> Comprehensive documentation covering Azure Cosmos DB concepts, capabilities, APIs, and service-level features. Essential for understanding provisioning models, consistency levels, indexing policies, and architectural considerations for designing Cosmos DB solutions.</p></li>
<li><p><strong>SDK Reference</strong>: <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.azure.cosmos">Microsoft.Azure.Cosmos SDK Reference</a><br> Complete API reference documentation for the Microsoft.Azure.Cosmos SDK, including all classes, methods, properties, and their signatures. Critical development resource for understanding method parameters, return types, exceptions, and proper usage patterns when writing Cosmos DB applications.</p></li>
<li><p><strong>Code Samples</strong>: <a href="https://github.com/Azure/azure-cosmos-dotnet-v3/tree/master/Microsoft.Azure.Cosmos.Samples">Azure Cosmos DB .NET SDK Samples</a><br> Official code samples demonstrating real-world implementation patterns, performance optimization techniques, and advanced scenarios like change feed processing and bulk operations. Provides practical examples of best practices, error handling, and common use cases.</p></li>
<li><p><strong>Performance Tips</strong>: <a href="https://learn.microsoft.com/en-us/azure/cosmos-db/nosql/performance-tips-dotnet-sdk">Performance Tips for Azure Cosmos DB</a><br> Expert guidance on optimizing your applications for maximum performance and cost-efficiency with Azure Cosmos DB, including connection management, query optimization, indexing strategies, and RU optimization techniques to ensure your applications run efficiently.</p></li>
<li><p><strong>Migration Guide</strong>: <a href="https://github.com/Azure/azure-cosmos-dotnet-v3/blob/master/Microsoft.Azure.Cosmos/MIGRATE.md">Migrating from DocumentDB SDK to Cosmos DB SDK</a><br> Detailed migration guide for transitioning from the legacy Microsoft.Azure.DocumentDB SDK to the modern Microsoft.Azure.Cosmos SDK, with code comparisons, breaking change explanations, and step-by-step migration strategies.</p></li>
</ul>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>The <strong>Microsoft.Azure.Cosmos</strong> SDK is the recommended approach for accessing Azure Cosmos DB from C#. It provides:</p>
<ul>
<li>✅ Modern async/await patterns for responsive applications</li>
<li>✅ Comprehensive support for all Cosmos DB SQL API features</li>
<li>✅ Better performance and throughput optimization</li>
<li>✅ Built-in retry logic and error handling</li>
<li>✅ Support for AAD and managed identity authentication</li>
<li>✅ Rich diagnostic information for monitoring and troubleshooting</li>
<li>✅ Optimized bulk operations for high-throughput scenarios</li>
<li>✅ Simplified change feed processing</li>
</ul>
<p>Azure Cosmos DB offers a globally distributed, multi-model database service with comprehensive SLAs for throughput, latency, availability, and consistency, making it ideal for modern cloud applications requiring global scale and low latency.</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<!-- Bootstrap Icons CDN - ensures icons are loaded -->

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">



<!-- Navbar and general icon fixes -->

<style>

/* Ensure icons display properly in navbar */

.navbar .bi {

    font-size: 1.2em;

    margin-right: 0.5rem;

}



/* Fix for missing icons in navigation */

.navbar-nav .nav-link {

    display: flex;

    align-items: center;

    gap: 0.5rem;

}



/* GitHub icon - ensure it shows properly */

.navbar-nav a[aria-label="GitHub Repository"] {

    display: flex;

    align-items: center;

}



.navbar-nav a[aria-label="GitHub Repository"]:before {

    content: "\F3ED";

    font-family: "bootstrap-icons" !important;

    font-size: 1.2em;

    display: inline-block;

}



/* Home icon for navbar */

.navbar-nav a[href="index.qmd"], 

.navbar-nav a[href="./index.qmd"] {

    display: flex;

    align-items: center;

}



.navbar-nav a[href="index.qmd"]:before, 

.navbar-nav a[href="./index.qmd"]:before {

    content: "\F425";

    font-family: "bootstrap-icons" !important;

    font-size: 1.1em;

    margin-right: 0.5rem;

    display: inline-block;

}



/* Enhanced typography for better readability */

.navbar-brand {

    font-weight: 600;

    letter-spacing: 0.02em;

}



/* Improve navigation appearance */

.navbar-nav .dropdown-menu {

    border-radius: 0.5rem;

    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);

}



/* Force icon font loading */

@font-face {

    font-family: 'bootstrap-icons';

    src: url('https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/fonts/bootstrap-icons.woff2') format('woff2'),

         url('https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/fonts/bootstrap-icons.woff') format('woff');

}

</style>



<script>

document.addEventListener('DOMContentLoaded', function() {

    console.log('Navbar fixes script loaded');

    

    // Wait for fonts to load

    setTimeout(function() {

        // Force add Bootstrap Icons CSS if not already loaded

        if (!document.querySelector('link[href*="bootstrap-icons"]')) {

            const link = document.createElement('link');

            link.rel = 'stylesheet';

            link.href = 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css';

            document.head.appendChild(link);

        }

        

        // Fix navbar icons

        const homeLink = document.querySelector('.navbar-nav a[href*="index"]');

        if (homeLink && !homeLink.querySelector('.bi')) {

            console.log('Adding home icon to navbar');

            const icon = document.createElement('i');

            icon.className = 'bi bi-house-fill';

            icon.style.marginRight = '0.5rem';

            homeLink.prepend(icon);

        }

        

        const githubLink = document.querySelector('.navbar-nav a[aria-label*="GitHub"]');

        if (githubLink && !githubLink.querySelector('.bi')) {

            console.log('Adding github icon to navbar');

            const icon = document.createElement('i');

            icon.className = 'bi bi-github';

            githubLink.prepend(icon);

        }

        

        // Fix any other icon elements that might need the .bi class

        const iconElements = document.querySelectorAll('[class*="bi-"]:not(.bi)');

        iconElements.forEach(el => {

            if (!el.classList.contains('bi')) {

                el.classList.add('bi');

            }

        });

        

    }, 1000);

});

</script>
<!-- Sidebar styling and fixes -->

<style>

/* Home link special styling - make it white and prominent */

.sidebar .nav-link[href="index.qmd"],

.sidebar .sidebar-item-text[href="index.qmd"],

.sidebar a[href="index.qmd"],

.sidebar-navigation .sidebar-item-text[href="index.qmd"],

#quarto-sidebar .sidebar-item-text[href="index.qmd"] {

  font-weight: 600 !important;

  font-size: 1.1rem !important;

  color: white !important;

  background: linear-gradient(135deg, #2780e3 0%, #1967d2 100%) !important;

  border: 2px solid #2780e3 !important;

  margin-bottom: 1rem !important;

  padding: 0.8rem 1rem !important;

  border-radius: 12px !important;

  box-shadow: 0 3px 8px rgba(39, 128, 227, 0.3) !important;

  transition: all 0.3s ease !important;

  display: block !important;

}



.sidebar .nav-link[href="index.qmd"]:hover,

.sidebar .sidebar-item-text[href="index.qmd"]:hover,

.sidebar a[href="index.qmd"]:hover,

.sidebar-navigation .sidebar-item-text[href="index.qmd"]:hover,

#quarto-sidebar .sidebar-item-text[href="index.qmd"]:hover {

  background: linear-gradient(135deg, #1967d2 0%, #1557b0 100%) !important;

  transform: translateX(3px) translateY(-1px) !important;

  box-shadow: 0 6px 16px rgba(39, 128, 227, 0.4) !important;

  border-color: #1967d2 !important;

  color: white !important;

}



/* Ensure sidebar icons work with emoji fallback */

.sidebar-navigation .sidebar-item-text {

    display: inline-flex;

    align-items: center;

}



/* Bootstrap Icons spacing fix - add margin between icon and text */

.sidebar .nav-link .bi,

.sidebar .sidebar-item-text .bi,

#quarto-sidebar .sidebar-item-text .bi {

  margin-right: 0.75rem !important;

  font-size: 1.1em !important;

}



/* General sidebar icon spacing */

.sidebar .nav-link i,

.sidebar .sidebar-item-text i,

#quarto-sidebar .sidebar-item-text i {

  margin-right: 0.75rem !important;

  font-size: 1.1em !important;

}



/* Force Bootstrap Icons to display with proper spacing in sidebar */

.sidebar .sidebar-item-text .bi::before,

#quarto-sidebar .sidebar-item-text .bi::before {

  margin-right: 0.75rem !important;

}



/* Section icons spacing */

.sidebar .sidebar-section > .nav-link .bi,

#quarto-sidebar .sidebar-section > .sidebar-item-text .bi {

  margin-right: 0.75rem !important;

}



/* Also target the Home icon specifically */

.sidebar .sidebar-item-text[href="index.qmd"] .bi-house-fill,

#quarto-sidebar .sidebar-item-text[href="index.qmd"] .bi-house-fill {

  color: white !important;

  margin-right: 0.75rem !important;

}

</style>



<script>

document.addEventListener('DOMContentLoaded', function() {

    console.log('Sidebar fixes script loaded');

    

    setTimeout(function() {

        // Fix sidebar Home link styling

        const sidebarHomeLinks = document.querySelectorAll(

            '.sidebar a[href*="index"], #quarto-sidebar a[href*="index"], .sidebar-item-text[href*="index"]'

        );

        sidebarHomeLinks.forEach(link => {

            if (link.textContent.trim().toLowerCase().includes('home')) {

                console.log('Applying white styling to Home link in sidebar');

                link.style.setProperty('color', 'white', 'important');

                link.style.setProperty('background', 'linear-gradient(135deg, #2780e3 0%, #1967d2 100%)', 'important');

                link.style.setProperty('border', '2px solid #2780e3', 'important');

                link.style.setProperty('border-radius', '12px', 'important');

                link.style.setProperty('padding', '0.8rem 1rem', 'important');

                link.style.setProperty('font-weight', '600', 'important');

                link.style.setProperty('box-shadow', '0 3px 8px rgba(39, 128, 227, 0.3)', 'important');

                link.style.setProperty('margin-bottom', '1rem', 'important');

                link.classList.add('home-link-styled');

                

                // Add home icon if missing

                if (!link.querySelector('.bi-house-fill')) {

                    const homeIcon = document.createElement('i');

                    homeIcon.className = 'bi bi-house-fill';

                    homeIcon.style.marginRight = '0.75rem';

                    homeIcon.style.color = 'white';

                    link.prepend(homeIcon);

                }

            }

        });

    }, 1000);

});

</script>
<div id="custom-right-nav" style="display: none;">

  <div class="toc-title">Related Pages</div>

  <nav class="toc" role="doc-toc">

    <ul>

      <li><em>Loading...</em></li>

    </ul>

  </nav>

</div>



<style>

/* Professional Related Pages navigation styling - RIGHT SIDEBAR ONLY */

#custom-right-nav {

  width: 100%;

  background: #f8f9fa;

  border: 1px solid #e9ecef;

  border-radius: 6px;

  padding: 12px;

  margin-top: 2rem; /* Add spacing from native TOC */

  font-size: 0.9rem;

  max-height: 60vh; /* Reduced from 70vh to leave space for native TOC */

  overflow-y: auto;

  scroll-behavior: smooth;

}



/* Ensure our custom nav doesn't interfere with native TOC styling */

#custom-right-nav.custom-navigation {

  background: #f0f8ff; /* Slightly different background to distinguish from native TOC */

  border-color: #2780e3;

}



#custom-right-nav .toc-title {

  font-weight: 600;

  font-size: 1rem;

  color: #2780e3;

  margin-bottom: 12px;

  padding-bottom: 6px;

  border-bottom: 2px solid #2780e3;

}



/* Ensure native TOC is not affected by our styles */

#TOC, 

.table-of-contents:not(#custom-right-nav .table-of-contents),

nav[role="doc-toc"]:not(#custom-right-nav nav) {

  margin-bottom: 1rem !important;

}

</style>



<script>

document.addEventListener('DOMContentLoaded', function() {

  console.log('📋 Related Pages navigation loading...');

  

  // Handle responsive layout function

  function handleResponsiveLayout() {

    const customNav = document.querySelector('#custom-right-nav');

    if (!customNav) {

      console.log('🔍 handleResponsiveLayout: customNav not found');

      return;

    }

    

    // FIXED: Also ensure native TOC is preserved during responsive changes

    const nativeToc = document.querySelector('#TOC, .table-of-contents, nav[role="doc-toc"]:not(#custom-right-nav nav)');

    if (nativeToc) {

      console.log('🔍 handleResponsiveLayout: preserving native TOC visibility');

      // Don't hide native TOC on mobile - let Quarto handle that

    }

    

    const isMobile = window.innerWidth <= 800;

    console.log(`📱 handleResponsiveLayout: width=${window.innerWidth}, isMobile=${isMobile}, hasContent=${customNav.classList.contains('has-content')}`);

    

    if (isMobile) {

      customNav.style.display = 'none';

      console.log('📱 Hidden custom nav on mobile');

    } else if (customNav.classList.contains('has-content')) {

      customNav.style.display = 'block';

      console.log('💻 Showing custom nav on desktop with content');

    } else {

      console.log('💻 Desktop but no content class found');

      // Force show for debugging

      customNav.style.display = 'block';

    }

  }

  

  // Multiple initialization strategies to ensure it works across all page types

  function initializeRightNav() {

    console.log('🚀 Initializing right navigation...');

    

    // FIXED: Wait a bit longer to ensure Quarto's native TOC is fully initialized

    setTimeout(() => {

      createCustomRightNav();

      handleResponsiveLayout();

      

      // Additional attempt after a short delay for any page type

      setTimeout(() => {

        renderRightNav();

      }, 200);

    }, 300);

  }

  

  // Try immediately for any page

  initializeRightNav();

  

  // FIXED: Wait longer for Quarto to finish loading to avoid TOC conflicts

  setTimeout(initializeRightNav, 1000);

  

  // Also try when the page is fully loaded (universal)

  window.addEventListener('load', function() {

    console.log('📄 Page fully loaded, attempting right nav render...');

    setTimeout(function() {

      if (!document.querySelector('#custom-right-nav.has-content')) {

        console.log('🔄 Right nav not yet rendered, trying again...');

        createCustomRightNav();

      }

      renderRightNav();

    }, 500);

  });

  

  // Universal fallback after page load for any menu structure

  setTimeout(() => {

    console.log('⏰ Final fallback attempt for right nav...');

    renderRightNav();

  }, 2000);

  

  // Handle window resize (universal)

  window.addEventListener('resize', handleResponsiveLayout);

  

  // Dynamic navigation structure - reads from Quarto's rendered sidebar

  function extractNavigationFromSidebar() {

    const sidebar = document.querySelector('#quarto-sidebar');

    if (!sidebar) {

      console.log('❌ Sidebar not found');

      return null;

    }

    

    // Look for the main sidebar content structure - IMPROVED selectors

    const sidebarContent = sidebar.querySelector('.sidebar-menu-container, .sidebar-content, .sidebar-navigation, .sidebar-menu');

    if (!sidebarContent) {

      console.log('❌ Sidebar content not found, available classes:', sidebar.className);

      console.log('❌ Sidebar children:', Array.from(sidebar.children).map(c => c.className).join(', '));

      // Fallback: try to use the sidebar itself

      return extractItemsDirectly(sidebar);

    }

    

    console.log('✅ Found sidebar content:', sidebarContent.className);

    return extractItemsDirectly(sidebarContent);

  }



  // Extract navigation items directly from container

  function extractItemsDirectly(container) {

    const items = [];

    

    // Find all navigation items recursively with proper level tracking

    function extractItems(element, level = 0) {

      const childItems = [];

      const directChildren = Array.from(element.children);

      

      directChildren.forEach(child => {

        // Look for sidebar items at any level

        if (child.classList.contains('sidebar-item') || 

            child.classList.contains('sidebar-item-container') ||

            child.classList.contains('sidebar-section')) {

          const item = extractSidebarItem(child, level);

          if (item) {

            childItems.push(item);

          }

        } else if (child.tagName === 'UL' || child.tagName === 'OL') {

          // Handle list structures

          const listItems = extractItems(child, level);

          childItems.push(...listItems);

        } else if (child.children.length > 0) {

          // Recurse into other containers

          const nestedItems = extractItems(child, level);

          childItems.push(...nestedItems);

        }

      });

      

      return childItems;

    }

    

    function extractSidebarItem(itemElement, level) {

      const textElement = itemElement.querySelector('.sidebar-item-text');

      if (!textElement) return null;

      

      const item = {

        text: textElement.textContent.trim(),

        level: level,

        href: textElement.getAttribute('href'),

        isSection: !textElement.hasAttribute('href') || textElement.getAttribute('href') === '#',

        children: []

      };

      

      // FIXED: More comprehensive child container detection

      const childContainers = itemElement.querySelectorAll(':scope > .sidebar-item-container, :scope > .sidebar-section, :scope > ul, :scope > .sidebar-items, :scope > div[class*="sidebar"]');

      

      childContainers.forEach(childContainer => {

        // Extract children at the next level

        const childItems = extractItems(childContainer, level + 1);

        item.children.push(...childItems);

      });

      

      // Also check for nested sidebar items directly under this item (alternative structure)

      const directNestedItems = itemElement.querySelectorAll(':scope .sidebar-item');

      directNestedItems.forEach(nestedItem => {

        if (nestedItem !== itemElement) { // Avoid self-reference

          const nestedItemData = extractSidebarItem(nestedItem, level + 1);

          if (nestedItemData && !item.children.some(child => child.text === nestedItemData.text)) {

            item.children.push(nestedItemData);

          }

        }

      });

      

      console.log(`📝 Extracted item: "${item.text}" (level ${level}, ${item.children.length} children, isSection: ${item.isSection}, href: ${item.href})`);

      

      // Additional debug info for items with children

      if (item.children.length > 0) {

        console.log(`   📂 Children of "${item.text}":`, item.children.map(c => `"${c.text}"`).join(', '));

      }

      

      return item;

    }

    

    const allItems = extractItems(container, 0);

    console.log('📊 Total extracted navigation items:', allItems.length);

    

    return allItems;

  }



  // Find current page in navigation structure

  function findCurrentPageInNav(items, currentPath) {

    if (!items || items.length === 0) return null;

    

    const normalizedCurrentPath = currentPath.toLowerCase().replace(/\\/g, '/');

    

    console.log('🔍 Searching for path:', normalizedCurrentPath);

    

    function searchItems(itemList, parentChain = []) {

      for (const item of itemList) {

        if (item.href) {

          const itemHref = item.href.toLowerCase().replace(/\\/g, '/').replace('.md', '');

          

          // Generic matching strategies - no filename assumptions

          const isExactMatch = normalizedCurrentPath === itemHref;

          const isContainedMatch = normalizedCurrentPath.includes(itemHref) || itemHref.includes(normalizedCurrentPath);

          const isFilenameMatch = normalizedCurrentPath.endsWith(itemHref.split('/').pop());

          

          // Generic path-based matching - works for any file in same directory

          const isSameDirectoryMatch = (

            normalizedCurrentPath.split('/').slice(0, -1).join('/') === 

            itemHref.split('/').slice(0, -1).join('/')

          ) && (

            // Only match if the filenames are related (same base name or common patterns)

            normalizedCurrentPath.split('/').pop().replace(/\.(html|md)$/, '') === 

            itemHref.split('/').pop().replace(/\.(html|md)$/, '') ||

            // Or if one contains the other (like "summary" in "project-summary")

            normalizedCurrentPath.split('/').pop().includes(itemHref.split('/').pop()) ||

            itemHref.split('/').pop().includes(normalizedCurrentPath.split('/').pop())

          );

          

          const isMatch = isExactMatch || isContainedMatch || isFilenameMatch || isSameDirectoryMatch;

          

          if (isMatch) {

            console.log('🎯 Found current page: "' + item.text + '"');

            console.log('   📄 Current path: ' + normalizedCurrentPath);

            console.log('   🔗 Item href: ' + itemHref);

            console.log('   ✅ Match type: ' + (isExactMatch ? 'exact' : isContainedMatch ? 'contained' : isFilenameMatch ? 'filename' : 'same-directory'));

            

            // FIXED: For leaf nodes, determine siblings correctly

            // If this item has no children, its siblings are other items at the same level

            let siblings = [];

            let children = item.children || [];

            

            if (children.length === 0) {

              // This is a leaf node - find its siblings

              // Siblings are other items in the same itemList (at the same hierarchical level)

              siblings = itemList.filter(sibling => 

                sibling !== item && // Not the current item

                sibling.href && // Has a valid link

                sibling.href !== '#' // Not just a placeholder

              );

              

              console.log(`📄 Leaf node "${item.text}" has ${siblings.length} siblings at level ${item.level || 0}`);

              console.log('📄 Siblings:', siblings.map(s => `"${s.text}"`).join(', '));

            } else {

              // This is a section node - children are already available

              // Filter children to only include those with valid links

              const validChildren = children.filter(child => 

                child.href && child.href !== '#'

              );

              

              console.log(`📂 Section node "${item.text}" has ${validChildren.length} valid children`);

              console.log('📂 Children:', validChildren.map(c => `"${c.text}"`).join(', '));

              

              // For consistency, we'll use siblings array to store what should be shown

              // Even though they're technically children, this simplifies the downstream logic

              siblings = validChildren;

            }

            

            return {

              currentItem: item,

              parentChain: parentChain,

              siblings: siblings, // This contains either siblings or children depending on node type

              children: children,  // Always contains the original children for reference

              isLeafNode: children.length === 0

            };

          }

        }

        

        // Search in children

        if (item.children && item.children.length > 0) {

          const result = searchItems(item.children, [...parentChain, item]);

          if (result) return result;

        }

      }

      

      return null;

    }



    return searchItems(items);

  }

  

  function createCustomRightNav() {

    console.log('🏗️ Creating custom right nav...');

    console.log('🏗️ Current URL:', window.location.href);

    console.log('🏗️ Page width:', window.innerWidth);

    

    // Try multiple container strategies for right sidebar with more debugging

    const containerSelectors = [

      '#quarto-margin-sidebar',

      '.margin-sidebar', 

      '#quarto-sidebar-toc',

      '.toc-right',

      '.page-columns .margin-sidebar',

      '[class*="margin"]',

      '.page-layout-article .margin-sidebar'

    ];

    

    console.log('🔍 Searching for right sidebar containers...');

    

    let targetContainer = null;

    for (const selector of containerSelectors) {

      const found = document.querySelector(selector);

      console.log(`   Testing selector "${selector}":`, !!found);

      if (found) {

        targetContainer = found;

        console.log('✅ Found right sidebar container:', selector);

        console.log('✅ Container classes:', found.className);

        console.log('✅ Container ID:', found.id);

        break;

      }

    }



    if (!targetContainer) {

      console.log('❌ Right sidebar container not found. Available page structure:');

      console.log('   Body classes:', document.body.className);

      console.log('   HTML classes:', document.documentElement.className);

      

      // Try to find any element that might be the right sidebar

      const allSidebarCandidates = document.querySelectorAll('[class*="sidebar"], [class*="margin"], [class*="toc"], [id*="sidebar"], [id*="margin"], [id*="toc"]');

      console.log('   Found potential containers:', Array.from(allSidebarCandidates).map(el => `${el.tagName}.${el.className}#${el.id}`));

      

      // As a last resort, try to append to body

      console.log('⚠️ Attempting to create right sidebar container...');

      const rightSidebarContainer = document.createElement('div');

      rightSidebarContainer.id = 'custom-margin-sidebar';

      rightSidebarContainer.style.cssText = `

        position: fixed;

        right: 20px;

        top: 100px;

        width: 250px;

        max-height: 60vh;

        overflow-y: auto;

        z-index: 1000;

        background: white;

        border: 1px solid #ddd;

        border-radius: 6px;

        padding: 10px;

        box-shadow: 0 2px 10px rgba(0,0,0,0.1);

      `;

      document.body.appendChild(rightSidebarContainer);

      targetContainer = rightSidebarContainer;

      console.log('✅ Created fallback right sidebar container');

    }



    // Check if custom nav already exists

    const existing = document.querySelector('#custom-right-nav');

    if (existing) {

      console.log('🔄 Removing existing custom nav');

      existing.remove();

    }



    // FIXED: Check if there's already a native Quarto TOC and preserve it

    const existingToc = targetContainer.querySelector('#TOC, .table-of-contents, nav[role="doc-toc"]:not(#custom-right-nav nav), .toc:not(#custom-right-nav .toc)');

    console.log('🔍 Found existing TOC:', !!existingToc);

    if (existingToc) {

      console.log('✅ Preserving existing Quarto TOC:', existingToc.className, existingToc.id);

      

      // Make sure the existing TOC is visible and properly styled

      existingToc.style.display = '';

      existingToc.style.visibility = '';

    }



    // Create the custom nav element with proper styling

    const customNav = document.createElement('div');

    customNav.id = 'custom-right-nav';

    customNav.className = 'toc-right custom-navigation'; // Added custom class for distinction

    customNav.innerHTML = `

      <div class="toc-title">Related Pages</div>

      <nav class="toc" role="doc-toc">

        <ul>

          <li><em>Loading...</em></li>

        </ul>

      </nav>

    `;



    // FIXED: Insert AFTER the existing TOC, not before or instead of it

    if (existingToc) {

      // Add some spacing between TOCs

      customNav.style.marginTop = '2rem';

      existingToc.parentNode.insertBefore(customNav, existingToc.nextSibling);

      console.log('✅ Inserted custom nav AFTER existing TOC to preserve native functionality');

    } else {

      targetContainer.appendChild(customNav);

      console.log('✅ Appended custom nav to container (no existing TOC found)');

    }



    console.log('✅ Custom nav created and added to DOM');

    

    // FIXED: Don't force show immediately - let the responsive handler decide

    // customNav.style.display = 'block';

    // customNav.style.visibility = 'visible';



    // Now render the navigation

    setTimeout(() => {

      console.log('⏰ About to render right nav content...');

      renderRightNav();

    }, 100);

  }



  // Get current page path, accounting for different environments

  function getCurrentPagePath() {

    let path = window.location.pathname;

    

    // Handle different URL structures

    if (path === '/' || path === '') {

      return 'index';

    }

    

    // Remove leading slash and decode URI components

    path = path.replace(/^\//, '');

    try {

      path = decodeURIComponent(path);

    } catch (e) {

      // If decoding fails, use original path

      console.log('⚠️ URI decoding failed, using original path');

    }

    

    // Convert .html back to source file extensions for matching

    path = path.replace('.html', '');

    

    console.log('📍 Current path detected:', path);

    return path;

  }

  

  // Find the relevant section for the current page

  function findCurrentSection(currentPath) {

    console.log('🔍 Looking for section for path:', currentPath);

    

    // Handle home page special case

    if (!currentPath || currentPath === '/' || currentPath === '' || currentPath === 'index') {

      return {

        sectionName: 'Home',

        subsectionName: 'Quick Navigation',

        subsectionData: {

          pages: []

        }

      };

    }

    

    // Normalize current path for matching

    const normalizedPath = currentPath.toLowerCase().replace(/\\/g, '/');

    

    const navData = extractNavigationFromSidebar();

    if (!navData) {

      console.log('❌ No navigation data available');

      return null;

    }

    

    // Try to find the current section by analyzing the navigation data

    for (const item of navData) {

      // Check if this item matches the current path

      if (item.href && normalizedPath === item.href.toLowerCase().replace(/\\/g, '/').replace('.md', '')) {

        console.log('✅ Current section found in navigation:', item.text);

        

        return {

          sectionName: item.text,

          subsectionName: null,

          subsectionData: null

        };

      }

      

      // Check in children recursively

      const result = findSectionInChildren(item.children, normalizedPath);

      if (result) {

        return result;

      }

    }

    

    console.log('❌ Current section not found in navigation');

    return null;

  }



  // Recursive helper to find section in children

  function findSectionInChildren(children, path) {

    for (const child of children) {

      // Check if this child matches the path

      if (child.href && path === child.href.toLowerCase().replace(/\\/g, '/').replace('.md', '')) {

        console.log('✅ Current subsection found in navigation:', child.text);

        

        return {

          sectionName: child.text,

          subsectionName: null,

          subsectionData: null

        };

      }

      

      // Recurse into deeper children

      const result = findSectionInChildren(child.children, path);

      if (result) {

        return result;

      }

    }

    

    return null;

  }

  

  // Render the right navigation based on the extracted items

  function renderRightNav() {

    const navItems = extractNavigationFromSidebar();

    if (!navItems) return;

    

    const customNav = document.querySelector('#custom-right-nav');

    if (!customNav) return;

    

    const currentPath = getCurrentPagePath();

    const currentNavItem = findCurrentPageInNav(navItems, currentPath);

    

    // Mark the current item and its parents as active

    function markActiveItems(item, isActive = false) {

      if (!item) return isActive;

      

      const itemElement = document.querySelector(`#custom-right-nav [href="${item.href}"]`);

      if (itemElement) {

        itemElement.classList.add('active');

        isActive = true;

      }

      

      // Also mark parents as active (for nested items)

      if (item.parent) {

        markActiveItems(item.parent, isActive);

      }

      

      return isActive;

    }

    

    // Clear existing content and render the new navigation

    function renderItemsList(container, items, level = 0) {

      container.innerHTML = '';

      

      if (!items || items.length === 0) {

        container.innerHTML = '<li><em>No related pages found</em></li>';

        return;

      }

      

      const list = document.createElement('ul');

      list.className = 'nav-list';

      

      items.forEach(item => {

        const listItem = document.createElement('li');

        listItem.className = 'nav-item';

        

        // Link element

        const link = document.createElement('a');

        link.href = item.href || '#';

        link.textContent = item.text;

        link.className = 'nav-link';

        

        // Active class for current item

        if (currentNavItem && currentNavItem.currentItem && currentNavItem.currentItem.text === item.text) {

          link.classList.add('active');

        }

        

        link.addEventListener('click', function(e) {

          // Prevent default if it's just a placeholder

          if (item.href === '#' || !item.href) {

            e.preventDefault();

          }

        });

        

        listItem.appendChild(link);

        

        // Recursively render children if they exist

        if (item.children && item.children.length > 0) {

          const childContainer = document.createElement('div');

          childContainer.className = 'child-nav-container';

          renderItemsList(childContainer, item.children, level + 1);

          listItem.appendChild(childContainer);

        }

        

        list.appendChild(listItem);

      });

      

      container.appendChild(list);

    }

    

    const navContainer = customNav.querySelector('.toc > ul');

    if (navContainer) {

      // Clear existing content

      navContainer.innerHTML = '';

      

      if (currentNavItem) {

        // Show current item and its siblings/children

        const { currentItem, siblings, children } = currentNavItem;

        

        renderItemsList(navContainer, siblings || children);

        

        // Mark the current item as active

        markActiveItems(currentItem);

      } else {

        // Just render the top-level items

        renderItemsList(navContainer, navItems);

      }

    }

    

    customNav.classList.add('has-content');

    handleResponsiveLayout();

    

    // Debugging output

    console.log('📜 Navigation rendered:', navItems);

  }

  

  // Initial right navigation setup

  setTimeout(() => {

    createCustomRightNav();

  }, 1000);

});

</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/darioairoldi\.github\.io\/Learn");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb43" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Azure CosmosDB Access with C#</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>**Azure Cosmos DB** is a fully managed NoSQL database service that provides **global distribution, elastic scaling, and multi-model support** with comprehensive SLAs for throughput, latency, availability, and consistency. It offers multiple APIs including **SQL (Core)**, **MongoDB**, **Cassandra**, **Gremlin**, and **Table**, making it highly versatile for various application patterns.</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">## Table of Contents</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Overview</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Available Approaches</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>SQL API (Core)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>MongoDB API</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Other APIs</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Key Libraries</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Primary Library</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Supporting Libraries</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Basic Operations</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Setting Up a Cosmos Client</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Managing Databases and Containers</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Working with Items</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>CRUD Operations</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Query (Read)</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Create</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Update</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Delete</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Advanced Patterns</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Bulk Operations</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Change Feed Processing</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Server-Side Programming</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Retry Policies</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Dependency Injection Setup</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>Authentication Approaches</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>Migration from Legacy SDK</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a><span class="ss">9. </span>Useful Resources</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a><span class="ss">10. </span>Summary</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a><span class="fu">## Available Approaches</span></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1. **SQL API (Core)**</span></span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Native JSON document model** with rich &lt;mark&gt;SQL querying&lt;/mark&gt; capabilities</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Recommended for new applications with flexible schema requirements</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Primary C# SDK**: &lt;mark&gt;<span class="in">`Microsoft.Azure.Cosmos`</span>&lt;/mark&gt;</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Best performance and feature support</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2. **MongoDB API**</span></span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>&lt;mark&gt;MongoDB-compatible API&lt;/mark&gt; for existing MongoDB applications</span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use standard MongoDB drivers and tools</span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>No code changes required for MongoDB applications</span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**C# SDK**: MongoDB .NET Driver</span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3. **Other APIs**</span></span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Cassandra API**: For existing Cassandra workloads (&lt;mark&gt;CassandraCSharpDriver&lt;/mark&gt;)</span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Gremlin API**: For graph databases (&lt;mark&gt;Gremlin.Net&lt;/mark&gt;)</span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Table API**: For Table Storage compatibility</span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Recommended**: Use unified &lt;mark&gt;<span class="in">`Microsoft.Azure.Cosmos`</span>&lt;/mark&gt; SDK </span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Alternative**: &lt;mark&gt;<span class="in">`Azure.Data.Tables`</span>&lt;/mark&gt; for Azure Table Storage</span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**Deprecated (⚠️)**: &lt;mark&gt;<span class="in">`Microsoft.Azure.Cosmos.Table`</span>&lt;/mark&gt; (discontinued)</span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a><span class="fu">## Key Libraries</span></span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-60"><a href="#cb43-60" aria-hidden="true" tabindex="-1"></a><span class="fu">### Primary Library</span></span>
<span id="cb43-61"><a href="#cb43-61" aria-hidden="true" tabindex="-1"></a><span class="in">```xml</span></span>
<span id="cb43-62"><a href="#cb43-62" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- For SQL API (Recommended) --&gt;</span></span>
<span id="cb43-63"><a href="#cb43-63" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">"Microsoft.Azure.Cosmos"</span><span class="ot"> Version=</span><span class="st">"3.37.0"</span> /&gt;</span>
<span id="cb43-64"><a href="#cb43-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-65"><a href="#cb43-65" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- For MongoDB API --&gt;</span></span>
<span id="cb43-66"><a href="#cb43-66" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">"MongoDB.Driver"</span><span class="ot"> Version=</span><span class="st">"2.22.0"</span> /&gt;</span>
<span id="cb43-67"><a href="#cb43-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-68"><a href="#cb43-68" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- For Table API (if not using unified Cosmos SDK) --&gt;</span></span>
<span id="cb43-69"><a href="#cb43-69" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">"Azure.Data.Tables"</span><span class="ot"> Version=</span><span class="st">"12.8.0"</span> /&gt;</span>
<span id="cb43-70"><a href="#cb43-70" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-71"><a href="#cb43-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-72"><a href="#cb43-72" aria-hidden="true" tabindex="-1"></a><span class="fu">### **Deprecated Libraries ⚠️ (Do Not Use)**</span></span>
<span id="cb43-73"><a href="#cb43-73" aria-hidden="true" tabindex="-1"></a><span class="in">```xml</span></span>
<span id="cb43-74"><a href="#cb43-74" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">DEPRECATED</span><span class="co">: Legacy SQL API SDK --&gt;</span></span>
<span id="cb43-75"><a href="#cb43-75" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- &lt;PackageReference Include="Microsoft.Azure.DocumentDB" Version="2.x.x" /&gt; --&gt;</span></span>
<span id="cb43-76"><a href="#cb43-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-77"><a href="#cb43-77" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">DEPRECATED</span><span class="co">: Legacy Table API SDK --&gt;</span></span>
<span id="cb43-78"><a href="#cb43-78" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- &lt;PackageReference Include="Microsoft.Azure.Cosmos.Table" Version="1.x.x" /&gt; --&gt;</span></span>
<span id="cb43-79"><a href="#cb43-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-80"><a href="#cb43-80" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">DEPRECATED</span><span class="co">: Original Table Storage SDK --&gt;</span></span>
<span id="cb43-81"><a href="#cb43-81" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- &lt;PackageReference Include="WindowsAzure.Storage" Version="9.x.x" /&gt; --&gt;</span></span>
<span id="cb43-82"><a href="#cb43-82" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-83"><a href="#cb43-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-84"><a href="#cb43-84" aria-hidden="true" tabindex="-1"></a><span class="fu">### Supporting Libraries (Optional)</span></span>
<span id="cb43-85"><a href="#cb43-85" aria-hidden="true" tabindex="-1"></a><span class="in">```xml</span></span>
<span id="cb43-86"><a href="#cb43-86" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- For dependency injection --&gt;</span></span>
<span id="cb43-87"><a href="#cb43-87" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">"Microsoft.Extensions.DependencyInjection"</span><span class="ot"> Version=</span><span class="st">"7.0.0"</span> /&gt;</span>
<span id="cb43-88"><a href="#cb43-88" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">"Microsoft.Extensions.Configuration"</span><span class="ot"> Version=</span><span class="st">"7.0.0"</span> /&gt;</span>
<span id="cb43-89"><a href="#cb43-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-90"><a href="#cb43-90" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- For managed identity authentication --&gt;</span></span>
<span id="cb43-91"><a href="#cb43-91" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">"Azure.Identity"</span><span class="ot"> Version=</span><span class="st">"1.10.4"</span> /&gt;</span>
<span id="cb43-92"><a href="#cb43-92" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-93"><a href="#cb43-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-94"><a href="#cb43-94" aria-hidden="true" tabindex="-1"></a><span class="fu">## Basic Operations</span></span>
<span id="cb43-95"><a href="#cb43-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-96"><a href="#cb43-96" aria-hidden="true" tabindex="-1"></a><span class="fu">### Setting Up a Cosmos Client</span></span>
<span id="cb43-97"><a href="#cb43-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-98"><a href="#cb43-98" aria-hidden="true" tabindex="-1"></a>The **CosmosClient class** is the primary interface for interacting with Azure Cosmos DB SQL API. It provides a thread-safe client that manages connections, handles retries, and implements the Azure Cosmos DB protocol.</span>
<span id="cb43-99"><a href="#cb43-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-100"><a href="#cb43-100" aria-hidden="true" tabindex="-1"></a><span class="al">![alt text](&lt;images/001.01 CosmosClientClass.png&gt;)</span></span>
<span id="cb43-101"><a href="#cb43-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-102"><a href="#cb43-102" aria-hidden="true" tabindex="-1"></a><span class="in">```csharp</span></span>
<span id="cb43-103"><a href="#cb43-103" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span><span class="op">;</span></span>
<span id="cb43-104"><a href="#cb43-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-105"><a href="#cb43-105" aria-hidden="true" tabindex="-1"></a><span class="co">// Connection using endpoint and key (basic example)</span></span>
<span id="cb43-106"><a href="#cb43-106" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> endpoint <span class="op">=</span> <span class="st">"https://your-account.documents.azure.com:443/"</span><span class="op">;</span></span>
<span id="cb43-107"><a href="#cb43-107" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> key <span class="op">=</span> <span class="st">"your-primary-key"</span><span class="op">;</span></span>
<span id="cb43-108"><a href="#cb43-108" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> cosmosClient <span class="op">=</span> <span class="kw">new</span> <span class="fu">CosmosClient</span><span class="op">(</span>endpoint<span class="op">,</span> key<span class="op">,</span> <span class="kw">new</span> CosmosClientOptions</span>
<span id="cb43-109"><a href="#cb43-109" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-110"><a href="#cb43-110" aria-hidden="true" tabindex="-1"></a>    ConnectionMode <span class="op">=</span> ConnectionMode<span class="op">.</span><span class="fu">Direct</span><span class="op">,</span></span>
<span id="cb43-111"><a href="#cb43-111" aria-hidden="true" tabindex="-1"></a>    SerializerOptions <span class="op">=</span> <span class="kw">new</span> CosmosSerializationOptions</span>
<span id="cb43-112"><a href="#cb43-112" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-113"><a href="#cb43-113" aria-hidden="true" tabindex="-1"></a>        PropertyNamingPolicy <span class="op">=</span> CosmosPropertyNamingPolicy<span class="op">.</span><span class="fu">CamelCase</span></span>
<span id="cb43-114"><a href="#cb43-114" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb43-115"><a href="#cb43-115" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span>
<span id="cb43-116"><a href="#cb43-116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-117"><a href="#cb43-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-118"><a href="#cb43-118" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Key CosmosClientOptions</span></span>
<span id="cb43-119"><a href="#cb43-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-120"><a href="#cb43-120" aria-hidden="true" tabindex="-1"></a>The CosmosClient behavior can be customized with CosmosClientOptions:</span>
<span id="cb43-121"><a href="#cb43-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-122"><a href="#cb43-122" aria-hidden="true" tabindex="-1"></a><span class="in">```csharp</span></span>
<span id="cb43-123"><a href="#cb43-123" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> clientOptions <span class="op">=</span> <span class="kw">new</span> CosmosClientOptions</span>
<span id="cb43-124"><a href="#cb43-124" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-125"><a href="#cb43-125" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Performance options</span></span>
<span id="cb43-126"><a href="#cb43-126" aria-hidden="true" tabindex="-1"></a>    ConnectionMode <span class="op">=</span> ConnectionMode<span class="op">.</span><span class="fu">Direct</span><span class="op">,</span> <span class="co">// Direct for better performance</span></span>
<span id="cb43-127"><a href="#cb43-127" aria-hidden="true" tabindex="-1"></a>    ApplicationName <span class="op">=</span> <span class="st">"YourApplication"</span><span class="op">,</span></span>
<span id="cb43-128"><a href="#cb43-128" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-129"><a href="#cb43-129" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Consistency level</span></span>
<span id="cb43-130"><a href="#cb43-130" aria-hidden="true" tabindex="-1"></a>    ConsistencyLevel <span class="op">=</span> ConsistencyLevel<span class="op">.</span><span class="fu">Session</span><span class="op">,</span> <span class="co">// Default</span></span>
<span id="cb43-131"><a href="#cb43-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-132"><a href="#cb43-132" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Regional preferences</span></span>
<span id="cb43-133"><a href="#cb43-133" aria-hidden="true" tabindex="-1"></a>    ApplicationRegion <span class="op">=</span> <span class="st">"West US 2"</span><span class="op">,</span></span>
<span id="cb43-134"><a href="#cb43-134" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-135"><a href="#cb43-135" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Serialization</span></span>
<span id="cb43-136"><a href="#cb43-136" aria-hidden="true" tabindex="-1"></a>    SerializerOptions <span class="op">=</span> <span class="kw">new</span> CosmosSerializationOptions</span>
<span id="cb43-137"><a href="#cb43-137" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-138"><a href="#cb43-138" aria-hidden="true" tabindex="-1"></a>        PropertyNamingPolicy <span class="op">=</span> CosmosPropertyNamingPolicy<span class="op">.</span><span class="fu">CamelCase</span><span class="op">,</span></span>
<span id="cb43-139"><a href="#cb43-139" aria-hidden="true" tabindex="-1"></a>        IgnoreNullValues <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb43-140"><a href="#cb43-140" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb43-141"><a href="#cb43-141" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-142"><a href="#cb43-142" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Resilience</span></span>
<span id="cb43-143"><a href="#cb43-143" aria-hidden="true" tabindex="-1"></a>    MaxRetryAttemptsOnRateLimitedRequests <span class="op">=</span> <span class="dv">9</span><span class="op">,</span></span>
<span id="cb43-144"><a href="#cb43-144" aria-hidden="true" tabindex="-1"></a>    MaxRetryWaitTimeOnRateLimitedRequests <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromSeconds</span><span class="op">(</span><span class="dv">30</span><span class="op">)</span></span>
<span id="cb43-145"><a href="#cb43-145" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb43-146"><a href="#cb43-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-147"><a href="#cb43-147" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> cosmosClient <span class="op">=</span> <span class="kw">new</span> <span class="fu">CosmosClient</span><span class="op">(</span>endpoint<span class="op">,</span> key<span class="op">,</span> clientOptions<span class="op">);</span></span>
<span id="cb43-148"><a href="#cb43-148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-149"><a href="#cb43-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-150"><a href="#cb43-150" aria-hidden="true" tabindex="-1"></a><span class="fu">### Managing Databases and Containers</span></span>
<span id="cb43-151"><a href="#cb43-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-152"><a href="#cb43-152" aria-hidden="true" tabindex="-1"></a><span class="in">```csharp</span></span>
<span id="cb43-153"><a href="#cb43-153" aria-hidden="true" tabindex="-1"></a><span class="co">// Create or get a database</span></span>
<span id="cb43-154"><a href="#cb43-154" aria-hidden="true" tabindex="-1"></a>Database database <span class="op">=</span> await cosmosClient<span class="op">.</span><span class="fu">CreateDatabaseIfNotExistsAsync</span><span class="op">(</span><span class="st">"MyDatabase"</span><span class="op">);</span></span>
<span id="cb43-155"><a href="#cb43-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-156"><a href="#cb43-156" aria-hidden="true" tabindex="-1"></a><span class="co">// Create container with RU/s provisioning and partition key</span></span>
<span id="cb43-157"><a href="#cb43-157" aria-hidden="true" tabindex="-1"></a>ContainerProperties containerProperties <span class="op">=</span> <span class="kw">new</span> ContainerProperties</span>
<span id="cb43-158"><a href="#cb43-158" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-159"><a href="#cb43-159" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="st">"MyContainer"</span><span class="op">,</span></span>
<span id="cb43-160"><a href="#cb43-160" aria-hidden="true" tabindex="-1"></a>    PartitionKeyPath <span class="op">=</span> <span class="st">"/partitionKey"</span><span class="op">,</span></span>
<span id="cb43-161"><a href="#cb43-161" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-162"><a href="#cb43-162" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Optional: configure indexing policy</span></span>
<span id="cb43-163"><a href="#cb43-163" aria-hidden="true" tabindex="-1"></a>    IndexingPolicy <span class="op">=</span> <span class="kw">new</span> IndexingPolicy</span>
<span id="cb43-164"><a href="#cb43-164" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-165"><a href="#cb43-165" aria-hidden="true" tabindex="-1"></a>        Automatic <span class="op">=</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb43-166"><a href="#cb43-166" aria-hidden="true" tabindex="-1"></a>        IndexingMode <span class="op">=</span> IndexingMode<span class="op">.</span><span class="fu">Consistent</span><span class="op">,</span></span>
<span id="cb43-167"><a href="#cb43-167" aria-hidden="true" tabindex="-1"></a>        IncludedPaths <span class="op">=</span> <span class="op">{</span> <span class="kw">new</span> IncludedPath <span class="op">{</span> Path <span class="op">=</span> <span class="st">"/*"</span> <span class="op">}</span> <span class="op">},</span></span>
<span id="cb43-168"><a href="#cb43-168" aria-hidden="true" tabindex="-1"></a>        ExcludedPaths <span class="op">=</span> <span class="op">{</span> <span class="kw">new</span> ExcludedPath <span class="op">{</span> Path <span class="op">=</span> <span class="st">"/path/to/exclude/*"</span> <span class="op">}</span> <span class="op">}</span></span>
<span id="cb43-169"><a href="#cb43-169" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb43-170"><a href="#cb43-170" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb43-171"><a href="#cb43-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-172"><a href="#cb43-172" aria-hidden="true" tabindex="-1"></a><span class="co">// Create with 400 RU/s throughput</span></span>
<span id="cb43-173"><a href="#cb43-173" aria-hidden="true" tabindex="-1"></a>Container container <span class="op">=</span> await database<span class="op">.</span><span class="fu">CreateContainerIfNotExistsAsync</span><span class="op">(</span></span>
<span id="cb43-174"><a href="#cb43-174" aria-hidden="true" tabindex="-1"></a>    containerProperties<span class="op">,</span> </span>
<span id="cb43-175"><a href="#cb43-175" aria-hidden="true" tabindex="-1"></a>    ThroughputProperties<span class="op">.</span><span class="fu">CreateManualThroughput</span><span class="op">(</span><span class="dv">400</span><span class="op">));</span></span>
<span id="cb43-176"><a href="#cb43-176" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-177"><a href="#cb43-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-178"><a href="#cb43-178" aria-hidden="true" tabindex="-1"></a><span class="fu">### Working with Items</span></span>
<span id="cb43-179"><a href="#cb43-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-180"><a href="#cb43-180" aria-hidden="true" tabindex="-1"></a>In Azure Cosmos DB's SQL API, you work with "items" - JSON documents with unique IDs:</span>
<span id="cb43-181"><a href="#cb43-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-182"><a href="#cb43-182" aria-hidden="true" tabindex="-1"></a><span class="in">```csharp</span></span>
<span id="cb43-183"><a href="#cb43-183" aria-hidden="true" tabindex="-1"></a><span class="co">// Define a model class</span></span>
<span id="cb43-184"><a href="#cb43-184" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> TodoItem</span>
<span id="cb43-185"><a href="#cb43-185" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-186"><a href="#cb43-186" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">JsonProperty</span><span class="op">(</span><span class="st">"id"</span><span class="op">)]</span></span>
<span id="cb43-187"><a href="#cb43-187" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> Id <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> Guid<span class="op">.</span><span class="fu">NewGuid</span><span class="op">().</span><span class="fu">ToString</span><span class="op">();</span></span>
<span id="cb43-188"><a href="#cb43-188" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-189"><a href="#cb43-189" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">JsonProperty</span><span class="op">(</span><span class="st">"partitionKey"</span><span class="op">)]</span></span>
<span id="cb43-190"><a href="#cb43-190" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> PartitionKey <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb43-191"><a href="#cb43-191" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-192"><a href="#cb43-192" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> Title <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb43-193"><a href="#cb43-193" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">bool</span> Completed <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb43-194"><a href="#cb43-194" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> DateTime CreatedDate <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> DateTime<span class="op">.</span><span class="fu">UtcNow</span><span class="op">;</span></span>
<span id="cb43-195"><a href="#cb43-195" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-196"><a href="#cb43-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-197"><a href="#cb43-197" aria-hidden="true" tabindex="-1"></a><span class="co">// Alternative: Using System.Text.Json attributes</span></span>
<span id="cb43-198"><a href="#cb43-198" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> TodoItemWithSystemTextJson</span>
<span id="cb43-199"><a href="#cb43-199" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-200"><a href="#cb43-200" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">JsonPropertyName</span><span class="op">(</span><span class="st">"id"</span><span class="op">)]</span></span>
<span id="cb43-201"><a href="#cb43-201" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> Id <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> Guid<span class="op">.</span><span class="fu">NewGuid</span><span class="op">().</span><span class="fu">ToString</span><span class="op">();</span></span>
<span id="cb43-202"><a href="#cb43-202" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-203"><a href="#cb43-203" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">JsonPropertyName</span><span class="op">(</span><span class="st">"partitionKey"</span><span class="op">)]</span></span>
<span id="cb43-204"><a href="#cb43-204" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> PartitionKey <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb43-205"><a href="#cb43-205" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-206"><a href="#cb43-206" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> Title <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb43-207"><a href="#cb43-207" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">bool</span> Completed <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb43-208"><a href="#cb43-208" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> DateTime CreatedDate <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> DateTime<span class="op">.</span><span class="fu">UtcNow</span><span class="op">;</span></span>
<span id="cb43-209"><a href="#cb43-209" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-210"><a href="#cb43-210" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-211"><a href="#cb43-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-212"><a href="#cb43-212" aria-hidden="true" tabindex="-1"></a>## CRUD Operations</span>
<span id="cb43-213"><a href="#cb43-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-214"><a href="#cb43-214" aria-hidden="true" tabindex="-1"></a>### <span class="fu">Query</span> <span class="op">(</span>Read<span class="op">)</span></span>
<span id="cb43-215"><a href="#cb43-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-216"><a href="#cb43-216" aria-hidden="true" tabindex="-1"></a>CosmosDB SQL API provides a rich SQL<span class="op">-</span>like query language <span class="kw">for</span> JSON documents<span class="op">.</span> You can query <span class="kw">using</span> strongly<span class="op">-</span>typed entities<span class="op">,</span> dynamic objects<span class="op">,</span> or raw JSON responses<span class="op">:</span></span>
<span id="cb43-217"><a href="#cb43-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-218"><a href="#cb43-218" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-219"><a href="#cb43-219" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Point read by ID and partition key (most efficient)</span></span>
<span id="cb43-220"><a href="#cb43-220" aria-hidden="true" tabindex="-1"></a><span class="kw">try</span></span>
<span id="cb43-221"><a href="#cb43-221" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-222"><a href="#cb43-222" aria-hidden="true" tabindex="-1"></a>    ItemResponse<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> response <span class="op">=</span> await container<span class="op">.</span><span class="fu">ReadItemAsync</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb43-223"><a href="#cb43-223" aria-hidden="true" tabindex="-1"></a>        id<span class="op">:</span> <span class="st">"task-1"</span><span class="op">,</span> </span>
<span id="cb43-224"><a href="#cb43-224" aria-hidden="true" tabindex="-1"></a>        partitionKey<span class="op">:</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb43-225"><a href="#cb43-225" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-226"><a href="#cb43-226" aria-hidden="true" tabindex="-1"></a>    TodoItem item <span class="op">=</span> response<span class="op">.</span><span class="fu">Resource</span><span class="op">;</span></span>
<span id="cb43-227"><a href="#cb43-227" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Retrieved item: {item.Title}, RUs consumed: {response.RequestCharge}"</span><span class="op">);</span></span>
<span id="cb43-228"><a href="#cb43-228" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-229"><a href="#cb43-229" aria-hidden="true" tabindex="-1"></a><span class="kw">catch</span> <span class="op">(</span>CosmosException ex<span class="op">)</span> <span class="fu">when</span> <span class="op">(</span>ex<span class="op">.</span><span class="fu">StatusCode</span> <span class="op">==</span> HttpStatusCode<span class="op">.</span><span class="fu">NotFound</span><span class="op">)</span></span>
<span id="cb43-230"><a href="#cb43-230" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-231"><a href="#cb43-231" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">"Item not found"</span><span class="op">);</span></span>
<span id="cb43-232"><a href="#cb43-232" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-233"><a href="#cb43-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-234"><a href="#cb43-234" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. SQL Query</span></span>
<span id="cb43-235"><a href="#cb43-235" aria-hidden="true" tabindex="-1"></a>QueryDefinition query <span class="op">=</span> <span class="kw">new</span> <span class="fu">QueryDefinition</span><span class="op">(</span></span>
<span id="cb43-236"><a href="#cb43-236" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SELECT * FROM c WHERE c.partitionKey = @partitionKey AND c.completed = @status"</span><span class="op">)</span></span>
<span id="cb43-237"><a href="#cb43-237" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">WithParameter</span><span class="op">(</span><span class="st">"@partitionKey"</span><span class="op">,</span> <span class="st">"personal"</span><span class="op">)</span></span>
<span id="cb43-238"><a href="#cb43-238" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">WithParameter</span><span class="op">(</span><span class="st">"@status"</span><span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="cb43-239"><a href="#cb43-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-240"><a href="#cb43-240" aria-hidden="true" tabindex="-1"></a>FeedIterator<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> resultSet <span class="op">=</span> container<span class="op">.</span><span class="fu">GetItemQueryIterator</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb43-241"><a href="#cb43-241" aria-hidden="true" tabindex="-1"></a>    query<span class="op">,</span></span>
<span id="cb43-242"><a href="#cb43-242" aria-hidden="true" tabindex="-1"></a>    requestOptions<span class="op">:</span> <span class="kw">new</span> QueryRequestOptions</span>
<span id="cb43-243"><a href="#cb43-243" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-244"><a href="#cb43-244" aria-hidden="true" tabindex="-1"></a>        MaxItemCount <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb43-245"><a href="#cb43-245" aria-hidden="true" tabindex="-1"></a>        PartitionKey <span class="op">=</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">)</span></span>
<span id="cb43-246"><a href="#cb43-246" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb43-247"><a href="#cb43-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-248"><a href="#cb43-248" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> totalRequestCharge <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb43-249"><a href="#cb43-249" aria-hidden="true" tabindex="-1"></a>List<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> results <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>TodoItem<span class="op">&gt;();</span></span>
<span id="cb43-250"><a href="#cb43-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-251"><a href="#cb43-251" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="op">(</span>resultSet<span class="op">.</span><span class="fu">HasMoreResults</span><span class="op">)</span></span>
<span id="cb43-252"><a href="#cb43-252" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-253"><a href="#cb43-253" aria-hidden="true" tabindex="-1"></a>    FeedResponse<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> response <span class="op">=</span> await resultSet<span class="op">.</span><span class="fu">ReadNextAsync</span><span class="op">();</span></span>
<span id="cb43-254"><a href="#cb43-254" aria-hidden="true" tabindex="-1"></a>    totalRequestCharge <span class="op">+=</span> response<span class="op">.</span><span class="fu">RequestCharge</span><span class="op">;</span></span>
<span id="cb43-255"><a href="#cb43-255" aria-hidden="true" tabindex="-1"></a>    results<span class="op">.</span><span class="fu">AddRange</span><span class="op">(</span>response<span class="op">.</span><span class="fu">ToList</span><span class="op">());</span></span>
<span id="cb43-256"><a href="#cb43-256" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-257"><a href="#cb43-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-258"><a href="#cb43-258" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Found {results.Count} items, total RU consumed: {totalRequestCharge}"</span><span class="op">);</span></span>
<span id="cb43-259"><a href="#cb43-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-260"><a href="#cb43-260" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. LINQ query </span></span>
<span id="cb43-261"><a href="#cb43-261" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span><span class="op">.</span><span class="fu">Linq</span><span class="op">;</span></span>
<span id="cb43-262"><a href="#cb43-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-263"><a href="#cb43-263" aria-hidden="true" tabindex="-1"></a>IOrderedQueryable<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> linqQueryable <span class="op">=</span> container<span class="op">.</span><span class="fu">GetItemLinqQueryable</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;();</span></span>
<span id="cb43-264"><a href="#cb43-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-265"><a href="#cb43-265" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> query <span class="op">=</span> linqQueryable</span>
<span id="cb43-266"><a href="#cb43-266" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">Where</span><span class="op">(</span>t <span class="op">=&gt;</span> t<span class="op">.</span><span class="fu">PartitionKey</span> <span class="op">==</span> <span class="st">"personal"</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>t<span class="op">.</span><span class="fu">Completed</span><span class="op">)</span></span>
<span id="cb43-267"><a href="#cb43-267" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">OrderBy</span><span class="op">(</span>t <span class="op">=&gt;</span> t<span class="op">.</span><span class="fu">CreatedDate</span><span class="op">);</span></span>
<span id="cb43-268"><a href="#cb43-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-269"><a href="#cb43-269" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> FeedIterator<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> linqResultSet <span class="op">=</span> query<span class="op">.</span><span class="fu">ToFeedIterator</span><span class="op">();</span></span>
<span id="cb43-270"><a href="#cb43-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-271"><a href="#cb43-271" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="op">(</span>linqResultSet<span class="op">.</span><span class="fu">HasMoreResults</span><span class="op">)</span></span>
<span id="cb43-272"><a href="#cb43-272" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-273"><a href="#cb43-273" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="op">(</span><span class="dt">var</span> item <span class="kw">in</span> await linqResultSet<span class="op">.</span><span class="fu">ReadNextAsync</span><span class="op">())</span></span>
<span id="cb43-274"><a href="#cb43-274" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-275"><a href="#cb43-275" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"{item.Title}: {item.CreatedDate}"</span><span class="op">);</span></span>
<span id="cb43-276"><a href="#cb43-276" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb43-277"><a href="#cb43-277" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-278"><a href="#cb43-278" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-279"><a href="#cb43-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-280"><a href="#cb43-280" aria-hidden="true" tabindex="-1"></a>### Working with Dynamic Entities</span>
<span id="cb43-281"><a href="#cb43-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-282"><a href="#cb43-282" aria-hidden="true" tabindex="-1"></a>You can work with dynamic objects when you don't want to define strongly<span class="op">-</span>typed classes<span class="op">:</span></span>
<span id="cb43-283"><a href="#cb43-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-284"><a href="#cb43-284" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-285"><a href="#cb43-285" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Point read with dynamic object</span></span>
<span id="cb43-286"><a href="#cb43-286" aria-hidden="true" tabindex="-1"></a>ItemResponse<span class="op">&lt;</span>dynamic<span class="op">&gt;</span> dynamicResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">ReadItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb43-287"><a href="#cb43-287" aria-hidden="true" tabindex="-1"></a>    id<span class="op">:</span> <span class="st">"task-1"</span><span class="op">,</span> </span>
<span id="cb43-288"><a href="#cb43-288" aria-hidden="true" tabindex="-1"></a>    partitionKey<span class="op">:</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb43-289"><a href="#cb43-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-290"><a href="#cb43-290" aria-hidden="true" tabindex="-1"></a>dynamic item <span class="op">=</span> dynamicResponse<span class="op">.</span><span class="fu">Resource</span><span class="op">;</span></span>
<span id="cb43-291"><a href="#cb43-291" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Title: {item.title}, Completed: {item.completed}"</span><span class="op">);</span></span>
<span id="cb43-292"><a href="#cb43-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-293"><a href="#cb43-293" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Query with dynamic objects</span></span>
<span id="cb43-294"><a href="#cb43-294" aria-hidden="true" tabindex="-1"></a>QueryDefinition dynamicQuery <span class="op">=</span> <span class="kw">new</span> <span class="fu">QueryDefinition</span><span class="op">(</span></span>
<span id="cb43-295"><a href="#cb43-295" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SELECT * FROM c WHERE c.partitionKey = @partitionKey"</span><span class="op">)</span></span>
<span id="cb43-296"><a href="#cb43-296" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">WithParameter</span><span class="op">(</span><span class="st">"@partitionKey"</span><span class="op">,</span> <span class="st">"personal"</span><span class="op">);</span></span>
<span id="cb43-297"><a href="#cb43-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-298"><a href="#cb43-298" aria-hidden="true" tabindex="-1"></a>FeedIterator<span class="op">&lt;</span>dynamic<span class="op">&gt;</span> dynamicResultSet <span class="op">=</span> container<span class="op">.</span><span class="fu">GetItemQueryIterator</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb43-299"><a href="#cb43-299" aria-hidden="true" tabindex="-1"></a>    dynamicQuery<span class="op">,</span></span>
<span id="cb43-300"><a href="#cb43-300" aria-hidden="true" tabindex="-1"></a>    requestOptions<span class="op">:</span> <span class="kw">new</span> QueryRequestOptions</span>
<span id="cb43-301"><a href="#cb43-301" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-302"><a href="#cb43-302" aria-hidden="true" tabindex="-1"></a>        PartitionKey <span class="op">=</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">)</span></span>
<span id="cb43-303"><a href="#cb43-303" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb43-304"><a href="#cb43-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-305"><a href="#cb43-305" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="op">(</span>dynamicResultSet<span class="op">.</span><span class="fu">HasMoreResults</span><span class="op">)</span></span>
<span id="cb43-306"><a href="#cb43-306" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-307"><a href="#cb43-307" aria-hidden="true" tabindex="-1"></a>    FeedResponse<span class="op">&lt;</span>dynamic<span class="op">&gt;</span> response <span class="op">=</span> await dynamicResultSet<span class="op">.</span><span class="fu">ReadNextAsync</span><span class="op">();</span></span>
<span id="cb43-308"><a href="#cb43-308" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="op">(</span>dynamic item <span class="kw">in</span> response<span class="op">)</span></span>
<span id="cb43-309"><a href="#cb43-309" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-310"><a href="#cb43-310" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"ID: {item.id}, Title: {item.title}"</span><span class="op">);</span></span>
<span id="cb43-311"><a href="#cb43-311" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb43-312"><a href="#cb43-312" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-313"><a href="#cb43-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-314"><a href="#cb43-314" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Creating items with dynamic objects</span></span>
<span id="cb43-315"><a href="#cb43-315" aria-hidden="true" tabindex="-1"></a>dynamic newDynamicItem <span class="op">=</span> <span class="kw">new</span></span>
<span id="cb43-316"><a href="#cb43-316" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-317"><a href="#cb43-317" aria-hidden="true" tabindex="-1"></a>    id <span class="op">=</span> <span class="st">"dynamic-task-1"</span><span class="op">,</span></span>
<span id="cb43-318"><a href="#cb43-318" aria-hidden="true" tabindex="-1"></a>    partitionKey <span class="op">=</span> <span class="st">"personal"</span><span class="op">,</span></span>
<span id="cb43-319"><a href="#cb43-319" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> <span class="st">"Task created with dynamic object"</span><span class="op">,</span></span>
<span id="cb43-320"><a href="#cb43-320" aria-hidden="true" tabindex="-1"></a>    completed <span class="op">=</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb43-321"><a href="#cb43-321" aria-hidden="true" tabindex="-1"></a>    tags <span class="op">=</span> <span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> <span class="st">"dynamic"</span><span class="op">,</span> <span class="st">"example"</span> <span class="op">}</span></span>
<span id="cb43-322"><a href="#cb43-322" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb43-323"><a href="#cb43-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-324"><a href="#cb43-324" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb43-325"><a href="#cb43-325" aria-hidden="true" tabindex="-1"></a>    newDynamicItem<span class="op">,</span> </span>
<span id="cb43-326"><a href="#cb43-326" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb43-327"><a href="#cb43-327" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-328"><a href="#cb43-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-329"><a href="#cb43-329" aria-hidden="true" tabindex="-1"></a>### Working with Raw JSON Responses</span>
<span id="cb43-330"><a href="#cb43-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-331"><a href="#cb43-331" aria-hidden="true" tabindex="-1"></a>For maximum flexibility<span class="op">,</span> you can work directly with JSON strings<span class="op">:</span></span>
<span id="cb43-332"><a href="#cb43-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-333"><a href="#cb43-333" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-334"><a href="#cb43-334" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Query returning raw JSON stream</span></span>
<span id="cb43-335"><a href="#cb43-335" aria-hidden="true" tabindex="-1"></a>QueryDefinition jsonQuery <span class="op">=</span> <span class="kw">new</span> <span class="fu">QueryDefinition</span><span class="op">(</span></span>
<span id="cb43-336"><a href="#cb43-336" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SELECT * FROM c WHERE c.partitionKey = @partitionKey"</span><span class="op">)</span></span>
<span id="cb43-337"><a href="#cb43-337" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">WithParameter</span><span class="op">(</span><span class="st">"@partitionKey"</span><span class="op">,</span> <span class="st">"personal"</span><span class="op">);</span></span>
<span id="cb43-338"><a href="#cb43-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-339"><a href="#cb43-339" aria-hidden="true" tabindex="-1"></a>FeedIterator jsonIterator <span class="op">=</span> container<span class="op">.</span><span class="fu">GetItemQueryStreamIterator</span><span class="op">(</span></span>
<span id="cb43-340"><a href="#cb43-340" aria-hidden="true" tabindex="-1"></a>    jsonQuery<span class="op">,</span></span>
<span id="cb43-341"><a href="#cb43-341" aria-hidden="true" tabindex="-1"></a>    requestOptions<span class="op">:</span> <span class="kw">new</span> QueryRequestOptions</span>
<span id="cb43-342"><a href="#cb43-342" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-343"><a href="#cb43-343" aria-hidden="true" tabindex="-1"></a>        PartitionKey <span class="op">=</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">)</span></span>
<span id="cb43-344"><a href="#cb43-344" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb43-345"><a href="#cb43-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-346"><a href="#cb43-346" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="op">(</span>jsonIterator<span class="op">.</span><span class="fu">HasMoreResults</span><span class="op">)</span></span>
<span id="cb43-347"><a href="#cb43-347" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-348"><a href="#cb43-348" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> ResponseMessage response <span class="op">=</span> await jsonIterator<span class="op">.</span><span class="fu">ReadNextAsync</span><span class="op">();</span></span>
<span id="cb43-349"><a href="#cb43-349" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-350"><a href="#cb43-350" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>response<span class="op">.</span><span class="fu">IsSuccessStatusCode</span><span class="op">)</span></span>
<span id="cb43-351"><a href="#cb43-351" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-352"><a href="#cb43-352" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> StreamReader reader <span class="op">=</span> <span class="kw">new</span> <span class="fu">StreamReader</span><span class="op">(</span>response<span class="op">.</span><span class="fu">Content</span><span class="op">);</span></span>
<span id="cb43-353"><a href="#cb43-353" aria-hidden="true" tabindex="-1"></a>        <span class="dt">string</span> jsonContent <span class="op">=</span> await reader<span class="op">.</span><span class="fu">ReadToEndAsync</span><span class="op">();</span></span>
<span id="cb43-354"><a href="#cb43-354" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb43-355"><a href="#cb43-355" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Raw JSON Response: {jsonContent}"</span><span class="op">);</span></span>
<span id="cb43-356"><a href="#cb43-356" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb43-357"><a href="#cb43-357" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Parse manually if needed</span></span>
<span id="cb43-358"><a href="#cb43-358" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> JsonDocument document <span class="op">=</span> JsonDocument<span class="op">.</span><span class="fu">Parse</span><span class="op">(</span>jsonContent<span class="op">);</span></span>
<span id="cb43-359"><a href="#cb43-359" aria-hidden="true" tabindex="-1"></a>        JsonElement root <span class="op">=</span> document<span class="op">.</span><span class="fu">RootElement</span><span class="op">;</span></span>
<span id="cb43-360"><a href="#cb43-360" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb43-361"><a href="#cb43-361" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>root<span class="op">.</span><span class="fu">TryGetProperty</span><span class="op">(</span><span class="st">"Documents"</span><span class="op">,</span> <span class="kw">out</span> JsonElement documents<span class="op">))</span></span>
<span id="cb43-362"><a href="#cb43-362" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb43-363"><a href="#cb43-363" aria-hidden="true" tabindex="-1"></a>            <span class="kw">foreach</span> <span class="op">(</span>JsonElement item <span class="kw">in</span> documents<span class="op">.</span><span class="fu">EnumerateArray</span><span class="op">())</span></span>
<span id="cb43-364"><a href="#cb43-364" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb43-365"><a href="#cb43-365" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>item<span class="op">.</span><span class="fu">TryGetProperty</span><span class="op">(</span><span class="st">"title"</span><span class="op">,</span> <span class="kw">out</span> JsonElement title<span class="op">))</span></span>
<span id="cb43-366"><a href="#cb43-366" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb43-367"><a href="#cb43-367" aria-hidden="true" tabindex="-1"></a>                    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Title from JSON: {title.GetString()}"</span><span class="op">);</span></span>
<span id="cb43-368"><a href="#cb43-368" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb43-369"><a href="#cb43-369" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb43-370"><a href="#cb43-370" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb43-371"><a href="#cb43-371" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb43-372"><a href="#cb43-372" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-373"><a href="#cb43-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-374"><a href="#cb43-374" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Point read with raw JSON</span></span>
<span id="cb43-375"><a href="#cb43-375" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> ResponseMessage jsonResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">ReadItemStreamAsync</span><span class="op">(</span></span>
<span id="cb43-376"><a href="#cb43-376" aria-hidden="true" tabindex="-1"></a>    <span class="st">"task-1"</span><span class="op">,</span> </span>
<span id="cb43-377"><a href="#cb43-377" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb43-378"><a href="#cb43-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-379"><a href="#cb43-379" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>jsonResponse<span class="op">.</span><span class="fu">IsSuccessStatusCode</span><span class="op">)</span></span>
<span id="cb43-380"><a href="#cb43-380" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-381"><a href="#cb43-381" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> StreamReader reader <span class="op">=</span> <span class="kw">new</span> <span class="fu">StreamReader</span><span class="op">(</span>jsonResponse<span class="op">.</span><span class="fu">Content</span><span class="op">);</span></span>
<span id="cb43-382"><a href="#cb43-382" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> itemJson <span class="op">=</span> await reader<span class="op">.</span><span class="fu">ReadToEndAsync</span><span class="op">();</span></span>
<span id="cb43-383"><a href="#cb43-383" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-384"><a href="#cb43-384" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Raw JSON Item: {itemJson}"</span><span class="op">);</span></span>
<span id="cb43-385"><a href="#cb43-385" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-386"><a href="#cb43-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-387"><a href="#cb43-387" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Create item with raw JSON</span></span>
<span id="cb43-388"><a href="#cb43-388" aria-hidden="true" tabindex="-1"></a><span class="dt">string</span> newItemJson <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb43-389"><a href="#cb43-389" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-390"><a href="#cb43-390" aria-hidden="true" tabindex="-1"></a>    <span class="st">"id"</span><span class="op">:</span> <span class="st">"json-task-1"</span><span class="op">,</span></span>
<span id="cb43-391"><a href="#cb43-391" aria-hidden="true" tabindex="-1"></a>    <span class="st">"partitionKey"</span><span class="op">:</span> <span class="st">"personal"</span><span class="op">,</span></span>
<span id="cb43-392"><a href="#cb43-392" aria-hidden="true" tabindex="-1"></a>    <span class="st">"title"</span><span class="op">:</span> <span class="st">"Task created with raw JSON"</span><span class="op">,</span></span>
<span id="cb43-393"><a href="#cb43-393" aria-hidden="true" tabindex="-1"></a>    <span class="st">"completed"</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb43-394"><a href="#cb43-394" aria-hidden="true" tabindex="-1"></a>    <span class="st">"metadata"</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb43-395"><a href="#cb43-395" aria-hidden="true" tabindex="-1"></a>        <span class="st">"createdBy"</span><span class="op">:</span> <span class="st">"system"</span><span class="op">,</span></span>
<span id="cb43-396"><a href="#cb43-396" aria-hidden="true" tabindex="-1"></a>        <span class="st">"priority"</span><span class="op">:</span> <span class="st">"high"</span></span>
<span id="cb43-397"><a href="#cb43-397" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb43-398"><a href="#cb43-398" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-399"><a href="#cb43-399" aria-hidden="true" tabindex="-1"></a><span class="st">""";</span></span>
<span id="cb43-400"><a href="#cb43-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-401"><a href="#cb43-401" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> MemoryStream stream <span class="op">=</span> <span class="kw">new</span> <span class="fu">MemoryStream</span><span class="op">(</span>Encoding<span class="op">.</span><span class="fu">UTF8</span><span class="op">.</span><span class="fu">GetBytes</span><span class="op">(</span>newItemJson<span class="op">));</span></span>
<span id="cb43-402"><a href="#cb43-402" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> ResponseMessage createResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">CreateItemStreamAsync</span><span class="op">(</span></span>
<span id="cb43-403"><a href="#cb43-403" aria-hidden="true" tabindex="-1"></a>    stream<span class="op">,</span> </span>
<span id="cb43-404"><a href="#cb43-404" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb43-405"><a href="#cb43-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-406"><a href="#cb43-406" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>createResponse<span class="op">.</span><span class="fu">IsSuccessStatusCode</span><span class="op">)</span></span>
<span id="cb43-407"><a href="#cb43-407" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-408"><a href="#cb43-408" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Created item with status: {createResponse.StatusCode}"</span><span class="op">);</span></span>
<span id="cb43-409"><a href="#cb43-409" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-410"><a href="#cb43-410" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-411"><a href="#cb43-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-412"><a href="#cb43-412" aria-hidden="true" tabindex="-1"></a>### Performance Comparison</span>
<span id="cb43-413"><a href="#cb43-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-414"><a href="#cb43-414" aria-hidden="true" tabindex="-1"></a>Different approaches have different performance characteristics<span class="op">:</span></span>
<span id="cb43-415"><a href="#cb43-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-416"><a href="#cb43-416" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-417"><a href="#cb43-417" aria-hidden="true" tabindex="-1"></a><span class="co">// Performance comparison example</span></span>
<span id="cb43-418"><a href="#cb43-418" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> stopwatch <span class="op">=</span> Stopwatch<span class="op">.</span><span class="fu">StartNew</span><span class="op">();</span></span>
<span id="cb43-419"><a href="#cb43-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-420"><a href="#cb43-420" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Strongly-typed (fastest deserialization)</span></span>
<span id="cb43-421"><a href="#cb43-421" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> typedResults <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>TodoItem<span class="op">&gt;();</span></span>
<span id="cb43-422"><a href="#cb43-422" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> typedIterator <span class="op">=</span> container<span class="op">.</span><span class="fu">GetItemQueryIterator</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb43-423"><a href="#cb43-423" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">QueryDefinition</span><span class="op">(</span><span class="st">"SELECT * FROM c WHERE c.partitionKey = 'personal'"</span><span class="op">),</span></span>
<span id="cb43-424"><a href="#cb43-424" aria-hidden="true" tabindex="-1"></a>    requestOptions<span class="op">:</span> <span class="kw">new</span> QueryRequestOptions <span class="op">{</span> PartitionKey <span class="op">=</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">)</span> <span class="op">});</span></span>
<span id="cb43-425"><a href="#cb43-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-426"><a href="#cb43-426" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="op">(</span>typedIterator<span class="op">.</span><span class="fu">HasMoreResults</span><span class="op">)</span></span>
<span id="cb43-427"><a href="#cb43-427" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-428"><a href="#cb43-428" aria-hidden="true" tabindex="-1"></a>    typedResults<span class="op">.</span><span class="fu">AddRange</span><span class="op">(</span>await typedIterator<span class="op">.</span><span class="fu">ReadNextAsync</span><span class="op">());</span></span>
<span id="cb43-429"><a href="#cb43-429" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-430"><a href="#cb43-430" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="cb43-431"><a href="#cb43-431" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Strongly-typed query: {stopwatch.ElapsedMilliseconds}ms"</span><span class="op">);</span></span>
<span id="cb43-432"><a href="#cb43-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-433"><a href="#cb43-433" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Restart</span><span class="op">();</span></span>
<span id="cb43-434"><a href="#cb43-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-435"><a href="#cb43-435" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Dynamic objects (flexible but slower)</span></span>
<span id="cb43-436"><a href="#cb43-436" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> dynamicResults <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>dynamic<span class="op">&gt;();</span></span>
<span id="cb43-437"><a href="#cb43-437" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> dynamicIterator <span class="op">=</span> container<span class="op">.</span><span class="fu">GetItemQueryIterator</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb43-438"><a href="#cb43-438" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">QueryDefinition</span><span class="op">(</span><span class="st">"SELECT * FROM c WHERE c.partitionKey = 'personal'"</span><span class="op">),</span></span>
<span id="cb43-439"><a href="#cb43-439" aria-hidden="true" tabindex="-1"></a>    requestOptions<span class="op">:</span> <span class="kw">new</span> QueryRequestOptions <span class="op">{</span> PartitionKey <span class="op">=</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">)</span> <span class="op">});</span></span>
<span id="cb43-440"><a href="#cb43-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-441"><a href="#cb43-441" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="op">(</span>dynamicIterator<span class="op">.</span><span class="fu">HasMoreResults</span><span class="op">)</span></span>
<span id="cb43-442"><a href="#cb43-442" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-443"><a href="#cb43-443" aria-hidden="true" tabindex="-1"></a>    dynamicResults<span class="op">.</span><span class="fu">AddRange</span><span class="op">(</span>await dynamicIterator<span class="op">.</span><span class="fu">ReadNextAsync</span><span class="op">());</span></span>
<span id="cb43-444"><a href="#cb43-444" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-445"><a href="#cb43-445" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="cb43-446"><a href="#cb43-446" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Dynamic query: {stopwatch.ElapsedMilliseconds}ms"</span><span class="op">);</span></span>
<span id="cb43-447"><a href="#cb43-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-448"><a href="#cb43-448" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Restart</span><span class="op">();</span></span>
<span id="cb43-449"><a href="#cb43-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-450"><a href="#cb43-450" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Raw JSON (fastest network transfer, manual parsing required)</span></span>
<span id="cb43-451"><a href="#cb43-451" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> jsonIterator <span class="op">=</span> container<span class="op">.</span><span class="fu">GetItemQueryStreamIterator</span><span class="op">(</span></span>
<span id="cb43-452"><a href="#cb43-452" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">QueryDefinition</span><span class="op">(</span><span class="st">"SELECT * FROM c WHERE c.partitionKey = 'personal'"</span><span class="op">),</span></span>
<span id="cb43-453"><a href="#cb43-453" aria-hidden="true" tabindex="-1"></a>    requestOptions<span class="op">:</span> <span class="kw">new</span> QueryRequestOptions <span class="op">{</span> PartitionKey <span class="op">=</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">)</span> <span class="op">});</span></span>
<span id="cb43-454"><a href="#cb43-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-455"><a href="#cb43-455" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="op">(</span>jsonIterator<span class="op">.</span><span class="fu">HasMoreResults</span><span class="op">)</span></span>
<span id="cb43-456"><a href="#cb43-456" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-457"><a href="#cb43-457" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="dt">var</span> response <span class="op">=</span> await jsonIterator<span class="op">.</span><span class="fu">ReadNextAsync</span><span class="op">();</span></span>
<span id="cb43-458"><a href="#cb43-458" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="dt">var</span> reader <span class="op">=</span> <span class="kw">new</span> <span class="fu">StreamReader</span><span class="op">(</span>response<span class="op">.</span><span class="fu">Content</span><span class="op">);</span></span>
<span id="cb43-459"><a href="#cb43-459" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> json <span class="op">=</span> await reader<span class="op">.</span><span class="fu">ReadToEndAsync</span><span class="op">();</span></span>
<span id="cb43-460"><a href="#cb43-460" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Process JSON as needed</span></span>
<span id="cb43-461"><a href="#cb43-461" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-462"><a href="#cb43-462" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="cb43-463"><a href="#cb43-463" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Raw JSON query: {stopwatch.ElapsedMilliseconds}ms"</span><span class="op">);</span></span>
<span id="cb43-464"><a href="#cb43-464" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-465"><a href="#cb43-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-466"><a href="#cb43-466" aria-hidden="true" tabindex="-1"></a>#### Query Performance Tips</span>
<span id="cb43-467"><a href="#cb43-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-468"><a href="#cb43-468" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Always include the partition key<span class="op">**</span> <span class="kw">in</span> your queries when possible</span>
<span id="cb43-469"><a href="#cb43-469" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Point reads<span class="op">**</span> <span class="op">(</span>id <span class="op">+</span> partition key<span class="op">)</span> are the most efficient operations</span>
<span id="cb43-470"><a href="#cb43-470" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Use <span class="op">**</span>parameterized queries<span class="op">**</span> to prevent SQL injection and improve caching</span>
<span id="cb43-471"><a href="#cb43-471" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Monitor <span class="op">**</span>request <span class="fu">charge</span> <span class="op">(</span>RUs<span class="op">)**</span> to optimize queries</span>
<span id="cb43-472"><a href="#cb43-472" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Use <span class="op">**</span>projections<span class="op">**</span> <span class="op">(</span>`SELECT VALUE c<span class="op">.</span><span class="fu">name</span>`<span class="op">)</span> to <span class="kw">return</span> only needed properties</span>
<span id="cb43-473"><a href="#cb43-473" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> Consider <span class="op">**</span>paging<span class="op">**</span> with continuation tokens <span class="kw">for</span> large result sets</span>
<span id="cb43-474"><a href="#cb43-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-475"><a href="#cb43-475" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-476"><a href="#cb43-476" aria-hidden="true" tabindex="-1"></a><span class="co">// Query with continuation token (pagination)</span></span>
<span id="cb43-477"><a href="#cb43-477" aria-hidden="true" tabindex="-1"></a>QueryDefinition largeQuery <span class="op">=</span> <span class="kw">new</span> <span class="fu">QueryDefinition</span><span class="op">(</span><span class="st">"SELECT * FROM c"</span><span class="op">);</span></span>
<span id="cb43-478"><a href="#cb43-478" aria-hidden="true" tabindex="-1"></a>QueryRequestOptions options <span class="op">=</span> <span class="kw">new</span> QueryRequestOptions</span>
<span id="cb43-479"><a href="#cb43-479" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-480"><a href="#cb43-480" aria-hidden="true" tabindex="-1"></a>    MaxItemCount <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb43-481"><a href="#cb43-481" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb43-482"><a href="#cb43-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-483"><a href="#cb43-483" aria-hidden="true" tabindex="-1"></a>FeedIterator<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> iterator <span class="op">=</span> container<span class="op">.</span><span class="fu">GetItemQueryIterator</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb43-484"><a href="#cb43-484" aria-hidden="true" tabindex="-1"></a>    largeQuery<span class="op">,</span> </span>
<span id="cb43-485"><a href="#cb43-485" aria-hidden="true" tabindex="-1"></a>    requestOptions<span class="op">:</span> options<span class="op">);</span></span>
<span id="cb43-486"><a href="#cb43-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-487"><a href="#cb43-487" aria-hidden="true" tabindex="-1"></a><span class="dt">string</span> continuationToken <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb43-488"><a href="#cb43-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-489"><a href="#cb43-489" aria-hidden="true" tabindex="-1"></a><span class="co">// First page</span></span>
<span id="cb43-490"><a href="#cb43-490" aria-hidden="true" tabindex="-1"></a>FeedResponse<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> page <span class="op">=</span> await iterator<span class="op">.</span><span class="fu">ReadNextAsync</span><span class="op">();</span></span>
<span id="cb43-491"><a href="#cb43-491" aria-hidden="true" tabindex="-1"></a>continuationToken <span class="op">=</span> page<span class="op">.</span><span class="fu">ContinuationToken</span><span class="op">;</span></span>
<span id="cb43-492"><a href="#cb43-492" aria-hidden="true" tabindex="-1"></a><span class="fu">ProcessItems</span><span class="op">(</span>page<span class="op">);</span></span>
<span id="cb43-493"><a href="#cb43-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-494"><a href="#cb43-494" aria-hidden="true" tabindex="-1"></a><span class="co">// Later, get the next page using the continuation token</span></span>
<span id="cb43-495"><a href="#cb43-495" aria-hidden="true" tabindex="-1"></a>options<span class="op">.</span><span class="fu">RequestContinuation</span> <span class="op">=</span> continuationToken<span class="op">;</span></span>
<span id="cb43-496"><a href="#cb43-496" aria-hidden="true" tabindex="-1"></a>iterator <span class="op">=</span> container<span class="op">.</span><span class="fu">GetItemQueryIterator</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span>largeQuery<span class="op">,</span> requestOptions<span class="op">:</span> options<span class="op">);</span></span>
<span id="cb43-497"><a href="#cb43-497" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-498"><a href="#cb43-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-499"><a href="#cb43-499" aria-hidden="true" tabindex="-1"></a>### Create</span>
<span id="cb43-500"><a href="#cb43-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-501"><a href="#cb43-501" aria-hidden="true" tabindex="-1"></a>You can create items <span class="kw">using</span> strongly<span class="op">-</span>typed entities<span class="op">,</span> dynamic objects<span class="op">,</span> or raw JSON<span class="op">:</span></span>
<span id="cb43-502"><a href="#cb43-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-503"><a href="#cb43-503" aria-hidden="true" tabindex="-1"></a>#### Creating with Strongly<span class="op">-</span>Typed Entities</span>
<span id="cb43-504"><a href="#cb43-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-505"><a href="#cb43-505" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-506"><a href="#cb43-506" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a new item with strongly-typed class</span></span>
<span id="cb43-507"><a href="#cb43-507" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> newItem <span class="op">=</span> <span class="kw">new</span> TodoItem</span>
<span id="cb43-508"><a href="#cb43-508" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-509"><a href="#cb43-509" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="st">"task-1"</span><span class="op">,</span></span>
<span id="cb43-510"><a href="#cb43-510" aria-hidden="true" tabindex="-1"></a>    PartitionKey <span class="op">=</span> <span class="st">"personal"</span><span class="op">,</span></span>
<span id="cb43-511"><a href="#cb43-511" aria-hidden="true" tabindex="-1"></a>    Title <span class="op">=</span> <span class="st">"Complete Azure Cosmos DB documentation"</span><span class="op">,</span></span>
<span id="cb43-512"><a href="#cb43-512" aria-hidden="true" tabindex="-1"></a>    Completed <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb43-513"><a href="#cb43-513" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb43-514"><a href="#cb43-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-515"><a href="#cb43-515" aria-hidden="true" tabindex="-1"></a><span class="co">// Insert the item</span></span>
<span id="cb43-516"><a href="#cb43-516" aria-hidden="true" tabindex="-1"></a><span class="kw">try</span></span>
<span id="cb43-517"><a href="#cb43-517" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-518"><a href="#cb43-518" aria-hidden="true" tabindex="-1"></a>    ItemResponse<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> response <span class="op">=</span> await container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">(</span></span>
<span id="cb43-519"><a href="#cb43-519" aria-hidden="true" tabindex="-1"></a>        newItem<span class="op">,</span> </span>
<span id="cb43-520"><a href="#cb43-520" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span>newItem<span class="op">.</span><span class="fu">PartitionKey</span><span class="op">));</span></span>
<span id="cb43-521"><a href="#cb43-521" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-522"><a href="#cb43-522" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Created item: {newItem.Id}"</span><span class="op">);</span></span>
<span id="cb43-523"><a href="#cb43-523" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Request charge: {response.RequestCharge} RUs"</span><span class="op">);</span></span>
<span id="cb43-524"><a href="#cb43-524" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-525"><a href="#cb43-525" aria-hidden="true" tabindex="-1"></a><span class="kw">catch</span> <span class="op">(</span>CosmosException ex<span class="op">)</span> <span class="fu">when</span> <span class="op">(</span>ex<span class="op">.</span><span class="fu">StatusCode</span> <span class="op">==</span> HttpStatusCode<span class="op">.</span><span class="fu">Conflict</span><span class="op">)</span></span>
<span id="cb43-526"><a href="#cb43-526" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-527"><a href="#cb43-527" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">"Item already exists"</span><span class="op">);</span></span>
<span id="cb43-528"><a href="#cb43-528" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-529"><a href="#cb43-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-530"><a href="#cb43-530" aria-hidden="true" tabindex="-1"></a><span class="co">// Upsert - create if not exists, replace if exists</span></span>
<span id="cb43-531"><a href="#cb43-531" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">UpsertItemAsync</span><span class="op">(</span></span>
<span id="cb43-532"><a href="#cb43-532" aria-hidden="true" tabindex="-1"></a>    newItem<span class="op">,</span> </span>
<span id="cb43-533"><a href="#cb43-533" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span>newItem<span class="op">.</span><span class="fu">PartitionKey</span><span class="op">));</span></span>
<span id="cb43-534"><a href="#cb43-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-535"><a href="#cb43-535" aria-hidden="true" tabindex="-1"></a><span class="co">// Create with custom options</span></span>
<span id="cb43-536"><a href="#cb43-536" aria-hidden="true" tabindex="-1"></a>ItemRequestOptions requestOptions <span class="op">=</span> <span class="kw">new</span> ItemRequestOptions</span>
<span id="cb43-537"><a href="#cb43-537" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-538"><a href="#cb43-538" aria-hidden="true" tabindex="-1"></a>    EnableContentResponseOnWrite <span class="op">=</span> <span class="kw">false</span><span class="op">,</span> <span class="co">// Saves RUs by not returning the created item</span></span>
<span id="cb43-539"><a href="#cb43-539" aria-hidden="true" tabindex="-1"></a>    ConsistencyLevel <span class="op">=</span> ConsistencyLevel<span class="op">.</span><span class="fu">Session</span></span>
<span id="cb43-540"><a href="#cb43-540" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb43-541"><a href="#cb43-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-542"><a href="#cb43-542" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">(</span></span>
<span id="cb43-543"><a href="#cb43-543" aria-hidden="true" tabindex="-1"></a>    newItem<span class="op">,</span> </span>
<span id="cb43-544"><a href="#cb43-544" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span>newItem<span class="op">.</span><span class="fu">PartitionKey</span><span class="op">),</span></span>
<span id="cb43-545"><a href="#cb43-545" aria-hidden="true" tabindex="-1"></a>    requestOptions<span class="op">);</span></span>
<span id="cb43-546"><a href="#cb43-546" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-547"><a href="#cb43-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-548"><a href="#cb43-548" aria-hidden="true" tabindex="-1"></a>#### Creating with Dynamic Objects</span>
<span id="cb43-549"><a href="#cb43-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-550"><a href="#cb43-550" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-551"><a href="#cb43-551" aria-hidden="true" tabindex="-1"></a><span class="co">// Create with anonymous object</span></span>
<span id="cb43-552"><a href="#cb43-552" aria-hidden="true" tabindex="-1"></a>dynamic dynamicItem <span class="op">=</span> <span class="kw">new</span></span>
<span id="cb43-553"><a href="#cb43-553" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-554"><a href="#cb43-554" aria-hidden="true" tabindex="-1"></a>    id <span class="op">=</span> <span class="st">"dynamic-task-2"</span><span class="op">,</span></span>
<span id="cb43-555"><a href="#cb43-555" aria-hidden="true" tabindex="-1"></a>    partitionKey <span class="op">=</span> <span class="st">"personal"</span><span class="op">,</span></span>
<span id="cb43-556"><a href="#cb43-556" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> <span class="st">"Task created with dynamic object"</span><span class="op">,</span></span>
<span id="cb43-557"><a href="#cb43-557" aria-hidden="true" tabindex="-1"></a>    completed <span class="op">=</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb43-558"><a href="#cb43-558" aria-hidden="true" tabindex="-1"></a>    priority <span class="op">=</span> <span class="st">"high"</span><span class="op">,</span></span>
<span id="cb43-559"><a href="#cb43-559" aria-hidden="true" tabindex="-1"></a>    tags <span class="op">=</span> <span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> <span class="st">"dynamic"</span><span class="op">,</span> <span class="st">"flexible"</span> <span class="op">},</span></span>
<span id="cb43-560"><a href="#cb43-560" aria-hidden="true" tabindex="-1"></a>    metadata <span class="op">=</span> <span class="kw">new</span></span>
<span id="cb43-561"><a href="#cb43-561" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-562"><a href="#cb43-562" aria-hidden="true" tabindex="-1"></a>        createdBy <span class="op">=</span> <span class="st">"system"</span><span class="op">,</span></span>
<span id="cb43-563"><a href="#cb43-563" aria-hidden="true" tabindex="-1"></a>        version <span class="op">=</span> <span class="st">"1.0"</span></span>
<span id="cb43-564"><a href="#cb43-564" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb43-565"><a href="#cb43-565" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb43-566"><a href="#cb43-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-567"><a href="#cb43-567" aria-hidden="true" tabindex="-1"></a>ItemResponse<span class="op">&lt;</span>dynamic<span class="op">&gt;</span> dynamicResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb43-568"><a href="#cb43-568" aria-hidden="true" tabindex="-1"></a>    dynamicItem<span class="op">,</span> </span>
<span id="cb43-569"><a href="#cb43-569" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb43-570"><a href="#cb43-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-571"><a href="#cb43-571" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Created dynamic item: {dynamicResponse.Resource.id}"</span><span class="op">);</span></span>
<span id="cb43-572"><a href="#cb43-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-573"><a href="#cb43-573" aria-hidden="true" tabindex="-1"></a><span class="co">// Create with ExpandoObject for runtime flexibility</span></span>
<span id="cb43-574"><a href="#cb43-574" aria-hidden="true" tabindex="-1"></a>dynamic expandoItem <span class="op">=</span> <span class="kw">new</span> <span class="fu">ExpandoObject</span><span class="op">();</span></span>
<span id="cb43-575"><a href="#cb43-575" aria-hidden="true" tabindex="-1"></a>expandoItem<span class="op">.</span><span class="fu">id</span> <span class="op">=</span> <span class="st">"expando-task-1"</span><span class="op">;</span></span>
<span id="cb43-576"><a href="#cb43-576" aria-hidden="true" tabindex="-1"></a>expandoItem<span class="op">.</span><span class="fu">partitionKey</span> <span class="op">=</span> <span class="st">"personal"</span><span class="op">;</span></span>
<span id="cb43-577"><a href="#cb43-577" aria-hidden="true" tabindex="-1"></a>expandoItem<span class="op">.</span><span class="fu">title</span> <span class="op">=</span> <span class="st">"Task created with ExpandoObject"</span><span class="op">;</span></span>
<span id="cb43-578"><a href="#cb43-578" aria-hidden="true" tabindex="-1"></a>expandoItem<span class="op">.</span><span class="fu">completed</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb43-579"><a href="#cb43-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-580"><a href="#cb43-580" aria-hidden="true" tabindex="-1"></a><span class="co">// Add properties dynamically</span></span>
<span id="cb43-581"><a href="#cb43-581" aria-hidden="true" tabindex="-1"></a><span class="op">((</span>IDictionary<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">object</span><span class="op">&gt;)</span>expandoItem<span class="op">)[</span><span class="st">"customField"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"customValue"</span><span class="op">;</span></span>
<span id="cb43-582"><a href="#cb43-582" aria-hidden="true" tabindex="-1"></a><span class="op">((</span>IDictionary<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">object</span><span class="op">&gt;)</span>expandoItem<span class="op">)[</span><span class="st">"timestamp"</span><span class="op">]</span> <span class="op">=</span> DateTime<span class="op">.</span><span class="fu">UtcNow</span><span class="op">;</span></span>
<span id="cb43-583"><a href="#cb43-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-584"><a href="#cb43-584" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb43-585"><a href="#cb43-585" aria-hidden="true" tabindex="-1"></a>    expandoItem<span class="op">,</span> </span>
<span id="cb43-586"><a href="#cb43-586" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb43-587"><a href="#cb43-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-588"><a href="#cb43-588" aria-hidden="true" tabindex="-1"></a><span class="co">// Upsert with dynamic objects</span></span>
<span id="cb43-589"><a href="#cb43-589" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">UpsertItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb43-590"><a href="#cb43-590" aria-hidden="true" tabindex="-1"></a>    dynamicItem<span class="op">,</span> </span>
<span id="cb43-591"><a href="#cb43-591" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb43-592"><a href="#cb43-592" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-593"><a href="#cb43-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-594"><a href="#cb43-594" aria-hidden="true" tabindex="-1"></a>#### Creating with Raw JSON</span>
<span id="cb43-595"><a href="#cb43-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-596"><a href="#cb43-596" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-597"><a href="#cb43-597" aria-hidden="true" tabindex="-1"></a><span class="co">// Create item with JSON string</span></span>
<span id="cb43-598"><a href="#cb43-598" aria-hidden="true" tabindex="-1"></a><span class="dt">string</span> newItemJson <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb43-599"><a href="#cb43-599" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-600"><a href="#cb43-600" aria-hidden="true" tabindex="-1"></a>    <span class="st">"id"</span><span class="op">:</span> <span class="st">"json-task-2"</span><span class="op">,</span></span>
<span id="cb43-601"><a href="#cb43-601" aria-hidden="true" tabindex="-1"></a>    <span class="st">"partitionKey"</span><span class="op">:</span> <span class="st">"personal"</span><span class="op">,</span></span>
<span id="cb43-602"><a href="#cb43-602" aria-hidden="true" tabindex="-1"></a>    <span class="st">"title"</span><span class="op">:</span> <span class="st">"Task created with raw JSON"</span><span class="op">,</span></span>
<span id="cb43-603"><a href="#cb43-603" aria-hidden="true" tabindex="-1"></a>    <span class="st">"completed"</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb43-604"><a href="#cb43-604" aria-hidden="true" tabindex="-1"></a>    <span class="st">"priority"</span><span class="op">:</span> <span class="st">"medium"</span><span class="op">,</span></span>
<span id="cb43-605"><a href="#cb43-605" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tags"</span><span class="op">:</span> <span class="op">[</span><span class="st">"json"</span><span class="op">,</span> <span class="st">"manual"</span><span class="op">],</span></span>
<span id="cb43-606"><a href="#cb43-606" aria-hidden="true" tabindex="-1"></a>    <span class="st">"metadata"</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb43-607"><a href="#cb43-607" aria-hidden="true" tabindex="-1"></a>        <span class="st">"createdBy"</span><span class="op">:</span> <span class="st">"api"</span><span class="op">,</span></span>
<span id="cb43-608"><a href="#cb43-608" aria-hidden="true" tabindex="-1"></a>        <span class="st">"source"</span><span class="op">:</span> <span class="st">"external-system"</span><span class="op">,</span></span>
<span id="cb43-609"><a href="#cb43-609" aria-hidden="true" tabindex="-1"></a>        <span class="st">"timestamp"</span><span class="op">:</span> <span class="st">"2025-01-15T10:30:00Z"</span></span>
<span id="cb43-610"><a href="#cb43-610" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb43-611"><a href="#cb43-611" aria-hidden="true" tabindex="-1"></a>    <span class="st">"customProperties"</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb43-612"><a href="#cb43-612" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nested"</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb43-613"><a href="#cb43-613" aria-hidden="true" tabindex="-1"></a>            <span class="st">"value"</span><span class="op">:</span> <span class="dv">42</span><span class="op">,</span></span>
<span id="cb43-614"><a href="#cb43-614" aria-hidden="true" tabindex="-1"></a>            <span class="st">"active"</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb43-615"><a href="#cb43-615" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb43-616"><a href="#cb43-616" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb43-617"><a href="#cb43-617" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-618"><a href="#cb43-618" aria-hidden="true" tabindex="-1"></a><span class="st">""";</span></span>
<span id="cb43-619"><a href="#cb43-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-620"><a href="#cb43-620" aria-hidden="true" tabindex="-1"></a><span class="co">// Create using stream for maximum performance</span></span>
<span id="cb43-621"><a href="#cb43-621" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> MemoryStream stream <span class="op">=</span> <span class="kw">new</span> <span class="fu">MemoryStream</span><span class="op">(</span>Encoding<span class="op">.</span><span class="fu">UTF8</span><span class="op">.</span><span class="fu">GetBytes</span><span class="op">(</span>newItemJson<span class="op">));</span></span>
<span id="cb43-622"><a href="#cb43-622" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> ResponseMessage createResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">CreateItemStreamAsync</span><span class="op">(</span></span>
<span id="cb43-623"><a href="#cb43-623" aria-hidden="true" tabindex="-1"></a>    stream<span class="op">,</span> </span>
<span id="cb43-624"><a href="#cb43-624" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb43-625"><a href="#cb43-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-626"><a href="#cb43-626" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>createResponse<span class="op">.</span><span class="fu">IsSuccessStatusCode</span><span class="op">)</span></span>
<span id="cb43-627"><a href="#cb43-627" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-628"><a href="#cb43-628" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Created JSON item with status: {createResponse.StatusCode}"</span><span class="op">);</span></span>
<span id="cb43-629"><a href="#cb43-629" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Request charge: {createResponse.Headers.RequestCharge} RUs"</span><span class="op">);</span></span>
<span id="cb43-630"><a href="#cb43-630" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-631"><a href="#cb43-631" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Read the created item from response if needed</span></span>
<span id="cb43-632"><a href="#cb43-632" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> StreamReader reader <span class="op">=</span> <span class="kw">new</span> <span class="fu">StreamReader</span><span class="op">(</span>createResponse<span class="op">.</span><span class="fu">Content</span><span class="op">);</span></span>
<span id="cb43-633"><a href="#cb43-633" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> createdItemJson <span class="op">=</span> await reader<span class="op">.</span><span class="fu">ReadToEndAsync</span><span class="op">();</span></span>
<span id="cb43-634"><a href="#cb43-634" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Created item: {createdItemJson}"</span><span class="op">);</span></span>
<span id="cb43-635"><a href="#cb43-635" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-636"><a href="#cb43-636" aria-hidden="true" tabindex="-1"></a><span class="kw">else</span></span>
<span id="cb43-637"><a href="#cb43-637" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-638"><a href="#cb43-638" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Failed to create item: {createResponse.StatusCode}"</span><span class="op">);</span></span>
<span id="cb43-639"><a href="#cb43-639" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> StreamReader errorReader <span class="op">=</span> <span class="kw">new</span> <span class="fu">StreamReader</span><span class="op">(</span>createResponse<span class="op">.</span><span class="fu">Content</span><span class="op">);</span></span>
<span id="cb43-640"><a href="#cb43-640" aria-hidden="true" tabindex="-1"></a>    <span class="dt">string</span> errorMessage <span class="op">=</span> await errorReader<span class="op">.</span><span class="fu">ReadToEndAsync</span><span class="op">();</span></span>
<span id="cb43-641"><a href="#cb43-641" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Error: {errorMessage}"</span><span class="op">);</span></span>
<span id="cb43-642"><a href="#cb43-642" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-643"><a href="#cb43-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-644"><a href="#cb43-644" aria-hidden="true" tabindex="-1"></a><span class="co">// Upsert with JSON stream</span></span>
<span id="cb43-645"><a href="#cb43-645" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> MemoryStream upsertStream <span class="op">=</span> <span class="kw">new</span> <span class="fu">MemoryStream</span><span class="op">(</span>Encoding<span class="op">.</span><span class="fu">UTF8</span><span class="op">.</span><span class="fu">GetBytes</span><span class="op">(</span>newItemJson<span class="op">));</span></span>
<span id="cb43-646"><a href="#cb43-646" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> ResponseMessage upsertResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">UpsertItemStreamAsync</span><span class="op">(</span></span>
<span id="cb43-647"><a href="#cb43-647" aria-hidden="true" tabindex="-1"></a>    upsertStream<span class="op">,</span> </span>
<span id="cb43-648"><a href="#cb43-648" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb43-649"><a href="#cb43-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-650"><a href="#cb43-650" aria-hidden="true" tabindex="-1"></a><span class="co">// Create with custom request options using JSON</span></span>
<span id="cb43-651"><a href="#cb43-651" aria-hidden="true" tabindex="-1"></a>ItemRequestOptions jsonRequestOptions <span class="op">=</span> <span class="kw">new</span> ItemRequestOptions</span>
<span id="cb43-652"><a href="#cb43-652" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-653"><a href="#cb43-653" aria-hidden="true" tabindex="-1"></a>    EnableContentResponseOnWrite <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb43-654"><a href="#cb43-654" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb43-655"><a href="#cb43-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-656"><a href="#cb43-656" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> MemoryStream customStream <span class="op">=</span> <span class="kw">new</span> <span class="fu">MemoryStream</span><span class="op">(</span>Encoding<span class="op">.</span><span class="fu">UTF8</span><span class="op">.</span><span class="fu">GetBytes</span><span class="op">(</span>newItemJson<span class="op">));</span></span>
<span id="cb43-657"><a href="#cb43-657" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> ResponseMessage customResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">CreateItemStreamAsync</span><span class="op">(</span></span>
<span id="cb43-658"><a href="#cb43-658" aria-hidden="true" tabindex="-1"></a>    customStream<span class="op">,</span> </span>
<span id="cb43-659"><a href="#cb43-659" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">),</span></span>
<span id="cb43-660"><a href="#cb43-660" aria-hidden="true" tabindex="-1"></a>    jsonRequestOptions<span class="op">);</span></span>
<span id="cb43-661"><a href="#cb43-661" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-662"><a href="#cb43-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-663"><a href="#cb43-663" aria-hidden="true" tabindex="-1"></a>#### Performance Comparison <span class="kw">for</span> Create Operations</span>
<span id="cb43-664"><a href="#cb43-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-665"><a href="#cb43-665" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-666"><a href="#cb43-666" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> stopwatch <span class="op">=</span> Stopwatch<span class="op">.</span><span class="fu">StartNew</span><span class="op">();</span></span>
<span id="cb43-667"><a href="#cb43-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-668"><a href="#cb43-668" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Strongly-typed (good balance of performance and type safety)</span></span>
<span id="cb43-669"><a href="#cb43-669" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> typedItem <span class="op">=</span> <span class="kw">new</span> TodoItem <span class="op">{</span> Id <span class="op">=</span> <span class="st">"perf-typed"</span><span class="op">,</span> PartitionKey <span class="op">=</span> <span class="st">"test"</span><span class="op">,</span> Title <span class="op">=</span> <span class="st">"Typed"</span> <span class="op">};</span></span>
<span id="cb43-670"><a href="#cb43-670" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">(</span>typedItem<span class="op">,</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"test"</span><span class="op">));</span></span>
<span id="cb43-671"><a href="#cb43-671" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="cb43-672"><a href="#cb43-672" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Strongly-typed create: {stopwatch.ElapsedMilliseconds}ms"</span><span class="op">);</span></span>
<span id="cb43-673"><a href="#cb43-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-674"><a href="#cb43-674" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Restart</span><span class="op">();</span></span>
<span id="cb43-675"><a href="#cb43-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-676"><a href="#cb43-676" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Dynamic object (flexible but slower serialization)</span></span>
<span id="cb43-677"><a href="#cb43-677" aria-hidden="true" tabindex="-1"></a>dynamic dynamicItem <span class="op">=</span> <span class="kw">new</span> <span class="op">{</span> id <span class="op">=</span> <span class="st">"perf-dynamic"</span><span class="op">,</span> partitionKey <span class="op">=</span> <span class="st">"test"</span><span class="op">,</span> title <span class="op">=</span> <span class="st">"Dynamic"</span> <span class="op">};</span></span>
<span id="cb43-678"><a href="#cb43-678" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span>dynamicItem<span class="op">,</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"test"</span><span class="op">));</span></span>
<span id="cb43-679"><a href="#cb43-679" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="cb43-680"><a href="#cb43-680" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Dynamic create: {stopwatch.ElapsedMilliseconds}ms"</span><span class="op">);</span></span>
<span id="cb43-681"><a href="#cb43-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-682"><a href="#cb43-682" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Restart</span><span class="op">();</span></span>
<span id="cb43-683"><a href="#cb43-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-684"><a href="#cb43-684" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Raw JSON (fastest, no serialization overhead)</span></span>
<span id="cb43-685"><a href="#cb43-685" aria-hidden="true" tabindex="-1"></a><span class="dt">string</span> jsonItem <span class="op">=</span> <span class="st">"""{"</span>id<span class="st">": "</span>perf<span class="op">-</span>json<span class="st">", "</span>partitionKey<span class="st">": "</span>test<span class="st">", "</span>title<span class="st">": "</span>JSON<span class="st">"}"""</span><span class="op">;</span></span>
<span id="cb43-686"><a href="#cb43-686" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="dt">var</span> stream <span class="op">=</span> <span class="kw">new</span> <span class="fu">MemoryStream</span><span class="op">(</span>Encoding<span class="op">.</span><span class="fu">UTF8</span><span class="op">.</span><span class="fu">GetBytes</span><span class="op">(</span>jsonItem<span class="op">));</span></span>
<span id="cb43-687"><a href="#cb43-687" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">CreateItemStreamAsync</span><span class="op">(</span>stream<span class="op">,</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"test"</span><span class="op">));</span></span>
<span id="cb43-688"><a href="#cb43-688" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="cb43-689"><a href="#cb43-689" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Raw JSON create: {stopwatch.ElapsedMilliseconds}ms"</span><span class="op">);</span></span>
<span id="cb43-690"><a href="#cb43-690" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-691"><a href="#cb43-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-692"><a href="#cb43-692" aria-hidden="true" tabindex="-1"></a>### Update</span>
<span id="cb43-693"><a href="#cb43-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-694"><a href="#cb43-694" aria-hidden="true" tabindex="-1"></a>You can update items <span class="kw">using</span> strongly<span class="op">-</span>typed entities<span class="op">,</span> dynamic objects<span class="op">,</span> or raw JSON through replace operations or patch operations<span class="op">:</span></span>
<span id="cb43-695"><a href="#cb43-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-696"><a href="#cb43-696" aria-hidden="true" tabindex="-1"></a>#### Updating with Strongly<span class="op">-</span>Typed Entities</span>
<span id="cb43-697"><a href="#cb43-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-698"><a href="#cb43-698" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-699"><a href="#cb43-699" aria-hidden="true" tabindex="-1"></a><span class="co">// Read first, then update</span></span>
<span id="cb43-700"><a href="#cb43-700" aria-hidden="true" tabindex="-1"></a><span class="kw">try</span></span>
<span id="cb43-701"><a href="#cb43-701" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-702"><a href="#cb43-702" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get the existing item</span></span>
<span id="cb43-703"><a href="#cb43-703" aria-hidden="true" tabindex="-1"></a>    ItemResponse<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> response <span class="op">=</span> await container<span class="op">.</span><span class="fu">ReadItemAsync</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb43-704"><a href="#cb43-704" aria-hidden="true" tabindex="-1"></a>        <span class="st">"task-1"</span><span class="op">,</span> </span>
<span id="cb43-705"><a href="#cb43-705" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb43-706"><a href="#cb43-706" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-707"><a href="#cb43-707" aria-hidden="true" tabindex="-1"></a>    TodoItem item <span class="op">=</span> response<span class="op">.</span><span class="fu">Resource</span><span class="op">;</span></span>
<span id="cb43-708"><a href="#cb43-708" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-709"><a href="#cb43-709" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Modify properties</span></span>
<span id="cb43-710"><a href="#cb43-710" aria-hidden="true" tabindex="-1"></a>    item<span class="op">.</span><span class="fu">Title</span> <span class="op">=</span> <span class="st">"Updated title"</span><span class="op">;</span></span>
<span id="cb43-711"><a href="#cb43-711" aria-hidden="true" tabindex="-1"></a>    item<span class="op">.</span><span class="fu">Completed</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb43-712"><a href="#cb43-712" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-713"><a href="#cb43-713" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update with optimistic concurrency control using ETag</span></span>
<span id="cb43-714"><a href="#cb43-714" aria-hidden="true" tabindex="-1"></a>    ItemRequestOptions options <span class="op">=</span> <span class="kw">new</span> ItemRequestOptions</span>
<span id="cb43-715"><a href="#cb43-715" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-716"><a href="#cb43-716" aria-hidden="true" tabindex="-1"></a>        IfMatchEtag <span class="op">=</span> response<span class="op">.</span><span class="fu">ETag</span></span>
<span id="cb43-717"><a href="#cb43-717" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb43-718"><a href="#cb43-718" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-719"><a href="#cb43-719" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Replace the item</span></span>
<span id="cb43-720"><a href="#cb43-720" aria-hidden="true" tabindex="-1"></a>    await container<span class="op">.</span><span class="fu">ReplaceItemAsync</span><span class="op">(</span></span>
<span id="cb43-721"><a href="#cb43-721" aria-hidden="true" tabindex="-1"></a>        item<span class="op">,</span> </span>
<span id="cb43-722"><a href="#cb43-722" aria-hidden="true" tabindex="-1"></a>        item<span class="op">.</span><span class="fu">Id</span><span class="op">,</span></span>
<span id="cb43-723"><a href="#cb43-723" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span>item<span class="op">.</span><span class="fu">PartitionKey</span><span class="op">),</span> </span>
<span id="cb43-724"><a href="#cb43-724" aria-hidden="true" tabindex="-1"></a>        options<span class="op">);</span></span>
<span id="cb43-725"><a href="#cb43-725" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-726"><a href="#cb43-726" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">"Item updated successfully"</span><span class="op">);</span></span>
<span id="cb43-727"><a href="#cb43-727" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-728"><a href="#cb43-728" aria-hidden="true" tabindex="-1"></a><span class="kw">catch</span> <span class="op">(</span>CosmosException ex<span class="op">)</span> <span class="fu">when</span> <span class="op">(</span>ex<span class="op">.</span><span class="fu">StatusCode</span> <span class="op">==</span> HttpStatusCode<span class="op">.</span><span class="fu">PreconditionFailed</span><span class="op">)</span></span>
<span id="cb43-729"><a href="#cb43-729" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-730"><a href="#cb43-730" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">"Item was modified by another process"</span><span class="op">);</span></span>
<span id="cb43-731"><a href="#cb43-731" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-732"><a href="#cb43-732" aria-hidden="true" tabindex="-1"></a><span class="kw">catch</span> <span class="op">(</span>CosmosException ex<span class="op">)</span> <span class="fu">when</span> <span class="op">(</span>ex<span class="op">.</span><span class="fu">StatusCode</span> <span class="op">==</span> HttpStatusCode<span class="op">.</span><span class="fu">NotFound</span><span class="op">)</span></span>
<span id="cb43-733"><a href="#cb43-733" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-734"><a href="#cb43-734" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">"Item not found"</span><span class="op">);</span></span>
<span id="cb43-735"><a href="#cb43-735" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-736"><a href="#cb43-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-737"><a href="#cb43-737" aria-hidden="true" tabindex="-1"></a><span class="co">// Direct patch operations without reading first</span></span>
<span id="cb43-738"><a href="#cb43-738" aria-hidden="true" tabindex="-1"></a>PatchItemRequestOptions patchOptions <span class="op">=</span> <span class="kw">new</span> <span class="fu">PatchItemRequestOptions</span><span class="op">();</span></span>
<span id="cb43-739"><a href="#cb43-739" aria-hidden="true" tabindex="-1"></a>List<span class="op">&lt;</span>PatchOperation<span class="op">&gt;</span> patchOperations <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>PatchOperation<span class="op">&gt;</span></span>
<span id="cb43-740"><a href="#cb43-740" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-741"><a href="#cb43-741" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Replace</span><span class="op">(</span><span class="st">"/title"</span><span class="op">,</span> <span class="st">"New patched title"</span><span class="op">),</span></span>
<span id="cb43-742"><a href="#cb43-742" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Replace</span><span class="op">(</span><span class="st">"/completed"</span><span class="op">,</span> <span class="kw">true</span><span class="op">),</span></span>
<span id="cb43-743"><a href="#cb43-743" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="st">"/tags"</span><span class="op">,</span> <span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> <span class="st">"important"</span><span class="op">,</span> <span class="st">"documentation"</span> <span class="op">})</span></span>
<span id="cb43-744"><a href="#cb43-744" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb43-745"><a href="#cb43-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-746"><a href="#cb43-746" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">PatchItemAsync</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb43-747"><a href="#cb43-747" aria-hidden="true" tabindex="-1"></a>    <span class="st">"task-1"</span><span class="op">,</span> </span>
<span id="cb43-748"><a href="#cb43-748" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">),</span></span>
<span id="cb43-749"><a href="#cb43-749" aria-hidden="true" tabindex="-1"></a>    patchOperations<span class="op">,</span></span>
<span id="cb43-750"><a href="#cb43-750" aria-hidden="true" tabindex="-1"></a>    patchOptions<span class="op">);</span></span>
<span id="cb43-751"><a href="#cb43-751" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-752"><a href="#cb43-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-753"><a href="#cb43-753" aria-hidden="true" tabindex="-1"></a>#### Updating with Dynamic Objects</span>
<span id="cb43-754"><a href="#cb43-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-755"><a href="#cb43-755" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-756"><a href="#cb43-756" aria-hidden="true" tabindex="-1"></a><span class="co">// Read and update with dynamic objects</span></span>
<span id="cb43-757"><a href="#cb43-757" aria-hidden="true" tabindex="-1"></a>ItemResponse<span class="op">&lt;</span>dynamic<span class="op">&gt;</span> dynamicResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">ReadItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb43-758"><a href="#cb43-758" aria-hidden="true" tabindex="-1"></a>    <span class="st">"dynamic-task-1"</span><span class="op">,</span> </span>
<span id="cb43-759"><a href="#cb43-759" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb43-760"><a href="#cb43-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-761"><a href="#cb43-761" aria-hidden="true" tabindex="-1"></a>dynamic item <span class="op">=</span> dynamicResponse<span class="op">.</span><span class="fu">Resource</span><span class="op">;</span></span>
<span id="cb43-762"><a href="#cb43-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-763"><a href="#cb43-763" aria-hidden="true" tabindex="-1"></a><span class="co">// Modify properties</span></span>
<span id="cb43-764"><a href="#cb43-764" aria-hidden="true" tabindex="-1"></a>item<span class="op">.</span><span class="fu">title</span> <span class="op">=</span> <span class="st">"Updated dynamic title"</span><span class="op">;</span></span>
<span id="cb43-765"><a href="#cb43-765" aria-hidden="true" tabindex="-1"></a>item<span class="op">.</span><span class="fu">completed</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb43-766"><a href="#cb43-766" aria-hidden="true" tabindex="-1"></a>item<span class="op">.</span><span class="fu">lastModified</span> <span class="op">=</span> DateTime<span class="op">.</span><span class="fu">UtcNow</span><span class="op">;</span></span>
<span id="cb43-767"><a href="#cb43-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-768"><a href="#cb43-768" aria-hidden="true" tabindex="-1"></a><span class="co">// Add new properties dynamically</span></span>
<span id="cb43-769"><a href="#cb43-769" aria-hidden="true" tabindex="-1"></a>item<span class="op">.</span><span class="fu">updatedBy</span> <span class="op">=</span> <span class="st">"system"</span><span class="op">;</span></span>
<span id="cb43-770"><a href="#cb43-770" aria-hidden="true" tabindex="-1"></a>item<span class="op">.</span><span class="fu">version</span> <span class="op">=</span> <span class="st">"2.0"</span><span class="op">;</span></span>
<span id="cb43-771"><a href="#cb43-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-772"><a href="#cb43-772" aria-hidden="true" tabindex="-1"></a><span class="co">// Replace with dynamic object</span></span>
<span id="cb43-773"><a href="#cb43-773" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">ReplaceItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb43-774"><a href="#cb43-774" aria-hidden="true" tabindex="-1"></a>    item<span class="op">,</span> </span>
<span id="cb43-775"><a href="#cb43-775" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span><span class="dt">string</span><span class="op">)</span>item<span class="op">.</span><span class="fu">id</span><span class="op">,</span></span>
<span id="cb43-776"><a href="#cb43-776" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">((</span><span class="dt">string</span><span class="op">)</span>item<span class="op">.</span><span class="fu">partitionKey</span><span class="op">));</span></span>
<span id="cb43-777"><a href="#cb43-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-778"><a href="#cb43-778" aria-hidden="true" tabindex="-1"></a><span class="co">// Patch operations with dynamic values</span></span>
<span id="cb43-779"><a href="#cb43-779" aria-hidden="true" tabindex="-1"></a>List<span class="op">&lt;</span>PatchOperation<span class="op">&gt;</span> dynamicPatchOps <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>PatchOperation<span class="op">&gt;</span></span>
<span id="cb43-780"><a href="#cb43-780" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-781"><a href="#cb43-781" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Replace</span><span class="op">(</span><span class="st">"/title"</span><span class="op">,</span> <span class="st">"Patched dynamic title"</span><span class="op">),</span></span>
<span id="cb43-782"><a href="#cb43-782" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="st">"/metadata/lastUpdated"</span><span class="op">,</span> DateTime<span class="op">.</span><span class="fu">UtcNow</span><span class="op">.</span><span class="fu">ToString</span><span class="op">(</span><span class="st">"O"</span><span class="op">)),</span></span>
<span id="cb43-783"><a href="#cb43-783" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Replace</span><span class="op">(</span><span class="st">"/priority"</span><span class="op">,</span> <span class="st">"urgent"</span><span class="op">),</span></span>
<span id="cb43-784"><a href="#cb43-784" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Remove</span><span class="op">(</span><span class="st">"/tags/0"</span><span class="op">)</span> <span class="co">// Remove first tag</span></span>
<span id="cb43-785"><a href="#cb43-785" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb43-786"><a href="#cb43-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-787"><a href="#cb43-787" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">PatchItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb43-788"><a href="#cb43-788" aria-hidden="true" tabindex="-1"></a>    <span class="st">"dynamic-task-1"</span><span class="op">,</span> </span>
<span id="cb43-789"><a href="#cb43-789" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">),</span></span>
<span id="cb43-790"><a href="#cb43-790" aria-hidden="true" tabindex="-1"></a>    dynamicPatchOps<span class="op">);</span></span>
<span id="cb43-791"><a href="#cb43-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-792"><a href="#cb43-792" aria-hidden="true" tabindex="-1"></a><span class="co">// Create or update with ExpandoObject</span></span>
<span id="cb43-793"><a href="#cb43-793" aria-hidden="true" tabindex="-1"></a>dynamic expandoUpdate <span class="op">=</span> <span class="kw">new</span> <span class="fu">ExpandoObject</span><span class="op">();</span></span>
<span id="cb43-794"><a href="#cb43-794" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> expandoDict <span class="op">=</span> <span class="op">(</span>IDictionary<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">object</span><span class="op">&gt;)</span>expandoUpdate<span class="op">;</span></span>
<span id="cb43-795"><a href="#cb43-795" aria-hidden="true" tabindex="-1"></a>expandoDict<span class="op">[</span><span class="st">"id"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"expando-task-1"</span><span class="op">;</span></span>
<span id="cb43-796"><a href="#cb43-796" aria-hidden="true" tabindex="-1"></a>expandoDict<span class="op">[</span><span class="st">"partitionKey"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"personal"</span><span class="op">;</span></span>
<span id="cb43-797"><a href="#cb43-797" aria-hidden="true" tabindex="-1"></a>expandoDict<span class="op">[</span><span class="st">"title"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Updated ExpandoObject"</span><span class="op">;</span></span>
<span id="cb43-798"><a href="#cb43-798" aria-hidden="true" tabindex="-1"></a>expandoDict<span class="op">[</span><span class="st">"completed"</span><span class="op">]</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb43-799"><a href="#cb43-799" aria-hidden="true" tabindex="-1"></a>expandoDict<span class="op">[</span><span class="st">"updatedAt"</span><span class="op">]</span> <span class="op">=</span> DateTime<span class="op">.</span><span class="fu">UtcNow</span><span class="op">;</span></span>
<span id="cb43-800"><a href="#cb43-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-801"><a href="#cb43-801" aria-hidden="true" tabindex="-1"></a><span class="co">// Add nested objects</span></span>
<span id="cb43-802"><a href="#cb43-802" aria-hidden="true" tabindex="-1"></a>expandoDict<span class="op">[</span><span class="st">"metadata"</span><span class="op">]</span> <span class="op">=</span> <span class="kw">new</span> Dictionary<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">object</span><span class="op">&gt;</span></span>
<span id="cb43-803"><a href="#cb43-803" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-804"><a href="#cb43-804" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="st">"lastModifiedBy"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"api"</span><span class="op">,</span></span>
<span id="cb43-805"><a href="#cb43-805" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="st">"version"</span><span class="op">]</span> <span class="op">=</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb43-806"><a href="#cb43-806" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="st">"changes"</span><span class="op">]</span> <span class="op">=</span> <span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> <span class="st">"title"</span><span class="op">,</span> <span class="st">"status"</span> <span class="op">}</span></span>
<span id="cb43-807"><a href="#cb43-807" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb43-808"><a href="#cb43-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-809"><a href="#cb43-809" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">UpsertItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb43-810"><a href="#cb43-810" aria-hidden="true" tabindex="-1"></a>    expandoUpdate<span class="op">,</span> </span>
<span id="cb43-811"><a href="#cb43-811" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb43-812"><a href="#cb43-812" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-813"><a href="#cb43-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-814"><a href="#cb43-814" aria-hidden="true" tabindex="-1"></a>#### Updating with Raw JSON</span>
<span id="cb43-815"><a href="#cb43-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-816"><a href="#cb43-816" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-817"><a href="#cb43-817" aria-hidden="true" tabindex="-1"></a><span class="co">// Replace using JSON stream</span></span>
<span id="cb43-818"><a href="#cb43-818" aria-hidden="true" tabindex="-1"></a><span class="dt">string</span> updatedItemJson <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb43-819"><a href="#cb43-819" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-820"><a href="#cb43-820" aria-hidden="true" tabindex="-1"></a>    <span class="st">"id"</span><span class="op">:</span> <span class="st">"json-task-1"</span><span class="op">,</span></span>
<span id="cb43-821"><a href="#cb43-821" aria-hidden="true" tabindex="-1"></a>    <span class="st">"partitionKey"</span><span class="op">:</span> <span class="st">"personal"</span><span class="op">,</span></span>
<span id="cb43-822"><a href="#cb43-822" aria-hidden="true" tabindex="-1"></a>    <span class="st">"title"</span><span class="op">:</span> <span class="st">"Updated JSON task"</span><span class="op">,</span></span>
<span id="cb43-823"><a href="#cb43-823" aria-hidden="true" tabindex="-1"></a>    <span class="st">"completed"</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb43-824"><a href="#cb43-824" aria-hidden="true" tabindex="-1"></a>    <span class="st">"priority"</span><span class="op">:</span> <span class="st">"high"</span><span class="op">,</span></span>
<span id="cb43-825"><a href="#cb43-825" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tags"</span><span class="op">:</span> <span class="op">[</span><span class="st">"json"</span><span class="op">,</span> <span class="st">"updated"</span><span class="op">],</span></span>
<span id="cb43-826"><a href="#cb43-826" aria-hidden="true" tabindex="-1"></a>    <span class="st">"metadata"</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb43-827"><a href="#cb43-827" aria-hidden="true" tabindex="-1"></a>        <span class="st">"lastModified"</span><span class="op">:</span> <span class="st">"2025-01-15T15:30:00Z"</span><span class="op">,</span></span>
<span id="cb43-828"><a href="#cb43-828" aria-hidden="true" tabindex="-1"></a>        <span class="st">"modifiedBy"</span><span class="op">:</span> <span class="st">"api-service"</span><span class="op">,</span></span>
<span id="cb43-829"><a href="#cb43-829" aria-hidden="true" tabindex="-1"></a>        <span class="st">"version"</span><span class="op">:</span> <span class="dv">2</span></span>
<span id="cb43-830"><a href="#cb43-830" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb43-831"><a href="#cb43-831" aria-hidden="true" tabindex="-1"></a>    <span class="st">"history"</span><span class="op">:</span> <span class="op">[</span></span>
<span id="cb43-832"><a href="#cb43-832" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb43-833"><a href="#cb43-833" aria-hidden="true" tabindex="-1"></a>            <span class="st">"action"</span><span class="op">:</span> <span class="st">"created"</span><span class="op">,</span></span>
<span id="cb43-834"><a href="#cb43-834" aria-hidden="true" tabindex="-1"></a>            <span class="st">"timestamp"</span><span class="op">:</span> <span class="st">"2025-01-15T10:30:00Z"</span></span>
<span id="cb43-835"><a href="#cb43-835" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb43-836"><a href="#cb43-836" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb43-837"><a href="#cb43-837" aria-hidden="true" tabindex="-1"></a>            <span class="st">"action"</span><span class="op">:</span> <span class="st">"updated"</span><span class="op">,</span> </span>
<span id="cb43-838"><a href="#cb43-838" aria-hidden="true" tabindex="-1"></a>            <span class="st">"timestamp"</span><span class="op">:</span> <span class="st">"2025-01-15T15:30:00Z"</span><span class="op">,</span></span>
<span id="cb43-839"><a href="#cb43-839" aria-hidden="true" tabindex="-1"></a>            <span class="st">"changes"</span><span class="op">:</span> <span class="op">[</span><span class="st">"title"</span><span class="op">,</span> <span class="st">"completed"</span><span class="op">,</span> <span class="st">"priority"</span><span class="op">]</span></span>
<span id="cb43-840"><a href="#cb43-840" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb43-841"><a href="#cb43-841" aria-hidden="true" tabindex="-1"></a>    <span class="op">]</span></span>
<span id="cb43-842"><a href="#cb43-842" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-843"><a href="#cb43-843" aria-hidden="true" tabindex="-1"></a><span class="st">""";</span></span>
<span id="cb43-844"><a href="#cb43-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-845"><a href="#cb43-845" aria-hidden="true" tabindex="-1"></a><span class="co">// Replace with JSON stream</span></span>
<span id="cb43-846"><a href="#cb43-846" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> MemoryStream replaceStream <span class="op">=</span> <span class="kw">new</span> <span class="fu">MemoryStream</span><span class="op">(</span>Encoding<span class="op">.</span><span class="fu">UTF8</span><span class="op">.</span><span class="fu">GetBytes</span><span class="op">(</span>updatedItemJson<span class="op">));</span></span>
<span id="cb43-847"><a href="#cb43-847" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> ResponseMessage replaceResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">ReplaceItemStreamAsync</span><span class="op">(</span></span>
<span id="cb43-848"><a href="#cb43-848" aria-hidden="true" tabindex="-1"></a>    replaceStream<span class="op">,</span> </span>
<span id="cb43-849"><a href="#cb43-849" aria-hidden="true" tabindex="-1"></a>    <span class="st">"json-task-1"</span><span class="op">,</span></span>
<span id="cb43-850"><a href="#cb43-850" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb43-851"><a href="#cb43-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-852"><a href="#cb43-852" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>replaceResponse<span class="op">.</span><span class="fu">IsSuccessStatusCode</span><span class="op">)</span></span>
<span id="cb43-853"><a href="#cb43-853" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-854"><a href="#cb43-854" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Updated JSON item with status: {replaceResponse.StatusCode}"</span><span class="op">);</span></span>
<span id="cb43-855"><a href="#cb43-855" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Request charge: {replaceResponse.Headers.RequestCharge} RUs"</span><span class="op">);</span></span>
<span id="cb43-856"><a href="#cb43-856" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-857"><a href="#cb43-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-858"><a href="#cb43-858" aria-hidden="true" tabindex="-1"></a><span class="co">// Upsert with JSON stream (create if not exists, replace if exists)</span></span>
<span id="cb43-859"><a href="#cb43-859" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> MemoryStream upsertStream <span class="op">=</span> <span class="kw">new</span> <span class="fu">MemoryStream</span><span class="op">(</span>Encoding<span class="op">.</span><span class="fu">UTF8</span><span class="op">.</span><span class="fu">GetBytes</span><span class="op">(</span>updatedItemJson<span class="op">));</span></span>
<span id="cb43-860"><a href="#cb43-860" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> ResponseMessage upsertResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">UpsertItemStreamAsync</span><span class="op">(</span></span>
<span id="cb43-861"><a href="#cb43-861" aria-hidden="true" tabindex="-1"></a>    upsertStream<span class="op">,</span> </span>
<span id="cb43-862"><a href="#cb43-862" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb43-863"><a href="#cb43-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-864"><a href="#cb43-864" aria-hidden="true" tabindex="-1"></a><span class="co">// Optimistic concurrency with ETag using JSON</span></span>
<span id="cb43-865"><a href="#cb43-865" aria-hidden="true" tabindex="-1"></a>ItemRequestOptions etagOptions <span class="op">=</span> <span class="kw">new</span> ItemRequestOptions</span>
<span id="cb43-866"><a href="#cb43-866" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-867"><a href="#cb43-867" aria-hidden="true" tabindex="-1"></a>    IfMatchEtag <span class="op">=</span> <span class="st">"</span><span class="sc">\"</span><span class="st">some-etag-value</span><span class="sc">\"</span><span class="st">"</span> <span class="co">// Get this from a previous read operation</span></span>
<span id="cb43-868"><a href="#cb43-868" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb43-869"><a href="#cb43-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-870"><a href="#cb43-870" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> MemoryStream concurrencyStream <span class="op">=</span> <span class="kw">new</span> <span class="fu">MemoryStream</span><span class="op">(</span>Encoding<span class="op">.</span><span class="fu">UTF8</span><span class="op">.</span><span class="fu">GetBytes</span><span class="op">(</span>updatedItemJson<span class="op">));</span></span>
<span id="cb43-871"><a href="#cb43-871" aria-hidden="true" tabindex="-1"></a><span class="kw">try</span></span>
<span id="cb43-872"><a href="#cb43-872" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-873"><a href="#cb43-873" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> ResponseMessage concurrencyResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">ReplaceItemStreamAsync</span><span class="op">(</span></span>
<span id="cb43-874"><a href="#cb43-874" aria-hidden="true" tabindex="-1"></a>        concurrencyStream<span class="op">,</span> </span>
<span id="cb43-875"><a href="#cb43-875" aria-hidden="true" tabindex="-1"></a>        <span class="st">"json-task-1"</span><span class="op">,</span></span>
<span id="cb43-876"><a href="#cb43-876" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">),</span></span>
<span id="cb43-877"><a href="#cb43-877" aria-hidden="true" tabindex="-1"></a>        etagOptions<span class="op">);</span></span>
<span id="cb43-878"><a href="#cb43-878" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-879"><a href="#cb43-879" aria-hidden="true" tabindex="-1"></a><span class="kw">catch</span> <span class="op">(</span>CosmosException ex<span class="op">)</span> <span class="fu">when</span> <span class="op">(</span>ex<span class="op">.</span><span class="fu">StatusCode</span> <span class="op">==</span> HttpStatusCode<span class="op">.</span><span class="fu">PreconditionFailed</span><span class="op">)</span></span>
<span id="cb43-880"><a href="#cb43-880" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-881"><a href="#cb43-881" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">"Item was modified by another process - ETag mismatch"</span><span class="op">);</span></span>
<span id="cb43-882"><a href="#cb43-882" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-883"><a href="#cb43-883" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-884"><a href="#cb43-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-885"><a href="#cb43-885" aria-hidden="true" tabindex="-1"></a>#### Advanced Patch Operations</span>
<span id="cb43-886"><a href="#cb43-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-887"><a href="#cb43-887" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-888"><a href="#cb43-888" aria-hidden="true" tabindex="-1"></a><span class="co">// Complex patch operations with different data types</span></span>
<span id="cb43-889"><a href="#cb43-889" aria-hidden="true" tabindex="-1"></a>List<span class="op">&lt;</span>PatchOperation<span class="op">&gt;</span> advancedPatchOps <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>PatchOperation<span class="op">&gt;</span></span>
<span id="cb43-890"><a href="#cb43-890" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-891"><a href="#cb43-891" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Replace operations</span></span>
<span id="cb43-892"><a href="#cb43-892" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Replace</span><span class="op">(</span><span class="st">"/title"</span><span class="op">,</span> <span class="st">"Advanced patched title"</span><span class="op">),</span></span>
<span id="cb43-893"><a href="#cb43-893" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Replace</span><span class="op">(</span><span class="st">"/completed"</span><span class="op">,</span> <span class="kw">true</span><span class="op">),</span></span>
<span id="cb43-894"><a href="#cb43-894" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Replace</span><span class="op">(</span><span class="st">"/priority"</span><span class="op">,</span> <span class="st">"critical"</span><span class="op">),</span></span>
<span id="cb43-895"><a href="#cb43-895" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-896"><a href="#cb43-896" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add operations</span></span>
<span id="cb43-897"><a href="#cb43-897" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="st">"/tags/-"</span><span class="op">,</span> <span class="st">"new-tag"</span><span class="op">),</span> <span class="co">// Add to end of array</span></span>
<span id="cb43-898"><a href="#cb43-898" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="st">"/metadata/patchedAt"</span><span class="op">,</span> DateTime<span class="op">.</span><span class="fu">UtcNow</span><span class="op">),</span></span>
<span id="cb43-899"><a href="#cb43-899" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="st">"/assignee"</span><span class="op">,</span> <span class="kw">new</span> <span class="op">{</span> name <span class="op">=</span> <span class="st">"John Doe"</span><span class="op">,</span> id <span class="op">=</span> <span class="st">"user123"</span> <span class="op">}),</span></span>
<span id="cb43-900"><a href="#cb43-900" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-901"><a href="#cb43-901" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Remove operations</span></span>
<span id="cb43-902"><a href="#cb43-902" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Remove</span><span class="op">(</span><span class="st">"/oldProperty"</span><span class="op">),</span></span>
<span id="cb43-903"><a href="#cb43-903" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Remove</span><span class="op">(</span><span class="st">"/tags/0"</span><span class="op">),</span> <span class="co">// Remove first element from array</span></span>
<span id="cb43-904"><a href="#cb43-904" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-905"><a href="#cb43-905" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Increment operation (for numeric values)</span></span>
<span id="cb43-906"><a href="#cb43-906" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Increment</span><span class="op">(</span><span class="st">"/retryCount"</span><span class="op">,</span> <span class="dv">1</span><span class="op">),</span></span>
<span id="cb43-907"><a href="#cb43-907" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-908"><a href="#cb43-908" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set operation (like replace, but creates the path if it doesn't exist)</span></span>
<span id="cb43-909"><a href="#cb43-909" aria-hidden="true" tabindex="-1"></a>    PatchOperation<span class="op">.</span><span class="fu">Set</span><span class="op">(</span><span class="st">"/status/lastChecked"</span><span class="op">,</span> DateTime<span class="op">.</span><span class="fu">UtcNow</span><span class="op">)</span></span>
<span id="cb43-910"><a href="#cb43-910" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb43-911"><a href="#cb43-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-912"><a href="#cb43-912" aria-hidden="true" tabindex="-1"></a><span class="co">// Apply patch with conditional predicate</span></span>
<span id="cb43-913"><a href="#cb43-913" aria-hidden="true" tabindex="-1"></a>PatchItemRequestOptions advancedPatchOptions <span class="op">=</span> <span class="kw">new</span> PatchItemRequestOptions</span>
<span id="cb43-914"><a href="#cb43-914" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-915"><a href="#cb43-915" aria-hidden="true" tabindex="-1"></a>    FilterPredicate <span class="op">=</span> <span class="st">"FROM c WHERE c.version &lt; 5"</span> <span class="co">// Only apply if version is less than 5</span></span>
<span id="cb43-916"><a href="#cb43-916" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb43-917"><a href="#cb43-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-918"><a href="#cb43-918" aria-hidden="true" tabindex="-1"></a><span class="kw">try</span></span>
<span id="cb43-919"><a href="#cb43-919" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-920"><a href="#cb43-920" aria-hidden="true" tabindex="-1"></a>    ItemResponse<span class="op">&lt;</span>dynamic<span class="op">&gt;</span> patchResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">PatchItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb43-921"><a href="#cb43-921" aria-hidden="true" tabindex="-1"></a>        <span class="st">"task-1"</span><span class="op">,</span> </span>
<span id="cb43-922"><a href="#cb43-922" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">),</span></span>
<span id="cb43-923"><a href="#cb43-923" aria-hidden="true" tabindex="-1"></a>        advancedPatchOps<span class="op">,</span></span>
<span id="cb43-924"><a href="#cb43-924" aria-hidden="true" tabindex="-1"></a>        advancedPatchOptions<span class="op">);</span></span>
<span id="cb43-925"><a href="#cb43-925" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-926"><a href="#cb43-926" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Patch applied successfully. New version: {patchResponse.Resource.version}"</span><span class="op">);</span></span>
<span id="cb43-927"><a href="#cb43-927" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-928"><a href="#cb43-928" aria-hidden="true" tabindex="-1"></a><span class="kw">catch</span> <span class="op">(</span>CosmosException ex<span class="op">)</span> <span class="fu">when</span> <span class="op">(</span>ex<span class="op">.</span><span class="fu">StatusCode</span> <span class="op">==</span> HttpStatusCode<span class="op">.</span><span class="fu">PreconditionFailed</span><span class="op">)</span></span>
<span id="cb43-929"><a href="#cb43-929" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-930"><a href="#cb43-930" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">"Patch condition not met - item version is &gt;= 5"</span><span class="op">);</span></span>
<span id="cb43-931"><a href="#cb43-931" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-932"><a href="#cb43-932" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-933"><a href="#cb43-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-934"><a href="#cb43-934" aria-hidden="true" tabindex="-1"></a>#### Performance Comparison <span class="kw">for</span> Update Operations</span>
<span id="cb43-935"><a href="#cb43-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-936"><a href="#cb43-936" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-937"><a href="#cb43-937" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> stopwatch <span class="op">=</span> Stopwatch<span class="op">.</span><span class="fu">StartNew</span><span class="op">();</span></span>
<span id="cb43-938"><a href="#cb43-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-939"><a href="#cb43-939" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Full replace with strongly-typed (type-safe but requires full object)</span></span>
<span id="cb43-940"><a href="#cb43-940" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> typedItem <span class="op">=</span> await container<span class="op">.</span><span class="fu">ReadItemAsync</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span><span class="st">"perf-typed"</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"test"</span><span class="op">));</span></span>
<span id="cb43-941"><a href="#cb43-941" aria-hidden="true" tabindex="-1"></a>typedItem<span class="op">.</span><span class="fu">Resource</span><span class="op">.</span><span class="fu">Title</span> <span class="op">=</span> <span class="st">"Updated"</span><span class="op">;</span></span>
<span id="cb43-942"><a href="#cb43-942" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">ReplaceItemAsync</span><span class="op">(</span>typedItem<span class="op">.</span><span class="fu">Resource</span><span class="op">,</span> <span class="st">"perf-typed"</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"test"</span><span class="op">));</span></span>
<span id="cb43-943"><a href="#cb43-943" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="cb43-944"><a href="#cb43-944" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Strongly-typed replace: {stopwatch.ElapsedMilliseconds}ms"</span><span class="op">);</span></span>
<span id="cb43-945"><a href="#cb43-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-946"><a href="#cb43-946" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Restart</span><span class="op">();</span></span>
<span id="cb43-947"><a href="#cb43-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-948"><a href="#cb43-948" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Patch operation (most efficient for partial updates)</span></span>
<span id="cb43-949"><a href="#cb43-949" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">PatchItemAsync</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb43-950"><a href="#cb43-950" aria-hidden="true" tabindex="-1"></a>    <span class="st">"perf-typed"</span><span class="op">,</span> </span>
<span id="cb43-951"><a href="#cb43-951" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"test"</span><span class="op">),</span></span>
<span id="cb43-952"><a href="#cb43-952" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> PatchOperation<span class="op">.</span><span class="fu">Replace</span><span class="op">(</span><span class="st">"/title"</span><span class="op">,</span> <span class="st">"Patched"</span><span class="op">)</span> <span class="op">});</span></span>
<span id="cb43-953"><a href="#cb43-953" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="cb43-954"><a href="#cb43-954" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Patch operation: {stopwatch.ElapsedMilliseconds}ms"</span><span class="op">);</span></span>
<span id="cb43-955"><a href="#cb43-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-956"><a href="#cb43-956" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Restart</span><span class="op">();</span></span>
<span id="cb43-957"><a href="#cb43-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-958"><a href="#cb43-958" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. JSON stream replace (fastest for full updates, no serialization)</span></span>
<span id="cb43-959"><a href="#cb43-959" aria-hidden="true" tabindex="-1"></a><span class="dt">string</span> jsonUpdate <span class="op">=</span> <span class="st">"""{"</span>id<span class="st">": "</span>perf<span class="op">-</span>json<span class="st">", "</span>partitionKey<span class="st">": "</span>test<span class="st">", "</span>title<span class="st">": "</span>JSON Updated<span class="st">"}"""</span><span class="op">;</span></span>
<span id="cb43-960"><a href="#cb43-960" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="dt">var</span> stream <span class="op">=</span> <span class="kw">new</span> <span class="fu">MemoryStream</span><span class="op">(</span>Encoding<span class="op">.</span><span class="fu">UTF8</span><span class="op">.</span><span class="fu">GetBytes</span><span class="op">(</span>jsonUpdate<span class="op">));</span></span>
<span id="cb43-961"><a href="#cb43-961" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">ReplaceItemStreamAsync</span><span class="op">(</span>stream<span class="op">,</span> <span class="st">"perf-json"</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"test"</span><span class="op">));</span></span>
<span id="cb43-962"><a href="#cb43-962" aria-hidden="true" tabindex="-1"></a>stopwatch<span class="op">.</span><span class="fu">Stop</span><span class="op">();</span></span>
<span id="cb43-963"><a href="#cb43-963" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Raw JSON replace: {stopwatch.ElapsedMilliseconds}ms"</span><span class="op">);</span></span>
<span id="cb43-964"><a href="#cb43-964" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-965"><a href="#cb43-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-966"><a href="#cb43-966" aria-hidden="true" tabindex="-1"></a>### Delete</span>
<span id="cb43-967"><a href="#cb43-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-968"><a href="#cb43-968" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-969"><a href="#cb43-969" aria-hidden="true" tabindex="-1"></a><span class="co">// Delete an item</span></span>
<span id="cb43-970"><a href="#cb43-970" aria-hidden="true" tabindex="-1"></a><span class="kw">try</span></span>
<span id="cb43-971"><a href="#cb43-971" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-972"><a href="#cb43-972" aria-hidden="true" tabindex="-1"></a>    await container<span class="op">.</span><span class="fu">DeleteItemAsync</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb43-973"><a href="#cb43-973" aria-hidden="true" tabindex="-1"></a>        <span class="st">"task-1"</span><span class="op">,</span> </span>
<span id="cb43-974"><a href="#cb43-974" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">));</span></span>
<span id="cb43-975"><a href="#cb43-975" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-976"><a href="#cb43-976" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">"Item deleted successfully"</span><span class="op">);</span></span>
<span id="cb43-977"><a href="#cb43-977" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-978"><a href="#cb43-978" aria-hidden="true" tabindex="-1"></a><span class="kw">catch</span> <span class="op">(</span>CosmosException ex<span class="op">)</span> <span class="fu">when</span> <span class="op">(</span>ex<span class="op">.</span><span class="fu">StatusCode</span> <span class="op">==</span> HttpStatusCode<span class="op">.</span><span class="fu">NotFound</span><span class="op">)</span></span>
<span id="cb43-979"><a href="#cb43-979" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-980"><a href="#cb43-980" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">"Item not found"</span><span class="op">);</span></span>
<span id="cb43-981"><a href="#cb43-981" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-982"><a href="#cb43-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-983"><a href="#cb43-983" aria-hidden="true" tabindex="-1"></a><span class="co">// Delete with optimistic concurrency</span></span>
<span id="cb43-984"><a href="#cb43-984" aria-hidden="true" tabindex="-1"></a><span class="dt">string</span> etag <span class="op">=</span> <span class="st">"</span><span class="sc">\"</span><span class="st">00000000-0000-0000-0000-000000000000</span><span class="sc">\"</span><span class="st">"</span><span class="op">;</span> <span class="co">// ETag from previous read</span></span>
<span id="cb43-985"><a href="#cb43-985" aria-hidden="true" tabindex="-1"></a>ItemRequestOptions deleteOptions <span class="op">=</span> <span class="kw">new</span> ItemRequestOptions</span>
<span id="cb43-986"><a href="#cb43-986" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-987"><a href="#cb43-987" aria-hidden="true" tabindex="-1"></a>    IfMatchEtag <span class="op">=</span> etag</span>
<span id="cb43-988"><a href="#cb43-988" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb43-989"><a href="#cb43-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-990"><a href="#cb43-990" aria-hidden="true" tabindex="-1"></a>await container<span class="op">.</span><span class="fu">DeleteItemAsync</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb43-991"><a href="#cb43-991" aria-hidden="true" tabindex="-1"></a>    <span class="st">"task-1"</span><span class="op">,</span> </span>
<span id="cb43-992"><a href="#cb43-992" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">),</span></span>
<span id="cb43-993"><a href="#cb43-993" aria-hidden="true" tabindex="-1"></a>    deleteOptions<span class="op">);</span></span>
<span id="cb43-994"><a href="#cb43-994" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-995"><a href="#cb43-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-996"><a href="#cb43-996" aria-hidden="true" tabindex="-1"></a>## Advanced Patterns</span>
<span id="cb43-997"><a href="#cb43-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-998"><a href="#cb43-998" aria-hidden="true" tabindex="-1"></a>### Bulk Operations</span>
<span id="cb43-999"><a href="#cb43-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1000"><a href="#cb43-1000" aria-hidden="true" tabindex="-1"></a>For high<span class="op">-</span>throughput scenarios<span class="op">,</span> Cosmos DB provides bulk operations through parallel tasks<span class="op">:</span></span>
<span id="cb43-1001"><a href="#cb43-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1002"><a href="#cb43-1002" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-1003"><a href="#cb43-1003" aria-hidden="true" tabindex="-1"></a><span class="co">// Prepare items to create</span></span>
<span id="cb43-1004"><a href="#cb43-1004" aria-hidden="true" tabindex="-1"></a>List<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> itemsToCreate <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>TodoItem<span class="op">&gt;();</span></span>
<span id="cb43-1005"><a href="#cb43-1005" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">100</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb43-1006"><a href="#cb43-1006" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-1007"><a href="#cb43-1007" aria-hidden="true" tabindex="-1"></a>    itemsToCreate<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> TodoItem</span>
<span id="cb43-1008"><a href="#cb43-1008" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-1009"><a href="#cb43-1009" aria-hidden="true" tabindex="-1"></a>        Id <span class="op">=</span> $<span class="st">"bulk-task-{i}"</span><span class="op">,</span></span>
<span id="cb43-1010"><a href="#cb43-1010" aria-hidden="true" tabindex="-1"></a>        PartitionKey <span class="op">=</span> <span class="st">"bulk"</span><span class="op">,</span></span>
<span id="cb43-1011"><a href="#cb43-1011" aria-hidden="true" tabindex="-1"></a>        Title <span class="op">=</span> $<span class="st">"Bulk created item {i}"</span><span class="op">,</span></span>
<span id="cb43-1012"><a href="#cb43-1012" aria-hidden="true" tabindex="-1"></a>        Completed <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb43-1013"><a href="#cb43-1013" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb43-1014"><a href="#cb43-1014" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-1015"><a href="#cb43-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1016"><a href="#cb43-1016" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a list of tasks for parallel execution</span></span>
<span id="cb43-1017"><a href="#cb43-1017" aria-hidden="true" tabindex="-1"></a>List<span class="op">&lt;</span>Task<span class="op">&gt;</span> concurrentTasks <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>Task<span class="op">&gt;();</span></span>
<span id="cb43-1018"><a href="#cb43-1018" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="op">(</span><span class="dt">var</span> item <span class="kw">in</span> itemsToCreate<span class="op">)</span></span>
<span id="cb43-1019"><a href="#cb43-1019" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-1020"><a href="#cb43-1020" aria-hidden="true" tabindex="-1"></a>    concurrentTasks<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">(</span></span>
<span id="cb43-1021"><a href="#cb43-1021" aria-hidden="true" tabindex="-1"></a>        item<span class="op">,</span> </span>
<span id="cb43-1022"><a href="#cb43-1022" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span>item<span class="op">.</span><span class="fu">PartitionKey</span><span class="op">))</span></span>
<span id="cb43-1023"><a href="#cb43-1023" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">ContinueWith</span><span class="op">(</span>itemTask <span class="op">=&gt;</span></span>
<span id="cb43-1024"><a href="#cb43-1024" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb43-1025"><a href="#cb43-1025" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>itemTask<span class="op">.</span><span class="fu">IsCompletedSuccessfully</span><span class="op">)</span></span>
<span id="cb43-1026"><a href="#cb43-1026" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb43-1027"><a href="#cb43-1027" aria-hidden="true" tabindex="-1"></a>                ItemResponse<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> response <span class="op">=</span> itemTask<span class="op">.</span><span class="fu">Result</span><span class="op">;</span></span>
<span id="cb43-1028"><a href="#cb43-1028" aria-hidden="true" tabindex="-1"></a>                Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Created item {item.Id}: {response.RequestCharge} RUs"</span><span class="op">);</span></span>
<span id="cb43-1029"><a href="#cb43-1029" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb43-1030"><a href="#cb43-1030" aria-hidden="true" tabindex="-1"></a>            <span class="kw">else</span></span>
<span id="cb43-1031"><a href="#cb43-1031" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb43-1032"><a href="#cb43-1032" aria-hidden="true" tabindex="-1"></a>                AggregateException exceptions <span class="op">=</span> itemTask<span class="op">.</span><span class="fu">Exception</span><span class="op">;</span></span>
<span id="cb43-1033"><a href="#cb43-1033" aria-hidden="true" tabindex="-1"></a>                Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Failed to create item {item.Id}: {exceptions.InnerException.Message}"</span><span class="op">);</span></span>
<span id="cb43-1034"><a href="#cb43-1034" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb43-1035"><a href="#cb43-1035" aria-hidden="true" tabindex="-1"></a>        <span class="op">}));</span></span>
<span id="cb43-1036"><a href="#cb43-1036" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-1037"><a href="#cb43-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1038"><a href="#cb43-1038" aria-hidden="true" tabindex="-1"></a><span class="co">// Wait for all operations to complete</span></span>
<span id="cb43-1039"><a href="#cb43-1039" aria-hidden="true" tabindex="-1"></a>await Task<span class="op">.</span><span class="fu">WhenAll</span><span class="op">(</span>concurrentTasks<span class="op">);</span></span>
<span id="cb43-1040"><a href="#cb43-1040" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-1041"><a href="#cb43-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1042"><a href="#cb43-1042" aria-hidden="true" tabindex="-1"></a>### Change Feed Processing</span>
<span id="cb43-1043"><a href="#cb43-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1044"><a href="#cb43-1044" aria-hidden="true" tabindex="-1"></a>The Change Feed <span class="kw">is</span> a powerful feature that provides a log of all changes to your containers<span class="op">:</span></span>
<span id="cb43-1045"><a href="#cb43-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1046"><a href="#cb43-1046" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-1047"><a href="#cb43-1047" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Basic change feed processor</span></span>
<span id="cb43-1048"><a href="#cb43-1048" aria-hidden="true" tabindex="-1"></a>Container leaseContainer <span class="op">=</span> await database<span class="op">.</span><span class="fu">CreateContainerIfNotExistsAsync</span><span class="op">(</span></span>
<span id="cb43-1049"><a href="#cb43-1049" aria-hidden="true" tabindex="-1"></a>    <span class="st">"leases"</span><span class="op">,</span> </span>
<span id="cb43-1050"><a href="#cb43-1050" aria-hidden="true" tabindex="-1"></a>    <span class="st">"/id"</span><span class="op">,</span> </span>
<span id="cb43-1051"><a href="#cb43-1051" aria-hidden="true" tabindex="-1"></a>    <span class="dv">400</span><span class="op">);</span></span>
<span id="cb43-1052"><a href="#cb43-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1053"><a href="#cb43-1053" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> changeFeedProcessor <span class="op">=</span> container<span class="op">.</span><span class="fu">GetChangeFeedProcessorBuilder</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb43-1054"><a href="#cb43-1054" aria-hidden="true" tabindex="-1"></a>    processorName<span class="op">:</span> <span class="st">"todoChanges"</span><span class="op">,</span></span>
<span id="cb43-1055"><a href="#cb43-1055" aria-hidden="true" tabindex="-1"></a>    onChangesDelegate<span class="op">:</span> HandleChangesAsync<span class="op">)</span></span>
<span id="cb43-1056"><a href="#cb43-1056" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">WithInstanceName</span><span class="op">(</span><span class="st">"workerInstance1"</span><span class="op">)</span></span>
<span id="cb43-1057"><a href="#cb43-1057" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">WithLeaseContainer</span><span class="op">(</span>leaseContainer<span class="op">)</span></span>
<span id="cb43-1058"><a href="#cb43-1058" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">Build</span><span class="op">();</span></span>
<span id="cb43-1059"><a href="#cb43-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1060"><a href="#cb43-1060" aria-hidden="true" tabindex="-1"></a>await changeFeedProcessor<span class="op">.</span><span class="fu">StartAsync</span><span class="op">();</span></span>
<span id="cb43-1061"><a href="#cb43-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1062"><a href="#cb43-1062" aria-hidden="true" tabindex="-1"></a><span class="co">// Handle changes</span></span>
<span id="cb43-1063"><a href="#cb43-1063" aria-hidden="true" tabindex="-1"></a>async Task <span class="fu">HandleChangesAsync</span><span class="op">(</span></span>
<span id="cb43-1064"><a href="#cb43-1064" aria-hidden="true" tabindex="-1"></a>    ChangeFeedProcessorContext context<span class="op">,</span> </span>
<span id="cb43-1065"><a href="#cb43-1065" aria-hidden="true" tabindex="-1"></a>    IReadOnlyCollection<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> changes<span class="op">,</span> </span>
<span id="cb43-1066"><a href="#cb43-1066" aria-hidden="true" tabindex="-1"></a>    CancellationToken cancellationToken<span class="op">)</span></span>
<span id="cb43-1067"><a href="#cb43-1067" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-1068"><a href="#cb43-1068" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Detected {changes.Count} document changes"</span><span class="op">);</span></span>
<span id="cb43-1069"><a href="#cb43-1069" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="op">(</span>TodoItem item <span class="kw">in</span> changes<span class="op">)</span></span>
<span id="cb43-1070"><a href="#cb43-1070" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-1071"><a href="#cb43-1071" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Changed item: {item.Id}, Title: {item.Title}"</span><span class="op">);</span></span>
<span id="cb43-1072"><a href="#cb43-1072" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Process changes - update cache, trigger workflows, etc.</span></span>
<span id="cb43-1073"><a href="#cb43-1073" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb43-1074"><a href="#cb43-1074" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-1075"><a href="#cb43-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1076"><a href="#cb43-1076" aria-hidden="true" tabindex="-1"></a><span class="co">// Later - stop the processor</span></span>
<span id="cb43-1077"><a href="#cb43-1077" aria-hidden="true" tabindex="-1"></a>await changeFeedProcessor<span class="op">.</span><span class="fu">StopAsync</span><span class="op">();</span></span>
<span id="cb43-1078"><a href="#cb43-1078" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-1079"><a href="#cb43-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1080"><a href="#cb43-1080" aria-hidden="true" tabindex="-1"></a>### Server<span class="op">-</span>Side Programming</span>
<span id="cb43-1081"><a href="#cb43-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1082"><a href="#cb43-1082" aria-hidden="true" tabindex="-1"></a>CosmosDB supports stored procedures<span class="op">,</span> triggers<span class="op">,</span> and UDFs <span class="kw">for</span> server<span class="op">-</span>side logic<span class="op">:</span></span>
<span id="cb43-1083"><a href="#cb43-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1084"><a href="#cb43-1084" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-1085"><a href="#cb43-1085" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Create a stored procedure</span></span>
<span id="cb43-1086"><a href="#cb43-1086" aria-hidden="true" tabindex="-1"></a><span class="dt">string</span> sprocId <span class="op">=</span> <span class="st">"createTodoItem"</span><span class="op">;</span></span>
<span id="cb43-1087"><a href="#cb43-1087" aria-hidden="true" tabindex="-1"></a><span class="dt">string</span> sprocBody <span class="op">=</span> @<span class="st">"</span></span>
<span id="cb43-1088"><a href="#cb43-1088" aria-hidden="true" tabindex="-1"></a>function <span class="fu">createTodoItem</span><span class="op">(</span>itemBody<span class="op">)</span> <span class="op">{</span></span>
<span id="cb43-1089"><a href="#cb43-1089" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> context <span class="op">=</span> <span class="fu">getContext</span><span class="op">();</span></span>
<span id="cb43-1090"><a href="#cb43-1090" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> container <span class="op">=</span> context<span class="op">.</span><span class="fu">getCollection</span><span class="op">();</span></span>
<span id="cb43-1091"><a href="#cb43-1091" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> response <span class="op">=</span> context<span class="op">.</span><span class="fu">getResponse</span><span class="op">();</span></span>
<span id="cb43-1092"><a href="#cb43-1092" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-1093"><a href="#cb43-1093" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Generate ID if not provided</span></span>
<span id="cb43-1094"><a href="#cb43-1094" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(!</span>itemBody<span class="op">.</span><span class="fu">id</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb43-1095"><a href="#cb43-1095" aria-hidden="true" tabindex="-1"></a>        itemBody<span class="op">.</span><span class="fu">id</span> <span class="op">=</span> <span class="fu">generateGuid</span><span class="op">();</span></span>
<span id="cb43-1096"><a href="#cb43-1096" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb43-1097"><a href="#cb43-1097" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-1098"><a href="#cb43-1098" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add creation timestamp</span></span>
<span id="cb43-1099"><a href="#cb43-1099" aria-hidden="true" tabindex="-1"></a>    itemBody<span class="op">.</span><span class="fu">createdAt</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">Date</span><span class="op">().</span><span class="fu">toISOString</span><span class="op">();</span></span>
<span id="cb43-1100"><a href="#cb43-1100" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-1101"><a href="#cb43-1101" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create document</span></span>
<span id="cb43-1102"><a href="#cb43-1102" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> accepted <span class="op">=</span> container<span class="op">.</span><span class="fu">createDocument</span><span class="op">(</span></span>
<span id="cb43-1103"><a href="#cb43-1103" aria-hidden="true" tabindex="-1"></a>        container<span class="op">.</span><span class="fu">getSelfLink</span><span class="op">(),</span></span>
<span id="cb43-1104"><a href="#cb43-1104" aria-hidden="true" tabindex="-1"></a>        itemBody<span class="op">,</span></span>
<span id="cb43-1105"><a href="#cb43-1105" aria-hidden="true" tabindex="-1"></a>        <span class="fu">function</span><span class="op">(</span>err<span class="op">,</span> documentCreated<span class="op">)</span> <span class="op">{</span></span>
<span id="cb43-1106"><a href="#cb43-1106" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>err<span class="op">)</span> <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">Error</span><span class="op">(</span>'Error<span class="op">:</span> ' <span class="op">+</span> err<span class="op">.</span><span class="fu">message</span><span class="op">);</span></span>
<span id="cb43-1107"><a href="#cb43-1107" aria-hidden="true" tabindex="-1"></a>            response<span class="op">.</span><span class="fu">setBody</span><span class="op">(</span>documentCreated<span class="op">);</span></span>
<span id="cb43-1108"><a href="#cb43-1108" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb43-1109"><a href="#cb43-1109" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb43-1110"><a href="#cb43-1110" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-1111"><a href="#cb43-1111" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(!</span>accepted<span class="op">)</span> <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">Error</span><span class="op">(</span>'The item create was not accepted'<span class="op">);</span></span>
<span id="cb43-1112"><a href="#cb43-1112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-1113"><a href="#cb43-1113" aria-hidden="true" tabindex="-1"></a>    function <span class="fu">generateGuid</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb43-1114"><a href="#cb43-1114" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> 'xxxxxxxx<span class="op">-</span>xxxx<span class="dv">-4</span>xxx<span class="op">-</span>yxxx<span class="op">-</span>xxxxxxxxxxxx'<span class="op">.</span><span class="fu">replace</span><span class="op">(/[</span>xy<span class="op">]/</span>g<span class="op">,</span> <span class="fu">function</span><span class="op">(</span>c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb43-1115"><a href="#cb43-1115" aria-hidden="true" tabindex="-1"></a>            <span class="dt">var</span> r <span class="op">=</span> Math<span class="op">.</span><span class="fu">random</span><span class="op">()</span> <span class="op">*</span> <span class="dv">16</span> <span class="op">|</span> <span class="dv">0</span><span class="op">,</span> v <span class="op">=</span> c <span class="op">==</span> <span class="ch">'x'</span> <span class="op">?</span> r <span class="op">:</span> <span class="op">(</span>r <span class="op">&amp;</span> <span class="bn">0x3</span> <span class="op">|</span> <span class="bn">0x8</span><span class="op">);</span></span>
<span id="cb43-1116"><a href="#cb43-1116" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> v<span class="op">.</span><span class="fu">toString</span><span class="op">(</span><span class="dv">16</span><span class="op">);</span></span>
<span id="cb43-1117"><a href="#cb43-1117" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="cb43-1118"><a href="#cb43-1118" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb43-1119"><a href="#cb43-1119" aria-hidden="true" tabindex="-1"></a><span class="op">}</span><span class="st">";</span></span>
<span id="cb43-1120"><a href="#cb43-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1121"><a href="#cb43-1121" aria-hidden="true" tabindex="-1"></a>StoredProcedureResponse response <span class="op">=</span> await container<span class="op">.</span><span class="fu">Scripts</span><span class="op">.</span><span class="fu">CreateStoredProcedureAsync</span><span class="op">(</span></span>
<span id="cb43-1122"><a href="#cb43-1122" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> StoredProcedureProperties</span>
<span id="cb43-1123"><a href="#cb43-1123" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-1124"><a href="#cb43-1124" aria-hidden="true" tabindex="-1"></a>        Id <span class="op">=</span> sprocId<span class="op">,</span></span>
<span id="cb43-1125"><a href="#cb43-1125" aria-hidden="true" tabindex="-1"></a>        Body <span class="op">=</span> sprocBody</span>
<span id="cb43-1126"><a href="#cb43-1126" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb43-1127"><a href="#cb43-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1128"><a href="#cb43-1128" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Execute a stored procedure</span></span>
<span id="cb43-1129"><a href="#cb43-1129" aria-hidden="true" tabindex="-1"></a>dynamic todoItem <span class="op">=</span> <span class="kw">new</span></span>
<span id="cb43-1130"><a href="#cb43-1130" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-1131"><a href="#cb43-1131" aria-hidden="true" tabindex="-1"></a>    partitionKey <span class="op">=</span> <span class="st">"personal"</span><span class="op">,</span></span>
<span id="cb43-1132"><a href="#cb43-1132" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> <span class="st">"Learn about stored procedures"</span><span class="op">,</span></span>
<span id="cb43-1133"><a href="#cb43-1133" aria-hidden="true" tabindex="-1"></a>    completed <span class="op">=</span> <span class="kw">false</span></span>
<span id="cb43-1134"><a href="#cb43-1134" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb43-1135"><a href="#cb43-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1136"><a href="#cb43-1136" aria-hidden="true" tabindex="-1"></a>StoredProcedureExecuteResponse<span class="op">&lt;</span>dynamic<span class="op">&gt;</span> executeResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">Scripts</span><span class="op">.</span><span class="fu">ExecuteStoredProcedureAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb43-1137"><a href="#cb43-1137" aria-hidden="true" tabindex="-1"></a>    sprocId<span class="op">,</span></span>
<span id="cb43-1138"><a href="#cb43-1138" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"personal"</span><span class="op">),</span></span>
<span id="cb43-1139"><a href="#cb43-1139" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> todoItem <span class="op">});</span></span>
<span id="cb43-1140"><a href="#cb43-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1141"><a href="#cb43-1141" aria-hidden="true" tabindex="-1"></a>dynamic createdItem <span class="op">=</span> executeResponse<span class="op">.</span><span class="fu">Resource</span><span class="op">;</span></span>
<span id="cb43-1142"><a href="#cb43-1142" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Created item ID: {createdItem.id}"</span><span class="op">);</span></span>
<span id="cb43-1143"><a href="#cb43-1143" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-1144"><a href="#cb43-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1145"><a href="#cb43-1145" aria-hidden="true" tabindex="-1"></a>### Retry Policies</span>
<span id="cb43-1146"><a href="#cb43-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1147"><a href="#cb43-1147" aria-hidden="true" tabindex="-1"></a>The Cosmos SDK has built<span class="op">-</span><span class="kw">in</span> retry policies<span class="op">,</span> but you can customize them<span class="op">:</span></span>
<span id="cb43-1148"><a href="#cb43-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1149"><a href="#cb43-1149" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-1150"><a href="#cb43-1150" aria-hidden="true" tabindex="-1"></a><span class="co">// Custom retry policy for handling rate limiting (429) errors</span></span>
<span id="cb43-1151"><a href="#cb43-1151" aria-hidden="true" tabindex="-1"></a>CosmosClientOptions options <span class="op">=</span> <span class="kw">new</span> CosmosClientOptions</span>
<span id="cb43-1152"><a href="#cb43-1152" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-1153"><a href="#cb43-1153" aria-hidden="true" tabindex="-1"></a>    MaxRetryAttemptsOnRateLimitedRequests <span class="op">=</span> <span class="dv">9</span><span class="op">,</span></span>
<span id="cb43-1154"><a href="#cb43-1154" aria-hidden="true" tabindex="-1"></a>    MaxRetryWaitTimeOnRateLimitedRequests <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromSeconds</span><span class="op">(</span><span class="dv">30</span><span class="op">)</span></span>
<span id="cb43-1155"><a href="#cb43-1155" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb43-1156"><a href="#cb43-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1157"><a href="#cb43-1157" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> cosmosClient <span class="op">=</span> <span class="kw">new</span> <span class="fu">CosmosClient</span><span class="op">(</span>endpoint<span class="op">,</span> key<span class="op">,</span> options<span class="op">);</span></span>
<span id="cb43-1158"><a href="#cb43-1158" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-1159"><a href="#cb43-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1160"><a href="#cb43-1160" aria-hidden="true" tabindex="-1"></a>For more complex scenarios<span class="op">,</span> you can use Polly<span class="op">:</span></span>
<span id="cb43-1161"><a href="#cb43-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1162"><a href="#cb43-1162" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-1163"><a href="#cb43-1163" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Polly<span class="op">;</span></span>
<span id="cb43-1164"><a href="#cb43-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1165"><a href="#cb43-1165" aria-hidden="true" tabindex="-1"></a><span class="co">// Define policy</span></span>
<span id="cb43-1166"><a href="#cb43-1166" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> retryPolicy <span class="op">=</span> Policy</span>
<span id="cb43-1167"><a href="#cb43-1167" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">Handle</span><span class="op">&lt;</span>CosmosException<span class="op">&gt;(</span>ex <span class="op">=&gt;</span> ex<span class="op">.</span><span class="fu">StatusCode</span> <span class="op">==</span> HttpStatusCode<span class="op">.</span><span class="fu">TooManyRequests</span><span class="op">)</span></span>
<span id="cb43-1168"><a href="#cb43-1168" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">WaitAndRetryAsync</span><span class="op">(</span></span>
<span id="cb43-1169"><a href="#cb43-1169" aria-hidden="true" tabindex="-1"></a>        retryCount<span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb43-1170"><a href="#cb43-1170" aria-hidden="true" tabindex="-1"></a>        sleepDurationProvider<span class="op">:</span> <span class="op">(</span>attempt<span class="op">)</span> <span class="op">=&gt;</span> TimeSpan<span class="op">.</span><span class="fu">FromSeconds</span><span class="op">(</span>Math<span class="op">.</span><span class="fu">Pow</span><span class="op">(</span><span class="dv">2</span><span class="op">,</span> attempt<span class="op">)),</span></span>
<span id="cb43-1171"><a href="#cb43-1171" aria-hidden="true" tabindex="-1"></a>        onRetry<span class="op">:</span> <span class="op">(</span>exception<span class="op">,</span> timespan<span class="op">,</span> retryCount<span class="op">,</span> context<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb43-1172"><a href="#cb43-1172" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb43-1173"><a href="#cb43-1173" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">"Retry {retryCount} after {timespan.TotalSeconds}s due to {exception.Message}"</span><span class="op">);</span></span>
<span id="cb43-1174"><a href="#cb43-1174" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="cb43-1175"><a href="#cb43-1175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1176"><a href="#cb43-1176" aria-hidden="true" tabindex="-1"></a><span class="co">// Execute with policy</span></span>
<span id="cb43-1177"><a href="#cb43-1177" aria-hidden="true" tabindex="-1"></a>await retryPolicy<span class="op">.</span><span class="fu">ExecuteAsync</span><span class="op">(</span><span class="fu">async</span> <span class="op">()</span> <span class="op">=&gt;</span></span>
<span id="cb43-1178"><a href="#cb43-1178" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-1179"><a href="#cb43-1179" aria-hidden="true" tabindex="-1"></a>    await container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">(</span></span>
<span id="cb43-1180"><a href="#cb43-1180" aria-hidden="true" tabindex="-1"></a>        newItem<span class="op">,</span> </span>
<span id="cb43-1181"><a href="#cb43-1181" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span>newItem<span class="op">.</span><span class="fu">PartitionKey</span><span class="op">));</span></span>
<span id="cb43-1182"><a href="#cb43-1182" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span>
<span id="cb43-1183"><a href="#cb43-1183" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-1184"><a href="#cb43-1184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1185"><a href="#cb43-1185" aria-hidden="true" tabindex="-1"></a>### Dependency Injection Setup</span>
<span id="cb43-1186"><a href="#cb43-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1187"><a href="#cb43-1187" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-1188"><a href="#cb43-1188" aria-hidden="true" tabindex="-1"></a><span class="co">// Program.cs or Startup.cs</span></span>
<span id="cb43-1189"><a href="#cb43-1189" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span><span class="op">;</span></span>
<span id="cb43-1190"><a href="#cb43-1190" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Microsoft<span class="op">.</span><span class="fu">Extensions</span><span class="op">.</span><span class="fu">DependencyInjection</span><span class="op">;</span></span>
<span id="cb43-1191"><a href="#cb43-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1192"><a href="#cb43-1192" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">ConfigureServices</span><span class="op">(</span>IServiceCollection services<span class="op">)</span></span>
<span id="cb43-1193"><a href="#cb43-1193" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-1194"><a href="#cb43-1194" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Register CosmosClient as singleton</span></span>
<span id="cb43-1195"><a href="#cb43-1195" aria-hidden="true" tabindex="-1"></a>    services<span class="op">.</span><span class="fu">AddSingleton</span><span class="op">(</span>serviceProvider <span class="op">=&gt;</span></span>
<span id="cb43-1196"><a href="#cb43-1196" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-1197"><a href="#cb43-1197" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> configuration <span class="op">=</span> serviceProvider<span class="op">.</span><span class="fu">GetRequiredService</span><span class="op">&lt;</span>IConfiguration<span class="op">&gt;();</span></span>
<span id="cb43-1198"><a href="#cb43-1198" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="kw">new</span> <span class="fu">CosmosClient</span><span class="op">(</span></span>
<span id="cb43-1199"><a href="#cb43-1199" aria-hidden="true" tabindex="-1"></a>            configuration<span class="op">[</span><span class="st">"CosmosDb:EndpointUrl"</span><span class="op">],</span> </span>
<span id="cb43-1200"><a href="#cb43-1200" aria-hidden="true" tabindex="-1"></a>            configuration<span class="op">[</span><span class="st">"CosmosDb:PrimaryKey"</span><span class="op">],</span></span>
<span id="cb43-1201"><a href="#cb43-1201" aria-hidden="true" tabindex="-1"></a>            <span class="kw">new</span> CosmosClientOptions</span>
<span id="cb43-1202"><a href="#cb43-1202" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb43-1203"><a href="#cb43-1203" aria-hidden="true" tabindex="-1"></a>                SerializerOptions <span class="op">=</span> <span class="kw">new</span> CosmosSerializationOptions</span>
<span id="cb43-1204"><a href="#cb43-1204" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb43-1205"><a href="#cb43-1205" aria-hidden="true" tabindex="-1"></a>                    PropertyNamingPolicy <span class="op">=</span> CosmosPropertyNamingPolicy<span class="op">.</span><span class="fu">CamelCase</span></span>
<span id="cb43-1206"><a href="#cb43-1206" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb43-1207"><a href="#cb43-1207" aria-hidden="true" tabindex="-1"></a>            <span class="op">});</span></span>
<span id="cb43-1208"><a href="#cb43-1208" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb43-1209"><a href="#cb43-1209" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-1210"><a href="#cb43-1210" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Register database and container clients</span></span>
<span id="cb43-1211"><a href="#cb43-1211" aria-hidden="true" tabindex="-1"></a>    services<span class="op">.</span><span class="fu">AddSingleton</span><span class="op">(</span>serviceProvider <span class="op">=&gt;</span></span>
<span id="cb43-1212"><a href="#cb43-1212" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-1213"><a href="#cb43-1213" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> cosmosClient <span class="op">=</span> serviceProvider<span class="op">.</span><span class="fu">GetRequiredService</span><span class="op">&lt;</span>CosmosClient<span class="op">&gt;();</span></span>
<span id="cb43-1214"><a href="#cb43-1214" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> cosmosClient<span class="op">.</span><span class="fu">GetDatabase</span><span class="op">(</span><span class="st">"MyDatabase"</span><span class="op">);</span></span>
<span id="cb43-1215"><a href="#cb43-1215" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb43-1216"><a href="#cb43-1216" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-1217"><a href="#cb43-1217" aria-hidden="true" tabindex="-1"></a>    services<span class="op">.</span><span class="fu">AddSingleton</span><span class="op">(</span>serviceProvider <span class="op">=&gt;</span></span>
<span id="cb43-1218"><a href="#cb43-1218" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-1219"><a href="#cb43-1219" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> database <span class="op">=</span> serviceProvider<span class="op">.</span><span class="fu">GetRequiredService</span><span class="op">&lt;</span>Database<span class="op">&gt;();</span></span>
<span id="cb43-1220"><a href="#cb43-1220" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> database<span class="op">.</span><span class="fu">GetContainer</span><span class="op">(</span><span class="st">"TodoItems"</span><span class="op">);</span></span>
<span id="cb43-1221"><a href="#cb43-1221" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb43-1222"><a href="#cb43-1222" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-1223"><a href="#cb43-1223" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Register your services</span></span>
<span id="cb43-1224"><a href="#cb43-1224" aria-hidden="true" tabindex="-1"></a>    services<span class="op">.</span><span class="fu">AddScoped</span><span class="op">&lt;</span>ITodoService<span class="op">,</span> TodoService<span class="op">&gt;();</span></span>
<span id="cb43-1225"><a href="#cb43-1225" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-1226"><a href="#cb43-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1227"><a href="#cb43-1227" aria-hidden="true" tabindex="-1"></a><span class="co">// Service implementation</span></span>
<span id="cb43-1228"><a href="#cb43-1228" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> ITodoService</span>
<span id="cb43-1229"><a href="#cb43-1229" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-1230"><a href="#cb43-1230" aria-hidden="true" tabindex="-1"></a>    Task<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> <span class="fu">GetItemAsync</span><span class="op">(</span><span class="dt">string</span> id<span class="op">,</span> <span class="dt">string</span> partitionKey<span class="op">);</span></span>
<span id="cb43-1231"><a href="#cb43-1231" aria-hidden="true" tabindex="-1"></a>    Task<span class="op">&lt;</span>IEnumerable<span class="op">&lt;</span>TodoItem<span class="op">&gt;&gt;</span> <span class="fu">GetIncompleteItemsAsync</span><span class="op">(</span><span class="dt">string</span> partitionKey<span class="op">);</span></span>
<span id="cb43-1232"><a href="#cb43-1232" aria-hidden="true" tabindex="-1"></a>    Task<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> <span class="fu">CreateItemAsync</span><span class="op">(</span>TodoItem item<span class="op">);</span></span>
<span id="cb43-1233"><a href="#cb43-1233" aria-hidden="true" tabindex="-1"></a>    Task <span class="fu">UpdateItemAsync</span><span class="op">(</span>TodoItem item<span class="op">);</span></span>
<span id="cb43-1234"><a href="#cb43-1234" aria-hidden="true" tabindex="-1"></a>    Task <span class="fu">DeleteItemAsync</span><span class="op">(</span><span class="dt">string</span> id<span class="op">,</span> <span class="dt">string</span> partitionKey<span class="op">);</span></span>
<span id="cb43-1235"><a href="#cb43-1235" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-1236"><a href="#cb43-1236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1237"><a href="#cb43-1237" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> TodoService <span class="op">:</span> ITodoService</span>
<span id="cb43-1238"><a href="#cb43-1238" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-1239"><a href="#cb43-1239" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> Container _container<span class="op">;</span></span>
<span id="cb43-1240"><a href="#cb43-1240" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-1241"><a href="#cb43-1241" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">TodoService</span><span class="op">(</span>Container container<span class="op">)</span></span>
<span id="cb43-1242"><a href="#cb43-1242" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-1243"><a href="#cb43-1243" aria-hidden="true" tabindex="-1"></a>        _container <span class="op">=</span> container<span class="op">;</span></span>
<span id="cb43-1244"><a href="#cb43-1244" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb43-1245"><a href="#cb43-1245" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-1246"><a href="#cb43-1246" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> <span class="fu">GetItemAsync</span><span class="op">(</span><span class="dt">string</span> id<span class="op">,</span> <span class="dt">string</span> partitionKey<span class="op">)</span></span>
<span id="cb43-1247"><a href="#cb43-1247" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-1248"><a href="#cb43-1248" aria-hidden="true" tabindex="-1"></a>        <span class="kw">try</span></span>
<span id="cb43-1249"><a href="#cb43-1249" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb43-1250"><a href="#cb43-1250" aria-hidden="true" tabindex="-1"></a>            <span class="dt">var</span> response <span class="op">=</span> await _container<span class="op">.</span><span class="fu">ReadItemAsync</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb43-1251"><a href="#cb43-1251" aria-hidden="true" tabindex="-1"></a>                id<span class="op">,</span> </span>
<span id="cb43-1252"><a href="#cb43-1252" aria-hidden="true" tabindex="-1"></a>                <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span>partitionKey<span class="op">));</span></span>
<span id="cb43-1253"><a href="#cb43-1253" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb43-1254"><a href="#cb43-1254" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> response<span class="op">.</span><span class="fu">Resource</span><span class="op">;</span></span>
<span id="cb43-1255"><a href="#cb43-1255" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb43-1256"><a href="#cb43-1256" aria-hidden="true" tabindex="-1"></a>        <span class="kw">catch</span> <span class="op">(</span>CosmosException ex<span class="op">)</span> <span class="fu">when</span> <span class="op">(</span>ex<span class="op">.</span><span class="fu">StatusCode</span> <span class="op">==</span> HttpStatusCode<span class="op">.</span><span class="fu">NotFound</span><span class="op">)</span></span>
<span id="cb43-1257"><a href="#cb43-1257" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb43-1258"><a href="#cb43-1258" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb43-1259"><a href="#cb43-1259" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb43-1260"><a href="#cb43-1260" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb43-1261"><a href="#cb43-1261" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-1262"><a href="#cb43-1262" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task<span class="op">&lt;</span>IEnumerable<span class="op">&lt;</span>TodoItem<span class="op">&gt;&gt;</span> <span class="fu">GetIncompleteItemsAsync</span><span class="op">(</span><span class="dt">string</span> partitionKey<span class="op">)</span></span>
<span id="cb43-1263"><a href="#cb43-1263" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-1264"><a href="#cb43-1264" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> query <span class="op">=</span> <span class="kw">new</span> <span class="fu">QueryDefinition</span><span class="op">(</span></span>
<span id="cb43-1265"><a href="#cb43-1265" aria-hidden="true" tabindex="-1"></a>            <span class="st">"SELECT * FROM c WHERE c.partitionKey = @pk AND c.completed = false"</span><span class="op">)</span></span>
<span id="cb43-1266"><a href="#cb43-1266" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">WithParameter</span><span class="op">(</span><span class="st">"@pk"</span><span class="op">,</span> partitionKey<span class="op">);</span></span>
<span id="cb43-1267"><a href="#cb43-1267" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb43-1268"><a href="#cb43-1268" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> results <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>TodoItem<span class="op">&gt;();</span></span>
<span id="cb43-1269"><a href="#cb43-1269" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb43-1270"><a href="#cb43-1270" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> iterator <span class="op">=</span> _container<span class="op">.</span><span class="fu">GetItemQueryIterator</span><span class="op">&lt;</span>TodoItem<span class="op">&gt;(</span></span>
<span id="cb43-1271"><a href="#cb43-1271" aria-hidden="true" tabindex="-1"></a>            query<span class="op">,</span> </span>
<span id="cb43-1272"><a href="#cb43-1272" aria-hidden="true" tabindex="-1"></a>            requestOptions<span class="op">:</span> <span class="kw">new</span> QueryRequestOptions</span>
<span id="cb43-1273"><a href="#cb43-1273" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb43-1274"><a href="#cb43-1274" aria-hidden="true" tabindex="-1"></a>                PartitionKey <span class="op">=</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span>partitionKey<span class="op">)</span></span>
<span id="cb43-1275"><a href="#cb43-1275" aria-hidden="true" tabindex="-1"></a>            <span class="op">});</span></span>
<span id="cb43-1276"><a href="#cb43-1276" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb43-1277"><a href="#cb43-1277" aria-hidden="true" tabindex="-1"></a>        <span class="kw">while</span> <span class="op">(</span>iterator<span class="op">.</span><span class="fu">HasMoreResults</span><span class="op">)</span></span>
<span id="cb43-1278"><a href="#cb43-1278" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb43-1279"><a href="#cb43-1279" aria-hidden="true" tabindex="-1"></a>            <span class="dt">var</span> response <span class="op">=</span> await iterator<span class="op">.</span><span class="fu">ReadNextAsync</span><span class="op">();</span></span>
<span id="cb43-1280"><a href="#cb43-1280" aria-hidden="true" tabindex="-1"></a>            results<span class="op">.</span><span class="fu">AddRange</span><span class="op">(</span>response<span class="op">);</span></span>
<span id="cb43-1281"><a href="#cb43-1281" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb43-1282"><a href="#cb43-1282" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb43-1283"><a href="#cb43-1283" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> results<span class="op">;</span></span>
<span id="cb43-1284"><a href="#cb43-1284" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb43-1285"><a href="#cb43-1285" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-1286"><a href="#cb43-1286" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task<span class="op">&lt;</span>TodoItem<span class="op">&gt;</span> <span class="fu">CreateItemAsync</span><span class="op">(</span>TodoItem item<span class="op">)</span></span>
<span id="cb43-1287"><a href="#cb43-1287" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-1288"><a href="#cb43-1288" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> response <span class="op">=</span> await _container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">(</span></span>
<span id="cb43-1289"><a href="#cb43-1289" aria-hidden="true" tabindex="-1"></a>            item<span class="op">,</span> </span>
<span id="cb43-1290"><a href="#cb43-1290" aria-hidden="true" tabindex="-1"></a>            <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span>item<span class="op">.</span><span class="fu">PartitionKey</span><span class="op">));</span></span>
<span id="cb43-1291"><a href="#cb43-1291" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb43-1292"><a href="#cb43-1292" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> response<span class="op">.</span><span class="fu">Resource</span><span class="op">;</span></span>
<span id="cb43-1293"><a href="#cb43-1293" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb43-1294"><a href="#cb43-1294" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-1295"><a href="#cb43-1295" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Additional methods...</span></span>
<span id="cb43-1296"><a href="#cb43-1296" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-1297"><a href="#cb43-1297" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-1298"><a href="#cb43-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1299"><a href="#cb43-1299" aria-hidden="true" tabindex="-1"></a>## Authentication Approaches</span>
<span id="cb43-1300"><a href="#cb43-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1301"><a href="#cb43-1301" aria-hidden="true" tabindex="-1"></a>Azure Cosmos DB supports multiple authentication methods<span class="op">,</span> each with its own security characteristics and use cases<span class="op">:</span></span>
<span id="cb43-1302"><a href="#cb43-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1303"><a href="#cb43-1303" aria-hidden="true" tabindex="-1"></a>### <span class="fl">1.</span> <span class="op">**</span>Primary Key <span class="fu">Authentication</span> <span class="op">(</span>Connection String<span class="op">)**</span></span>
<span id="cb43-1304"><a href="#cb43-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1305"><a href="#cb43-1305" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-1306"><a href="#cb43-1306" aria-hidden="true" tabindex="-1"></a><span class="co">// Basic endpoint and key authentication</span></span>
<span id="cb43-1307"><a href="#cb43-1307" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> endpoint <span class="op">=</span> <span class="st">"https://your-account.documents.azure.com:443/"</span><span class="op">;</span></span>
<span id="cb43-1308"><a href="#cb43-1308" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> primaryKey <span class="op">=</span> <span class="st">"your-primary-key"</span><span class="op">;</span></span>
<span id="cb43-1309"><a href="#cb43-1309" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> cosmosClient <span class="op">=</span> <span class="kw">new</span> <span class="fu">CosmosClient</span><span class="op">(</span>endpoint<span class="op">,</span> primaryKey<span class="op">);</span></span>
<span id="cb43-1310"><a href="#cb43-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1311"><a href="#cb43-1311" aria-hidden="true" tabindex="-1"></a><span class="co">// Alternative: Connection string</span></span>
<span id="cb43-1312"><a href="#cb43-1312" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> connectionString <span class="op">=</span> <span class="st">"AccountEndpoint=https://your-account.documents.azure.com:443/;AccountKey=your-primary-key;"</span><span class="op">;</span></span>
<span id="cb43-1313"><a href="#cb43-1313" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> cosmosClient <span class="op">=</span> <span class="kw">new</span> <span class="fu">CosmosClient</span><span class="op">(</span>connectionString<span class="op">);</span></span>
<span id="cb43-1314"><a href="#cb43-1314" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-1315"><a href="#cb43-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1316"><a href="#cb43-1316" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Best <span class="kw">for</span><span class="op">**:</span> Development environments<span class="op">,</span> simple applications<span class="op">,</span> single<span class="op">-</span>service scenarios<span class="op">.</span></span>
<span id="cb43-1317"><a href="#cb43-1317" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Security considerations<span class="op">**:</span> Keys provide full access to the account and should be carefully <span class="kw">protected</span><span class="op">.</span></span>
<span id="cb43-1318"><a href="#cb43-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1319"><a href="#cb43-1319" aria-hidden="true" tabindex="-1"></a>### <span class="fl">2.</span> <span class="op">**</span>Azure Active <span class="fu">Directory</span> <span class="op">(</span>AAD<span class="op">)</span> Authentication<span class="op">**</span></span>
<span id="cb43-1320"><a href="#cb43-1320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1321"><a href="#cb43-1321" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-1322"><a href="#cb43-1322" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Azure<span class="op">.</span><span class="fu">Identity</span><span class="op">;</span></span>
<span id="cb43-1323"><a href="#cb43-1323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1324"><a href="#cb43-1324" aria-hidden="true" tabindex="-1"></a><span class="co">// Using Managed Identity</span></span>
<span id="cb43-1325"><a href="#cb43-1325" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> credential <span class="op">=</span> <span class="kw">new</span> <span class="fu">DefaultAzureCredential</span><span class="op">();</span></span>
<span id="cb43-1326"><a href="#cb43-1326" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> cosmosClient <span class="op">=</span> <span class="kw">new</span> <span class="fu">CosmosClient</span><span class="op">(</span>endpoint<span class="op">,</span> credential<span class="op">);</span></span>
<span id="cb43-1327"><a href="#cb43-1327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1328"><a href="#cb43-1328" aria-hidden="true" tabindex="-1"></a><span class="co">// Using Service Principal</span></span>
<span id="cb43-1329"><a href="#cb43-1329" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> servicePrincipalCredential <span class="op">=</span> <span class="kw">new</span> <span class="fu">ClientSecretCredential</span><span class="op">(</span></span>
<span id="cb43-1330"><a href="#cb43-1330" aria-hidden="true" tabindex="-1"></a>    tenantId<span class="op">:</span> <span class="st">"your-tenant-id"</span><span class="op">,</span></span>
<span id="cb43-1331"><a href="#cb43-1331" aria-hidden="true" tabindex="-1"></a>    clientId<span class="op">:</span> <span class="st">"your-client-id"</span><span class="op">,</span></span>
<span id="cb43-1332"><a href="#cb43-1332" aria-hidden="true" tabindex="-1"></a>    clientSecret<span class="op">:</span> <span class="st">"your-client-secret"</span><span class="op">);</span></span>
<span id="cb43-1333"><a href="#cb43-1333" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-1334"><a href="#cb43-1334" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> cosmosClient <span class="op">=</span> <span class="kw">new</span> <span class="fu">CosmosClient</span><span class="op">(</span>endpoint<span class="op">,</span> servicePrincipalCredential<span class="op">);</span></span>
<span id="cb43-1335"><a href="#cb43-1335" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-1336"><a href="#cb43-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1337"><a href="#cb43-1337" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Best <span class="kw">for</span><span class="op">**:</span> Production environments<span class="op">,</span> multi<span class="op">-</span>service applications<span class="op">,</span> Azure<span class="op">-</span>hosted services<span class="op">.</span></span>
<span id="cb43-1338"><a href="#cb43-1338" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Security considerations<span class="op">**:</span> No secrets <span class="kw">in</span> code<span class="op">,</span> integrated with Azure RBAC<span class="op">,</span> supports key rotation<span class="op">.</span></span>
<span id="cb43-1339"><a href="#cb43-1339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1340"><a href="#cb43-1340" aria-hidden="true" tabindex="-1"></a>### <span class="fl">3.</span> <span class="op">**</span>Resource Token Authentication<span class="op">**</span></span>
<span id="cb43-1341"><a href="#cb43-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1342"><a href="#cb43-1342" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-1343"><a href="#cb43-1343" aria-hidden="true" tabindex="-1"></a><span class="co">// First, create a permission (typically on a server with master key)</span></span>
<span id="cb43-1344"><a href="#cb43-1344" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> permissionResponse <span class="op">=</span> await container<span class="op">.</span><span class="fu">CreatePermissionAsync</span><span class="op">(</span></span>
<span id="cb43-1345"><a href="#cb43-1345" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> PermissionProperties</span>
<span id="cb43-1346"><a href="#cb43-1346" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-1347"><a href="#cb43-1347" aria-hidden="true" tabindex="-1"></a>        Id <span class="op">=</span> <span class="st">"read-only-permission"</span><span class="op">,</span></span>
<span id="cb43-1348"><a href="#cb43-1348" aria-hidden="true" tabindex="-1"></a>        PermissionMode <span class="op">=</span> PermissionMode<span class="op">.</span><span class="fu">Read</span><span class="op">,</span></span>
<span id="cb43-1349"><a href="#cb43-1349" aria-hidden="true" tabindex="-1"></a>        ResourceLink <span class="op">=</span> container<span class="op">.</span><span class="fu">Link</span><span class="op">,</span></span>
<span id="cb43-1350"><a href="#cb43-1350" aria-hidden="true" tabindex="-1"></a>        ResourcePartitionKey <span class="op">=</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"user123"</span><span class="op">)</span></span>
<span id="cb43-1351"><a href="#cb43-1351" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb43-1352"><a href="#cb43-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1353"><a href="#cb43-1353" aria-hidden="true" tabindex="-1"></a><span class="dt">string</span> resourceToken <span class="op">=</span> permissionResponse<span class="op">.</span><span class="fu">Resource</span><span class="op">.</span><span class="fu">Token</span><span class="op">;</span></span>
<span id="cb43-1354"><a href="#cb43-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1355"><a href="#cb43-1355" aria-hidden="true" tabindex="-1"></a><span class="co">// On client side - use the limited resource token</span></span>
<span id="cb43-1356"><a href="#cb43-1356" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> resourceTokenCosmosClient <span class="op">=</span> <span class="kw">new</span> <span class="fu">CosmosClient</span><span class="op">(</span></span>
<span id="cb43-1357"><a href="#cb43-1357" aria-hidden="true" tabindex="-1"></a>    endpoint<span class="op">,</span></span>
<span id="cb43-1358"><a href="#cb43-1358" aria-hidden="true" tabindex="-1"></a>    resourceToken<span class="op">,</span></span>
<span id="cb43-1359"><a href="#cb43-1359" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> CosmosClientOptions</span>
<span id="cb43-1360"><a href="#cb43-1360" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-1361"><a href="#cb43-1361" aria-hidden="true" tabindex="-1"></a>        ApplicationRegion <span class="op">=</span> <span class="st">"West US 2"</span></span>
<span id="cb43-1362"><a href="#cb43-1362" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb43-1363"><a href="#cb43-1363" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-1364"><a href="#cb43-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1365"><a href="#cb43-1365" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Best <span class="kw">for</span><span class="op">**:</span> Client<span class="op">-</span>side applications<span class="op">,</span> multi<span class="op">-</span>tenant scenarios<span class="op">,</span> granular access control<span class="op">.</span></span>
<span id="cb43-1366"><a href="#cb43-1366" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Security considerations<span class="op">**:</span> Fine<span class="op">-</span>grained access control<span class="op">,</span> <span class="dt">short</span><span class="op">-</span>lived tokens<span class="op">,</span> limited to specific containers<span class="op">/</span>partitions<span class="op">.</span></span>
<span id="cb43-1367"><a href="#cb43-1367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1368"><a href="#cb43-1368" aria-hidden="true" tabindex="-1"></a>### Authentication Comparison</span>
<span id="cb43-1369"><a href="#cb43-1369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1370"><a href="#cb43-1370" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> Method <span class="op">|</span> Security Level <span class="op">|</span> Best For <span class="op">|</span> Considerations <span class="op">|</span></span>
<span id="cb43-1371"><a href="#cb43-1371" aria-hidden="true" tabindex="-1"></a><span class="op">|--------|--------------|----------|---------------|</span></span>
<span id="cb43-1372"><a href="#cb43-1372" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> <span class="op">**</span>Primary Key<span class="op">**</span> <span class="op">|</span> ⚠️ Basic <span class="op">|</span> Development<span class="op">,</span> Simple apps <span class="op">|</span> Full account access<span class="op">,</span> difficult to rotate <span class="op">|</span></span>
<span id="cb43-1373"><a href="#cb43-1373" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> <span class="op">**</span>AAD Authentication<span class="op">**</span> <span class="op">|</span> ✅ High <span class="op">|</span> Production<span class="op">,</span> Azure services <span class="op">|</span> No secrets <span class="kw">in</span> code<span class="op">,</span> easy to manage access <span class="op">|</span></span>
<span id="cb43-1374"><a href="#cb43-1374" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> <span class="op">**</span>Managed Identity<span class="op">**</span> <span class="op">|</span> ✅ Highest <span class="op">|</span> Azure<span class="op">-</span>hosted services <span class="op">|</span> No secrets anywhere<span class="op">,</span> automatic rotation <span class="op">|</span></span>
<span id="cb43-1375"><a href="#cb43-1375" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> <span class="op">**</span>Resource Tokens<span class="op">**</span> <span class="op">|</span> ✅ High <span class="op">|</span> Client apps<span class="op">,</span> Multi<span class="op">-</span>tenant <span class="op">|</span> Fine<span class="op">-</span>grained<span class="op">,</span> time<span class="op">-</span>limited access <span class="op">|</span></span>
<span id="cb43-1376"><a href="#cb43-1376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1377"><a href="#cb43-1377" aria-hidden="true" tabindex="-1"></a>### Best Practices</span>
<span id="cb43-1378"><a href="#cb43-1378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1379"><a href="#cb43-1379" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span> <span class="op">**</span>Always use Managed Identity<span class="op">**</span> <span class="kw">for</span> Azure<span class="op">-</span>hosted applications</span>
<span id="cb43-1380"><a href="#cb43-1380" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span> <span class="op">**</span>Never store primary keys<span class="op">**</span> <span class="kw">in</span> code or configuration files</span>
<span id="cb43-1381"><a href="#cb43-1381" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span> <span class="op">**</span>Use Azure Key Vault<span class="op">**</span> to securely store connection strings when needed</span>
<span id="cb43-1382"><a href="#cb43-1382" aria-hidden="true" tabindex="-1"></a><span class="fl">4.</span> <span class="op">**</span>Apply Principle of Least Privilege<span class="op">**</span> with resource tokens or RBAC</span>
<span id="cb43-1383"><a href="#cb43-1383" aria-hidden="true" tabindex="-1"></a><span class="fl">5.</span> <span class="op">**</span>Implement token caching<span class="op">**</span> when <span class="kw">using</span> resource tokens</span>
<span id="cb43-1384"><a href="#cb43-1384" aria-hidden="true" tabindex="-1"></a><span class="fl">6.</span> <span class="op">**</span>Set up alerts<span class="op">**</span> <span class="kw">for</span> unusual access patterns</span>
<span id="cb43-1385"><a href="#cb43-1385" aria-hidden="true" tabindex="-1"></a><span class="fl">7.</span> <span class="op">**</span>Regularly rotate keys<span class="op">**</span> to limit exposure from potential leaks</span>
<span id="cb43-1386"><a href="#cb43-1386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1387"><a href="#cb43-1387" aria-hidden="true" tabindex="-1"></a>## Migration from Legacy SDK</span>
<span id="cb43-1388"><a href="#cb43-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1389"><a href="#cb43-1389" aria-hidden="true" tabindex="-1"></a>Azure Cosmos DB has evolved significantly<span class="op">,</span> and several legacy SDKs have been <span class="op">**</span>deprecated and discontinued<span class="op">**.</span> Understanding the migration path <span class="kw">is</span> crucial <span class="kw">for</span> maintaining secure<span class="op">,</span> performant applications<span class="op">.</span></span>
<span id="cb43-1390"><a href="#cb43-1390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1391"><a href="#cb43-1391" aria-hidden="true" tabindex="-1"></a>### Legacy SDKs Overview</span>
<span id="cb43-1392"><a href="#cb43-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1393"><a href="#cb43-1393" aria-hidden="true" tabindex="-1"></a>#### <span class="op">**</span><span class="fl">1.</span> Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">DocumentDB</span> <span class="op">(</span>SQL API Legacy<span class="op">)**</span></span>
<span id="cb43-1394"><a href="#cb43-1394" aria-hidden="true" tabindex="-1"></a>The original SDK <span class="kw">for</span> Cosmos DB SQL API<span class="op">,</span> discontinued <span class="kw">in</span> March <span class="fl">2020.</span></span>
<span id="cb43-1395"><a href="#cb43-1395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1396"><a href="#cb43-1396" aria-hidden="true" tabindex="-1"></a>#### <span class="op">**</span><span class="fl">2.</span> Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span><span class="op">.</span><span class="fu">Table</span> <span class="op">(</span>Table API Legacy<span class="op">)**</span></span>
<span id="cb43-1397"><a href="#cb43-1397" aria-hidden="true" tabindex="-1"></a>A specialized SDK <span class="kw">for</span> accessing Cosmos DB Table API<span class="op">,</span> based on Azure Table Storage patterns<span class="op">.</span> <span class="op">**</span>Also deprecated<span class="op">**</span> <span class="kw">in</span> favor of the unified `Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span>` approach<span class="op">.</span></span>
<span id="cb43-1398"><a href="#cb43-1398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1399"><a href="#cb43-1399" aria-hidden="true" tabindex="-1"></a>#### <span class="op">**</span><span class="fl">3.</span> WindowsAzure<span class="op">.</span><span class="fu">Storage</span> <span class="op">(</span>Azure Table Storage<span class="op">)**</span></span>
<span id="cb43-1400"><a href="#cb43-1400" aria-hidden="true" tabindex="-1"></a>The original Azure Table Storage SDK that many developers used before Cosmos DB Table API existed<span class="op">.</span></span>
<span id="cb43-1401"><a href="#cb43-1401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1402"><a href="#cb43-1402" aria-hidden="true" tabindex="-1"></a>### Why Legacy SDKs Were Discontinued</span>
<span id="cb43-1403"><a href="#cb43-1403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1404"><a href="#cb43-1404" aria-hidden="true" tabindex="-1"></a>#### <span class="op">**</span><span class="fl">1.</span> Architecture <span class="op">&amp;</span> Design Issues<span class="op">**</span></span>
<span id="cb43-1405"><a href="#cb43-1405" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Callback<span class="op">-</span>Based Patterns<span class="op">**:</span> Legacy SDKs were designed around callback patterns predating modern async<span class="op">/</span>await</span>
<span id="cb43-1406"><a href="#cb43-1406" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Inadequate Error Handling<span class="op">**:</span> Limited status code mapping and retry policies</span>
<span id="cb43-1407"><a href="#cb43-1407" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Complex Object Model<span class="op">**:</span> Overly complex inheritance chains and abstractions</span>
<span id="cb43-1408"><a href="#cb43-1408" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Fragmented APIs<span class="op">**:</span> Different SDKs <span class="kw">for</span> different APIs led to inconsistent developer experience</span>
<span id="cb43-1409"><a href="#cb43-1409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1410"><a href="#cb43-1410" aria-hidden="true" tabindex="-1"></a>#### <span class="op">**</span><span class="fl">2.</span> Modern Development Standards<span class="op">**</span></span>
<span id="cb43-1411"><a href="#cb43-1411" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Async<span class="op">/</span>Await Patterns<span class="op">**:</span> Modern applications require efficient async operations from the ground up</span>
<span id="cb43-1412"><a href="#cb43-1412" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Performance<span class="op">**:</span> Legacy SDKs had performance bottlenecks and inefficient memory usage</span>
<span id="cb43-1413"><a href="#cb43-1413" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Target Framework Support<span class="op">**:</span> Limited support <span class="kw">for</span> newer <span class="op">.</span><span class="fu">NET</span> versions and <span class="op">.</span><span class="fu">NET</span> Core</span>
<span id="cb43-1414"><a href="#cb43-1414" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Unified Experience<span class="op">**:</span> Microsoft moved towards a single<span class="op">,</span> unified SDK approach</span>
<span id="cb43-1415"><a href="#cb43-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1416"><a href="#cb43-1416" aria-hidden="true" tabindex="-1"></a>#### <span class="op">**</span><span class="fl">3.</span> Service Evolution<span class="op">**</span></span>
<span id="cb43-1417"><a href="#cb43-1417" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>New Features<span class="op">**:</span> Legacy SDKs couldn't support newer features like change feed<span class="op">,</span> bulk operations<span class="op">,</span> and AAD auth</span>
<span id="cb43-1418"><a href="#cb43-1418" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Consistency<span class="op">**:</span> Microsoft moved to consistent Azure SDK guidelines across all services</span>
<span id="cb43-1419"><a href="#cb43-1419" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Maintenance<span class="op">**:</span> Supporting multiple SDKs was inefficient and led to inconsistencies</span>
<span id="cb43-1420"><a href="#cb43-1420" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Multi<span class="op">-</span>Model Support<span class="op">**:</span> Modern SDK supports multiple APIs from a single package</span>
<span id="cb43-1421"><a href="#cb43-1421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1422"><a href="#cb43-1422" aria-hidden="true" tabindex="-1"></a>### Comprehensive Library Comparison</span>
<span id="cb43-1423"><a href="#cb43-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1424"><a href="#cb43-1424" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> Feature <span class="op">|</span> `Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">DocumentDB</span>` <span class="op">|</span> `Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span><span class="op">.</span><span class="fu">Table</span>` <span class="op">|</span> `Azure<span class="op">.</span><span class="fu">Data</span><span class="op">.</span><span class="fu">Tables</span>` <span class="op">|</span> `Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span>` <span class="op">|</span></span>
<span id="cb43-1425"><a href="#cb43-1425" aria-hidden="true" tabindex="-1"></a><span class="op">|---------|------------------------------|--------------------------------|---------------------|---------------------------|</span></span>
<span id="cb43-1426"><a href="#cb43-1426" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> <span class="op">**</span>Status<span class="op">**</span> <span class="op">|</span> ❌ <span class="fu">Deprecated</span> <span class="op">(</span><span class="dv">2020</span><span class="op">)</span> <span class="op">|</span> ❌ <span class="fu">Deprecated</span> <span class="op">(</span><span class="dv">2021</span><span class="op">)</span> <span class="op">|</span> ✅ <span class="fu">Active</span> <span class="op">(</span>Table Storage<span class="op">)</span> <span class="op">|</span> ✅ Active <span class="op">&amp;</span> Recommended <span class="op">|</span></span>
<span id="cb43-1427"><a href="#cb43-1427" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> <span class="op">**</span>Target Service<span class="op">**</span> <span class="op">|</span> Cosmos DB SQL API <span class="op">|</span> Cosmos DB Table API <span class="op">|</span> Azure Table Storage <span class="op">|</span> All Cosmos DB APIs <span class="op">|</span></span>
<span id="cb43-1428"><a href="#cb43-1428" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> <span class="op">**</span>API Design<span class="op">**</span> <span class="op">|</span> Callback<span class="op">-</span>heavy <span class="op">|</span> Table Storage patterns <span class="op">|</span> Modern async<span class="op">/</span>await <span class="op">|</span> Modern async<span class="op">/</span>await <span class="op">|</span></span>
<span id="cb43-1429"><a href="#cb43-1429" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> <span class="op">**</span>Performance<span class="op">**</span> <span class="op">|</span> Poor <span class="op">|</span> Moderate <span class="op">|</span> Good <span class="op">|</span> Excellent <span class="op">|</span></span>
<span id="cb43-1430"><a href="#cb43-1430" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> <span class="op">**</span>Bulk Operations<span class="op">**</span> <span class="op">|</span> Limited <span class="op">|</span> Limited <span class="op">|</span> Basic <span class="op">|</span> Advanced <span class="op">|</span></span>
<span id="cb43-1431"><a href="#cb43-1431" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> <span class="op">**</span>Authentication<span class="op">**</span> <span class="op">|</span> Primary key only <span class="op">|</span> Primary key <span class="op">+</span> SAS <span class="op">|</span> AAD <span class="op">+</span> SAS <span class="op">+</span> Key <span class="op">|</span> AAD <span class="op">+</span> Managed Identity <span class="op">+</span> Key <span class="op">|</span></span>
<span id="cb43-1432"><a href="#cb43-1432" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> <span class="op">**.</span><span class="fu">NET</span> Core Support<span class="op">**</span> <span class="op">|</span> Limited <span class="op">|</span> Full <span class="op">|</span> Full <span class="op">|</span> Full <span class="op">|</span></span>
<span id="cb43-1433"><a href="#cb43-1433" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> <span class="op">**</span>Multi<span class="op">-</span>Model<span class="op">**</span> <span class="op">|</span> SQL only <span class="op">|</span> Table only <span class="op">|</span> Table only <span class="op">|</span> SQL<span class="op">,</span> Table<span class="op">,</span> MongoDB<span class="op">,</span> etc<span class="op">.</span> <span class="op">|</span></span>
<span id="cb43-1434"><a href="#cb43-1434" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> <span class="op">**</span>Change Feed<span class="op">**</span> <span class="op">|</span> Basic <span class="op">|</span> ❌ Not supported <span class="op">|</span> ❌ Not supported <span class="op">|</span> Comprehensive <span class="op">|</span></span>
<span id="cb43-1435"><a href="#cb43-1435" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> <span class="op">**</span>Global Distribution<span class="op">**</span> <span class="op">|</span> Basic <span class="op">|</span> Basic <span class="op">|</span> ❌ Limited <span class="op">|</span> Advanced <span class="op">|</span></span>
<span id="cb43-1436"><a href="#cb43-1436" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> <span class="op">**</span>Diagnostics<span class="op">**</span> <span class="op">|</span> Limited <span class="op">|</span> Limited <span class="op">|</span> Good <span class="op">|</span> Excellent <span class="op">|</span></span>
<span id="cb43-1437"><a href="#cb43-1437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1438"><a href="#cb43-1438" aria-hidden="true" tabindex="-1"></a>### Migration Paths <span class="op">&amp;</span> Code Examples</span>
<span id="cb43-1439"><a href="#cb43-1439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1440"><a href="#cb43-1440" aria-hidden="true" tabindex="-1"></a>#### <span class="op">**</span>Path <span class="dv">1</span><span class="op">:</span> From Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">DocumentDB</span> <span class="op">(</span>SQL API<span class="op">)**</span></span>
<span id="cb43-1441"><a href="#cb43-1441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1442"><a href="#cb43-1442" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Step <span class="dv">1</span><span class="op">:</span> Update Package References<span class="op">**</span></span>
<span id="cb43-1443"><a href="#cb43-1443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1444"><a href="#cb43-1444" aria-hidden="true" tabindex="-1"></a>```xml</span>
<span id="cb43-1445"><a href="#cb43-1445" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;!--</span> REMOVE legacy package <span class="op">--&gt;</span></span>
<span id="cb43-1446"><a href="#cb43-1446" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;!--</span> <span class="op">&lt;</span>PackageReference Include<span class="op">=</span><span class="st">"Microsoft.Azure.DocumentDB"</span> Version<span class="op">=</span><span class="st">"2.x.x"</span> <span class="op">/&gt;</span> <span class="op">--&gt;</span></span>
<span id="cb43-1447"><a href="#cb43-1447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1448"><a href="#cb43-1448" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;!--</span> ADD modern package <span class="op">--&gt;</span></span>
<span id="cb43-1449"><a href="#cb43-1449" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>PackageReference Include<span class="op">=</span><span class="st">"Microsoft.Azure.Cosmos"</span> Version<span class="op">=</span><span class="st">"3.37.0"</span> <span class="op">/&gt;</span></span>
<span id="cb43-1450"><a href="#cb43-1450" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-1451"><a href="#cb43-1451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1452"><a href="#cb43-1452" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Step <span class="dv">2</span><span class="op">:</span> Update Namespace Imports<span class="op">**</span></span>
<span id="cb43-1453"><a href="#cb43-1453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1454"><a href="#cb43-1454" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-1455"><a href="#cb43-1455" aria-hidden="true" tabindex="-1"></a><span class="co">// OLD namespaces</span></span>
<span id="cb43-1456"><a href="#cb43-1456" aria-hidden="true" tabindex="-1"></a><span class="co">// using Microsoft.Azure.Documents;</span></span>
<span id="cb43-1457"><a href="#cb43-1457" aria-hidden="true" tabindex="-1"></a><span class="co">// using Microsoft.Azure.Documents.Client;</span></span>
<span id="cb43-1458"><a href="#cb43-1458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1459"><a href="#cb43-1459" aria-hidden="true" tabindex="-1"></a><span class="co">// NEW namespace</span></span>
<span id="cb43-1460"><a href="#cb43-1460" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span><span class="op">;</span></span>
<span id="cb43-1461"><a href="#cb43-1461" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-1462"><a href="#cb43-1462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1463"><a href="#cb43-1463" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Step <span class="dv">3</span><span class="op">:</span> Update Client Initialization<span class="op">**</span></span>
<span id="cb43-1464"><a href="#cb43-1464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1465"><a href="#cb43-1465" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-1466"><a href="#cb43-1466" aria-hidden="true" tabindex="-1"></a><span class="co">// OLD - DocumentDB</span></span>
<span id="cb43-1467"><a href="#cb43-1467" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb43-1468"><a href="#cb43-1468" aria-hidden="true" tabindex="-1"></a><span class="co">DocumentClient client = new DocumentClient(</span></span>
<span id="cb43-1469"><a href="#cb43-1469" aria-hidden="true" tabindex="-1"></a><span class="co">    new Uri("https://your-account.documents.azure.com:443/"),</span></span>
<span id="cb43-1470"><a href="#cb43-1470" aria-hidden="true" tabindex="-1"></a><span class="co">    "your-primary-key");</span></span>
<span id="cb43-1471"><a href="#cb43-1471" aria-hidden="true" tabindex="-1"></a><span class="co">await client.OpenAsync();</span></span>
<span id="cb43-1472"><a href="#cb43-1472" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb43-1473"><a href="#cb43-1473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1474"><a href="#cb43-1474" aria-hidden="true" tabindex="-1"></a><span class="co">// NEW - Cosmos SDK</span></span>
<span id="cb43-1475"><a href="#cb43-1475" aria-hidden="true" tabindex="-1"></a>CosmosClient cosmosClient <span class="op">=</span> <span class="kw">new</span> <span class="fu">CosmosClient</span><span class="op">(</span></span>
<span id="cb43-1476"><a href="#cb43-1476" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://your-account.documents.azure.com:443/"</span><span class="op">,</span></span>
<span id="cb43-1477"><a href="#cb43-1477" aria-hidden="true" tabindex="-1"></a>    <span class="st">"your-primary-key"</span><span class="op">);</span></span>
<span id="cb43-1478"><a href="#cb43-1478" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-1479"><a href="#cb43-1479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1480"><a href="#cb43-1480" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Step <span class="dv">4</span><span class="op">:</span> Update CRUD Operations<span class="op">**</span></span>
<span id="cb43-1481"><a href="#cb43-1481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1482"><a href="#cb43-1482" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-1483"><a href="#cb43-1483" aria-hidden="true" tabindex="-1"></a><span class="co">// OLD - Create Document</span></span>
<span id="cb43-1484"><a href="#cb43-1484" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb43-1485"><a href="#cb43-1485" aria-hidden="true" tabindex="-1"></a><span class="co">Document document = await client.CreateDocumentAsync(</span></span>
<span id="cb43-1486"><a href="#cb43-1486" aria-hidden="true" tabindex="-1"></a><span class="co">    UriFactory.CreateDocumentCollectionUri("MyDatabase", "MyCollection"),</span></span>
<span id="cb43-1487"><a href="#cb43-1487" aria-hidden="true" tabindex="-1"></a><span class="co">    new { id = "item1", name = "Item 1", partitionKey = "pk1" });</span></span>
<span id="cb43-1488"><a href="#cb43-1488" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb43-1489"><a href="#cb43-1489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1490"><a href="#cb43-1490" aria-hidden="true" tabindex="-1"></a><span class="co">// NEW - Create Item</span></span>
<span id="cb43-1491"><a href="#cb43-1491" aria-hidden="true" tabindex="-1"></a>ItemResponse<span class="op">&lt;</span>dynamic<span class="op">&gt;</span> response <span class="op">=</span> await container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb43-1492"><a href="#cb43-1492" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="op">{</span> id <span class="op">=</span> <span class="st">"item1"</span><span class="op">,</span> name <span class="op">=</span> <span class="st">"Item 1"</span><span class="op">,</span> partitionKey <span class="op">=</span> <span class="st">"pk1"</span> <span class="op">},</span></span>
<span id="cb43-1493"><a href="#cb43-1493" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"pk1"</span><span class="op">));</span></span>
<span id="cb43-1494"><a href="#cb43-1494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1495"><a href="#cb43-1495" aria-hidden="true" tabindex="-1"></a><span class="co">// OLD - Query Documents</span></span>
<span id="cb43-1496"><a href="#cb43-1496" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb43-1497"><a href="#cb43-1497" aria-hidden="true" tabindex="-1"></a><span class="co">FeedOptions options = new FeedOptions { EnableCrossPartitionQuery = true };</span></span>
<span id="cb43-1498"><a href="#cb43-1498" aria-hidden="true" tabindex="-1"></a><span class="co">IDocumentQuery&lt;dynamic&gt; query = client.CreateDocumentQuery&lt;dynamic&gt;(</span></span>
<span id="cb43-1499"><a href="#cb43-1499" aria-hidden="true" tabindex="-1"></a><span class="co">    UriFactory.CreateDocumentCollectionUri("MyDatabase", "MyCollection"),</span></span>
<span id="cb43-1500"><a href="#cb43-1500" aria-hidden="true" tabindex="-1"></a><span class="co">    "SELECT * FROM c WHERE c.name = 'Item 1'", </span></span>
<span id="cb43-1501"><a href="#cb43-1501" aria-hidden="true" tabindex="-1"></a><span class="co">    options).AsDocumentQuery();</span></span>
<span id="cb43-1502"><a href="#cb43-1502" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb43-1503"><a href="#cb43-1503" aria-hidden="true" tabindex="-1"></a><span class="co">while (query.HasMoreResults)</span></span>
<span id="cb43-1504"><a href="#cb43-1504" aria-hidden="true" tabindex="-1"></a><span class="co">{</span></span>
<span id="cb43-1505"><a href="#cb43-1505" aria-hidden="true" tabindex="-1"></a><span class="co">    FeedResponse&lt;dynamic&gt; results = await query.ExecuteNextAsync&lt;dynamic&gt;();</span></span>
<span id="cb43-1506"><a href="#cb43-1506" aria-hidden="true" tabindex="-1"></a><span class="co">    foreach (var item in results)</span></span>
<span id="cb43-1507"><a href="#cb43-1507" aria-hidden="true" tabindex="-1"></a><span class="co">    {</span></span>
<span id="cb43-1508"><a href="#cb43-1508" aria-hidden="true" tabindex="-1"></a><span class="co">        Console.WriteLine(item.name);</span></span>
<span id="cb43-1509"><a href="#cb43-1509" aria-hidden="true" tabindex="-1"></a><span class="co">    }</span></span>
<span id="cb43-1510"><a href="#cb43-1510" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb43-1511"><a href="#cb43-1511" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb43-1512"><a href="#cb43-1512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1513"><a href="#cb43-1513" aria-hidden="true" tabindex="-1"></a><span class="co">// NEW - Query Items</span></span>
<span id="cb43-1514"><a href="#cb43-1514" aria-hidden="true" tabindex="-1"></a>QueryDefinition queryDefinition <span class="op">=</span> <span class="kw">new</span> <span class="fu">QueryDefinition</span><span class="op">(</span></span>
<span id="cb43-1515"><a href="#cb43-1515" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SELECT * FROM c WHERE c.name = 'Item 1'"</span><span class="op">);</span></span>
<span id="cb43-1516"><a href="#cb43-1516" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-1517"><a href="#cb43-1517" aria-hidden="true" tabindex="-1"></a>FeedIterator<span class="op">&lt;</span>dynamic<span class="op">&gt;</span> resultSet <span class="op">=</span> container<span class="op">.</span><span class="fu">GetItemQueryIterator</span><span class="op">&lt;</span>dynamic<span class="op">&gt;(</span></span>
<span id="cb43-1518"><a href="#cb43-1518" aria-hidden="true" tabindex="-1"></a>    queryDefinition<span class="op">,</span></span>
<span id="cb43-1519"><a href="#cb43-1519" aria-hidden="true" tabindex="-1"></a>    requestOptions<span class="op">:</span> <span class="kw">new</span> QueryRequestOptions <span class="op">{</span> MaxItemCount <span class="op">=</span> <span class="dv">10</span> <span class="op">});</span></span>
<span id="cb43-1520"><a href="#cb43-1520" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-1521"><a href="#cb43-1521" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="op">(</span>resultSet<span class="op">.</span><span class="fu">HasMoreResults</span><span class="op">)</span></span>
<span id="cb43-1522"><a href="#cb43-1522" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-1523"><a href="#cb43-1523" aria-hidden="true" tabindex="-1"></a>    FeedResponse<span class="op">&lt;</span>dynamic<span class="op">&gt;</span> response <span class="op">=</span> await resultSet<span class="op">.</span><span class="fu">ReadNextAsync</span><span class="op">();</span></span>
<span id="cb43-1524"><a href="#cb43-1524" aria-hidden="true" tabindex="-1"></a>    <span class="kw">foreach</span> <span class="op">(</span><span class="dt">var</span> item <span class="kw">in</span> response<span class="op">)</span></span>
<span id="cb43-1525"><a href="#cb43-1525" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-1526"><a href="#cb43-1526" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>item<span class="op">.</span><span class="fu">name</span><span class="op">);</span></span>
<span id="cb43-1527"><a href="#cb43-1527" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb43-1528"><a href="#cb43-1528" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-1529"><a href="#cb43-1529" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-1530"><a href="#cb43-1530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1531"><a href="#cb43-1531" aria-hidden="true" tabindex="-1"></a>#### <span class="op">**</span>Path <span class="dv">2</span><span class="op">:</span> From Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span><span class="op">.</span><span class="fu">Table</span> <span class="op">(</span>Table API<span class="op">)**</span></span>
<span id="cb43-1532"><a href="#cb43-1532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1533"><a href="#cb43-1533" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Step <span class="dv">1</span><span class="op">:</span> Update Package References<span class="op">**</span></span>
<span id="cb43-1534"><a href="#cb43-1534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1535"><a href="#cb43-1535" aria-hidden="true" tabindex="-1"></a>```xml</span>
<span id="cb43-1536"><a href="#cb43-1536" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;!--</span> REMOVE legacy Table API package <span class="op">--&gt;</span></span>
<span id="cb43-1537"><a href="#cb43-1537" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;!--</span> <span class="op">&lt;</span>PackageReference Include<span class="op">=</span><span class="st">"Microsoft.Azure.Cosmos.Table"</span> Version<span class="op">=</span><span class="st">"1.x.x"</span> <span class="op">/&gt;</span> <span class="op">--&gt;</span></span>
<span id="cb43-1538"><a href="#cb43-1538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1539"><a href="#cb43-1539" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;!--</span> ADD modern unified package <span class="op">--&gt;</span></span>
<span id="cb43-1540"><a href="#cb43-1540" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>PackageReference Include<span class="op">=</span><span class="st">"Microsoft.Azure.Cosmos"</span> Version<span class="op">=</span><span class="st">"3.37.0"</span> <span class="op">/&gt;</span></span>
<span id="cb43-1541"><a href="#cb43-1541" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-1542"><a href="#cb43-1542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1543"><a href="#cb43-1543" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Step <span class="dv">2</span><span class="op">:</span> Update Namespace Imports<span class="op">**</span></span>
<span id="cb43-1544"><a href="#cb43-1544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1545"><a href="#cb43-1545" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-1546"><a href="#cb43-1546" aria-hidden="true" tabindex="-1"></a><span class="co">// OLD namespaces</span></span>
<span id="cb43-1547"><a href="#cb43-1547" aria-hidden="true" tabindex="-1"></a><span class="co">// using Microsoft.Azure.Cosmos.Table;</span></span>
<span id="cb43-1548"><a href="#cb43-1548" aria-hidden="true" tabindex="-1"></a><span class="co">// using Microsoft.Azure.Cosmos.Table.Protocol;</span></span>
<span id="cb43-1549"><a href="#cb43-1549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1550"><a href="#cb43-1550" aria-hidden="true" tabindex="-1"></a><span class="co">// NEW namespace</span></span>
<span id="cb43-1551"><a href="#cb43-1551" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span><span class="op">;</span></span>
<span id="cb43-1552"><a href="#cb43-1552" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-1553"><a href="#cb43-1553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1554"><a href="#cb43-1554" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Step <span class="dv">3</span><span class="op">:</span> Client <span class="op">&amp;</span> Container Setup<span class="op">**</span></span>
<span id="cb43-1555"><a href="#cb43-1555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1556"><a href="#cb43-1556" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-1557"><a href="#cb43-1557" aria-hidden="true" tabindex="-1"></a><span class="co">// OLD - Table Client</span></span>
<span id="cb43-1558"><a href="#cb43-1558" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb43-1559"><a href="#cb43-1559" aria-hidden="true" tabindex="-1"></a><span class="co">CloudStorageAccount storageAccount = CloudStorageAccount.Parse(connectionString);</span></span>
<span id="cb43-1560"><a href="#cb43-1560" aria-hidden="true" tabindex="-1"></a><span class="co">CloudTableClient tableClient = storageAccount.CreateCloudTableClient();</span></span>
<span id="cb43-1561"><a href="#cb43-1561" aria-hidden="true" tabindex="-1"></a><span class="co">CloudTable table = tableClient.GetTableReference("MyTable");</span></span>
<span id="cb43-1562"><a href="#cb43-1562" aria-hidden="true" tabindex="-1"></a><span class="co">await table.CreateIfNotExistsAsync();</span></span>
<span id="cb43-1563"><a href="#cb43-1563" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb43-1564"><a href="#cb43-1564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1565"><a href="#cb43-1565" aria-hidden="true" tabindex="-1"></a><span class="co">// NEW - Cosmos Container (Table API via SQL API)</span></span>
<span id="cb43-1566"><a href="#cb43-1566" aria-hidden="true" tabindex="-1"></a>CosmosClient cosmosClient <span class="op">=</span> <span class="kw">new</span> <span class="fu">CosmosClient</span><span class="op">(</span>endpoint<span class="op">,</span> key<span class="op">);</span></span>
<span id="cb43-1567"><a href="#cb43-1567" aria-hidden="true" tabindex="-1"></a>Database database <span class="op">=</span> await cosmosClient<span class="op">.</span><span class="fu">CreateDatabaseIfNotExistsAsync</span><span class="op">(</span><span class="st">"MyDatabase"</span><span class="op">);</span></span>
<span id="cb43-1568"><a href="#cb43-1568" aria-hidden="true" tabindex="-1"></a>Container container <span class="op">=</span> await database<span class="op">.</span><span class="fu">CreateContainerIfNotExistsAsync</span><span class="op">(</span></span>
<span id="cb43-1569"><a href="#cb43-1569" aria-hidden="true" tabindex="-1"></a>    id<span class="op">:</span> <span class="st">"MyTable"</span><span class="op">,</span></span>
<span id="cb43-1570"><a href="#cb43-1570" aria-hidden="true" tabindex="-1"></a>    partitionKeyPath<span class="op">:</span> <span class="st">"/PartitionKey"</span><span class="op">,</span> <span class="co">// Note: PartitionKey is the property name</span></span>
<span id="cb43-1571"><a href="#cb43-1571" aria-hidden="true" tabindex="-1"></a>    throughput<span class="op">:</span> <span class="dv">400</span><span class="op">);</span></span>
<span id="cb43-1572"><a href="#cb43-1572" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-1573"><a href="#cb43-1573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1574"><a href="#cb43-1574" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Step <span class="dv">4</span><span class="op">:</span> Entity Model Changes<span class="op">**</span></span>
<span id="cb43-1575"><a href="#cb43-1575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1576"><a href="#cb43-1576" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-1577"><a href="#cb43-1577" aria-hidden="true" tabindex="-1"></a><span class="co">// OLD - Table Entity</span></span>
<span id="cb43-1578"><a href="#cb43-1578" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb43-1579"><a href="#cb43-1579" aria-hidden="true" tabindex="-1"></a><span class="co">public class CustomerEntity : TableEntity</span></span>
<span id="cb43-1580"><a href="#cb43-1580" aria-hidden="true" tabindex="-1"></a><span class="co">{</span></span>
<span id="cb43-1581"><a href="#cb43-1581" aria-hidden="true" tabindex="-1"></a><span class="co">    public CustomerEntity(string lastName, string firstName)</span></span>
<span id="cb43-1582"><a href="#cb43-1582" aria-hidden="true" tabindex="-1"></a><span class="co">    {</span></span>
<span id="cb43-1583"><a href="#cb43-1583" aria-hidden="true" tabindex="-1"></a><span class="co">        this.PartitionKey = lastName;</span></span>
<span id="cb43-1584"><a href="#cb43-1584" aria-hidden="true" tabindex="-1"></a><span class="co">        this.RowKey = firstName;</span></span>
<span id="cb43-1585"><a href="#cb43-1585" aria-hidden="true" tabindex="-1"></a><span class="co">    }</span></span>
<span id="cb43-1586"><a href="#cb43-1586" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb43-1587"><a href="#cb43-1587" aria-hidden="true" tabindex="-1"></a><span class="co">    public CustomerEntity() { }</span></span>
<span id="cb43-1588"><a href="#cb43-1588" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb43-1589"><a href="#cb43-1589" aria-hidden="true" tabindex="-1"></a><span class="co">    public string Email { get; set; }</span></span>
<span id="cb43-1590"><a href="#cb43-1590" aria-hidden="true" tabindex="-1"></a><span class="co">    public string PhoneNumber { get; set; }</span></span>
<span id="cb43-1591"><a href="#cb43-1591" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb43-1592"><a href="#cb43-1592" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb43-1593"><a href="#cb43-1593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1594"><a href="#cb43-1594" aria-hidden="true" tabindex="-1"></a><span class="co">// NEW - Cosmos Document Model</span></span>
<span id="cb43-1595"><a href="#cb43-1595" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> Customer</span>
<span id="cb43-1596"><a href="#cb43-1596" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-1597"><a href="#cb43-1597" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">JsonProperty</span><span class="op">(</span><span class="st">"id"</span><span class="op">)]</span></span>
<span id="cb43-1598"><a href="#cb43-1598" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> Id <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="co">// Combination of PartitionKey + RowKey</span></span>
<span id="cb43-1599"><a href="#cb43-1599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1600"><a href="#cb43-1600" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">JsonProperty</span><span class="op">(</span><span class="st">"PartitionKey"</span><span class="op">)]</span> </span>
<span id="cb43-1601"><a href="#cb43-1601" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> PartitionKey <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="co">// Same as Table PartitionKey</span></span>
<span id="cb43-1602"><a href="#cb43-1602" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-1603"><a href="#cb43-1603" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> LastName <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb43-1604"><a href="#cb43-1604" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> FirstName <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb43-1605"><a href="#cb43-1605" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> Email <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb43-1606"><a href="#cb43-1606" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> PhoneNumber <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb43-1607"><a href="#cb43-1607" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> DateTime Timestamp <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> DateTime<span class="op">.</span><span class="fu">UtcNow</span><span class="op">;</span></span>
<span id="cb43-1608"><a href="#cb43-1608" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-1609"><a href="#cb43-1609" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Constructor to maintain Table API compatibility</span></span>
<span id="cb43-1610"><a href="#cb43-1610" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">Customer</span><span class="op">(</span><span class="dt">string</span> lastName<span class="op">,</span> <span class="dt">string</span> firstName<span class="op">)</span></span>
<span id="cb43-1611"><a href="#cb43-1611" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-1612"><a href="#cb43-1612" aria-hidden="true" tabindex="-1"></a>        PartitionKey <span class="op">=</span> lastName<span class="op">;</span></span>
<span id="cb43-1613"><a href="#cb43-1613" aria-hidden="true" tabindex="-1"></a>        LastName <span class="op">=</span> lastName<span class="op">;</span></span>
<span id="cb43-1614"><a href="#cb43-1614" aria-hidden="true" tabindex="-1"></a>        FirstName <span class="op">=</span> firstName<span class="op">;</span></span>
<span id="cb43-1615"><a href="#cb43-1615" aria-hidden="true" tabindex="-1"></a>        Id <span class="op">=</span> $<span class="st">"{lastName}#{firstName}"</span><span class="op">;</span> <span class="co">// Composite key</span></span>
<span id="cb43-1616"><a href="#cb43-1616" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb43-1617"><a href="#cb43-1617" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-1618"><a href="#cb43-1618" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">Customer</span><span class="op">()</span> <span class="op">{</span> <span class="op">}</span></span>
<span id="cb43-1619"><a href="#cb43-1619" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-1620"><a href="#cb43-1620" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-1621"><a href="#cb43-1621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1622"><a href="#cb43-1622" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Step <span class="dv">5</span><span class="op">:</span> CRUD Operations Migration<span class="op">**</span></span>
<span id="cb43-1623"><a href="#cb43-1623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1624"><a href="#cb43-1624" aria-hidden="true" tabindex="-1"></a>```csharp</span>
<span id="cb43-1625"><a href="#cb43-1625" aria-hidden="true" tabindex="-1"></a><span class="co">// OLD - Insert Entity</span></span>
<span id="cb43-1626"><a href="#cb43-1626" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb43-1627"><a href="#cb43-1627" aria-hidden="true" tabindex="-1"></a><span class="co">CustomerEntity customer = new CustomerEntity("Doe", "John")</span></span>
<span id="cb43-1628"><a href="#cb43-1628" aria-hidden="true" tabindex="-1"></a><span class="co">{</span></span>
<span id="cb43-1629"><a href="#cb43-1629" aria-hidden="true" tabindex="-1"></a><span class="co">    Email = "john.doe@example.com",</span></span>
<span id="cb43-1630"><a href="#cb43-1630" aria-hidden="true" tabindex="-1"></a><span class="co">    PhoneNumber = "555-1234"</span></span>
<span id="cb43-1631"><a href="#cb43-1631" aria-hidden="true" tabindex="-1"></a><span class="co">};</span></span>
<span id="cb43-1632"><a href="#cb43-1632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1633"><a href="#cb43-1633" aria-hidden="true" tabindex="-1"></a><span class="co">TableOperation insertOperation = TableOperation.Insert(customer);</span></span>
<span id="cb43-1634"><a href="#cb43-1634" aria-hidden="true" tabindex="-1"></a><span class="co">TableResult result = await table.ExecuteAsync(insertOperation);</span></span>
<span id="cb43-1635"><a href="#cb43-1635" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb43-1636"><a href="#cb43-1636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1637"><a href="#cb43-1637" aria-hidden="true" tabindex="-1"></a><span class="co">// NEW - Create Item</span></span>
<span id="cb43-1638"><a href="#cb43-1638" aria-hidden="true" tabindex="-1"></a>Customer customer <span class="op">=</span> <span class="kw">new</span> <span class="fu">Customer</span><span class="op">(</span><span class="st">"Doe"</span><span class="op">,</span> <span class="st">"John"</span><span class="op">)</span></span>
<span id="cb43-1639"><a href="#cb43-1639" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-1640"><a href="#cb43-1640" aria-hidden="true" tabindex="-1"></a>    Email <span class="op">=</span> <span class="st">"john.doe@example.com"</span><span class="op">,</span></span>
<span id="cb43-1641"><a href="#cb43-1641" aria-hidden="true" tabindex="-1"></a>    PhoneNumber <span class="op">=</span> <span class="st">"555-1234"</span></span>
<span id="cb43-1642"><a href="#cb43-1642" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb43-1643"><a href="#cb43-1643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1644"><a href="#cb43-1644" aria-hidden="true" tabindex="-1"></a>ItemResponse<span class="op">&lt;</span>Customer<span class="op">&gt;</span> response <span class="op">=</span> await container<span class="op">.</span><span class="fu">CreateItemAsync</span><span class="op">(</span></span>
<span id="cb43-1645"><a href="#cb43-1645" aria-hidden="true" tabindex="-1"></a>    customer<span class="op">,</span></span>
<span id="cb43-1646"><a href="#cb43-1646" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span>customer<span class="op">.</span><span class="fu">PartitionKey</span><span class="op">));</span></span>
<span id="cb43-1647"><a href="#cb43-1647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1648"><a href="#cb43-1648" aria-hidden="true" tabindex="-1"></a><span class="co">// OLD - Retrieve Entity</span></span>
<span id="cb43-1649"><a href="#cb43-1649" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb43-1650"><a href="#cb43-1650" aria-hidden="true" tabindex="-1"></a><span class="co">TableOperation retrieveOperation = TableOperation.Retrieve&lt;CustomerEntity&gt;("Doe", "John");</span></span>
<span id="cb43-1651"><a href="#cb43-1651" aria-hidden="true" tabindex="-1"></a><span class="co">TableResult retrievedResult = await table.ExecuteAsync(retrieveOperation);</span></span>
<span id="cb43-1652"><a href="#cb43-1652" aria-hidden="true" tabindex="-1"></a><span class="co">CustomerEntity customer = retrievedResult.Result as CustomerEntity;</span></span>
<span id="cb43-1653"><a href="#cb43-1653" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb43-1654"><a href="#cb43-1654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1655"><a href="#cb43-1655" aria-hidden="true" tabindex="-1"></a><span class="co">// NEW - Read Item</span></span>
<span id="cb43-1656"><a href="#cb43-1656" aria-hidden="true" tabindex="-1"></a>ItemResponse<span class="op">&lt;</span>Customer<span class="op">&gt;</span> response <span class="op">=</span> await container<span class="op">.</span><span class="fu">ReadItemAsync</span><span class="op">&lt;</span>Customer<span class="op">&gt;(</span></span>
<span id="cb43-1657"><a href="#cb43-1657" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Doe#John"</span><span class="op">,</span> <span class="co">// Composite ID</span></span>
<span id="cb43-1658"><a href="#cb43-1658" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"Doe"</span><span class="op">));</span></span>
<span id="cb43-1659"><a href="#cb43-1659" aria-hidden="true" tabindex="-1"></a>Customer customer <span class="op">=</span> response<span class="op">.</span><span class="fu">Resource</span><span class="op">;</span></span>
<span id="cb43-1660"><a href="#cb43-1660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1661"><a href="#cb43-1661" aria-hidden="true" tabindex="-1"></a><span class="co">// OLD - Query Entities</span></span>
<span id="cb43-1662"><a href="#cb43-1662" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb43-1663"><a href="#cb43-1663" aria-hidden="true" tabindex="-1"></a><span class="co">TableQuery&lt;CustomerEntity&gt; query = new TableQuery&lt;CustomerEntity&gt;()</span></span>
<span id="cb43-1664"><a href="#cb43-1664" aria-hidden="true" tabindex="-1"></a><span class="co">    .Where(TableQuery.GenerateFilterCondition("PartitionKey", QueryComparisons.Equal, "Doe"));</span></span>
<span id="cb43-1665"><a href="#cb43-1665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1666"><a href="#cb43-1666" aria-hidden="true" tabindex="-1"></a><span class="co">TableContinuationToken token = null;</span></span>
<span id="cb43-1667"><a href="#cb43-1667" aria-hidden="true" tabindex="-1"></a><span class="co">var customers = new List&lt;CustomerEntity&gt;();</span></span>
<span id="cb43-1668"><a href="#cb43-1668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1669"><a href="#cb43-1669" aria-hidden="true" tabindex="-1"></a><span class="co">do</span></span>
<span id="cb43-1670"><a href="#cb43-1670" aria-hidden="true" tabindex="-1"></a><span class="co">{</span></span>
<span id="cb43-1671"><a href="#cb43-1671" aria-hidden="true" tabindex="-1"></a><span class="co">    TableQuerySegment&lt;CustomerEntity&gt; segment = await table.ExecuteQuerySegmentedAsync(query, token);</span></span>
<span id="cb43-1672"><a href="#cb43-1672" aria-hidden="true" tabindex="-1"></a><span class="co">    customers.AddRange(segment.Results);</span></span>
<span id="cb43-1673"><a href="#cb43-1673" aria-hidden="true" tabindex="-1"></a><span class="co">    token = segment.ContinuationToken;</span></span>
<span id="cb43-1674"><a href="#cb43-1674" aria-hidden="true" tabindex="-1"></a><span class="co">} while (token != null);</span></span>
<span id="cb43-1675"><a href="#cb43-1675" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb43-1676"><a href="#cb43-1676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1677"><a href="#cb43-1677" aria-hidden="true" tabindex="-1"></a><span class="co">// NEW - Query Items</span></span>
<span id="cb43-1678"><a href="#cb43-1678" aria-hidden="true" tabindex="-1"></a>QueryDefinition query <span class="op">=</span> <span class="kw">new</span> <span class="fu">QueryDefinition</span><span class="op">(</span></span>
<span id="cb43-1679"><a href="#cb43-1679" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SELECT * FROM c WHERE c.PartitionKey = @partitionKey"</span><span class="op">)</span></span>
<span id="cb43-1680"><a href="#cb43-1680" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">WithParameter</span><span class="op">(</span><span class="st">"@partitionKey"</span><span class="op">,</span> <span class="st">"Doe"</span><span class="op">);</span></span>
<span id="cb43-1681"><a href="#cb43-1681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1682"><a href="#cb43-1682" aria-hidden="true" tabindex="-1"></a>FeedIterator<span class="op">&lt;</span>Customer<span class="op">&gt;</span> resultSet <span class="op">=</span> container<span class="op">.</span><span class="fu">GetItemQueryIterator</span><span class="op">&lt;</span>Customer<span class="op">&gt;(</span></span>
<span id="cb43-1683"><a href="#cb43-1683" aria-hidden="true" tabindex="-1"></a>    query<span class="op">,</span></span>
<span id="cb43-1684"><a href="#cb43-1684" aria-hidden="true" tabindex="-1"></a>    requestOptions<span class="op">:</span> <span class="kw">new</span> QueryRequestOptions</span>
<span id="cb43-1685"><a href="#cb43-1685" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb43-1686"><a href="#cb43-1686" aria-hidden="true" tabindex="-1"></a>        PartitionKey <span class="op">=</span> <span class="kw">new</span> <span class="fu">PartitionKey</span><span class="op">(</span><span class="st">"Doe"</span><span class="op">)</span></span>
<span id="cb43-1687"><a href="#cb43-1687" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb43-1688"><a href="#cb43-1688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1689"><a href="#cb43-1689" aria-hidden="true" tabindex="-1"></a>List<span class="op">&lt;</span>Customer<span class="op">&gt;</span> customers <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>Customer<span class="op">&gt;();</span></span>
<span id="cb43-1690"><a href="#cb43-1690" aria-hidden="true" tabindex="-1"></a><span class="kw">while</span> <span class="op">(</span>resultSet<span class="op">.</span><span class="fu">HasMoreResults</span><span class="op">)</span></span>
<span id="cb43-1691"><a href="#cb43-1691" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb43-1692"><a href="#cb43-1692" aria-hidden="true" tabindex="-1"></a>    FeedResponse<span class="op">&lt;</span>Customer<span class="op">&gt;</span> response <span class="op">=</span> await resultSet<span class="op">.</span><span class="fu">ReadNextAsync</span><span class="op">();</span></span>
<span id="cb43-1693"><a href="#cb43-1693" aria-hidden="true" tabindex="-1"></a>    customers<span class="op">.</span><span class="fu">AddRange</span><span class="op">(</span>response<span class="op">);</span></span>
<span id="cb43-1694"><a href="#cb43-1694" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-1695"><a href="#cb43-1695" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-1696"><a href="#cb43-1696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1697"><a href="#cb43-1697" aria-hidden="true" tabindex="-1"></a>#### <span class="op">**</span>Path <span class="dv">3</span><span class="op">:</span> From WindowsAzure<span class="op">.</span><span class="fu">Storage</span> to Modern Options<span class="op">**</span></span>
<span id="cb43-1698"><a href="#cb43-1698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1699"><a href="#cb43-1699" aria-hidden="true" tabindex="-1"></a>If you're coming from Azure Table Storage and want to access Cosmos DB<span class="op">:</span></span>
<span id="cb43-1700"><a href="#cb43-1700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1701"><a href="#cb43-1701" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Option A<span class="op">:</span> Stay with Table Storage <span class="kw">using</span> Azure<span class="op">.</span><span class="fu">Data</span><span class="op">.</span><span class="fu">Tables</span><span class="op">**</span></span>
<span id="cb43-1702"><a href="#cb43-1702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1703"><a href="#cb43-1703" aria-hidden="true" tabindex="-1"></a>```xml</span>
<span id="cb43-1704"><a href="#cb43-1704" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>PackageReference Include<span class="op">=</span><span class="st">"Azure.Data.Tables"</span> Version<span class="op">=</span><span class="st">"12.8.0"</span> <span class="op">/&gt;</span></span>
<span id="cb43-1705"><a href="#cb43-1705" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-1706"><a href="#cb43-1706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1707"><a href="#cb43-1707" aria-hidden="true" tabindex="-1"></a><span class="op">**</span>Option B<span class="op">:</span> Migrate to Cosmos DB with Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span><span class="op">**</span></span>
<span id="cb43-1708"><a href="#cb43-1708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1709"><a href="#cb43-1709" aria-hidden="true" tabindex="-1"></a>```xml</span>
<span id="cb43-1710"><a href="#cb43-1710" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>PackageReference Include<span class="op">=</span><span class="st">"Microsoft.Azure.Cosmos"</span> Version<span class="op">=</span><span class="st">"3.37.0"</span> <span class="op">/&gt;</span></span>
<span id="cb43-1711"><a href="#cb43-1711" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb43-1712"><a href="#cb43-1712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1713"><a href="#cb43-1713" aria-hidden="true" tabindex="-1"></a>The migration from `WindowsAzure<span class="op">.</span><span class="fu">Storage</span>` to `Azure<span class="op">.</span><span class="fu">Data</span><span class="op">.</span><span class="fu">Tables</span>` <span class="kw">is</span> straightforward and maintains Table API semantics<span class="op">.</span> However<span class="op">,</span> migrating to Cosmos DB provides global distribution<span class="op">,</span> better performance<span class="op">,</span> and additional features<span class="op">.</span></span>
<span id="cb43-1714"><a href="#cb43-1714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1715"><a href="#cb43-1715" aria-hidden="true" tabindex="-1"></a>### Migration Decision Matrix</span>
<span id="cb43-1716"><a href="#cb43-1716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1717"><a href="#cb43-1717" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> Current SDK <span class="op">|</span> Target Service <span class="op">|</span> Recommended Path <span class="op">|</span> Complexity <span class="op">|</span> Benefits <span class="op">|</span></span>
<span id="cb43-1718"><a href="#cb43-1718" aria-hidden="true" tabindex="-1"></a><span class="op">|-------------|----------------|------------------|------------|----------|</span></span>
<span id="cb43-1719"><a href="#cb43-1719" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> <span class="op">**</span>Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">DocumentDB</span><span class="op">**</span> <span class="op">|</span> Cosmos DB SQL <span class="op">|</span> → `Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span>` <span class="op">|</span> Medium <span class="op">|</span> Modern API<span class="op">,</span> Performance<span class="op">,</span> Features <span class="op">|</span></span>
<span id="cb43-1720"><a href="#cb43-1720" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> <span class="op">**</span>Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span><span class="op">.</span><span class="fu">Table</span><span class="op">**</span> <span class="op">|</span> Cosmos DB Table <span class="op">|</span> → `Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span>` <span class="op">|</span> High <span class="op">|</span> Unified SDK<span class="op">,</span> Better Performance <span class="op">|</span></span>
<span id="cb43-1721"><a href="#cb43-1721" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> <span class="op">**</span>Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span><span class="op">.</span><span class="fu">Table</span><span class="op">**</span> <span class="op">|</span> Azure Table Storage <span class="op">|</span> → `Azure<span class="op">.</span><span class="fu">Data</span><span class="op">.</span><span class="fu">Tables</span>` <span class="op">|</span> Low <span class="op">|</span> Modern Table API<span class="op">,</span> Simpler Migration <span class="op">|</span></span>
<span id="cb43-1722"><a href="#cb43-1722" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> <span class="op">**</span>WindowsAzure<span class="op">.</span><span class="fu">Storage</span><span class="op">**</span> <span class="op">|</span> Azure Table Storage <span class="op">|</span> → `Azure<span class="op">.</span><span class="fu">Data</span><span class="op">.</span><span class="fu">Tables</span>` <span class="op">|</span> Low <span class="op">|</span> Modern SDK<span class="op">,</span> Better Performance <span class="op">|</span></span>
<span id="cb43-1723"><a href="#cb43-1723" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> <span class="op">**</span>WindowsAzure<span class="op">.</span><span class="fu">Storage</span><span class="op">**</span> <span class="op">|</span> Cosmos DB <span class="op">|</span> → `Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span>` <span class="op">|</span> High <span class="op">|</span> Global Distribution<span class="op">,</span> Advanced Features <span class="op">|</span></span>
<span id="cb43-1724"><a href="#cb43-1724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1725"><a href="#cb43-1725" aria-hidden="true" tabindex="-1"></a>### Key Migration Considerations</span>
<span id="cb43-1726"><a href="#cb43-1726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1727"><a href="#cb43-1727" aria-hidden="true" tabindex="-1"></a>#### <span class="op">**</span><span class="fl">1.</span> Data Model Changes<span class="op">**</span></span>
<span id="cb43-1728"><a href="#cb43-1728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1729"><a href="#cb43-1729" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Table API → SQL API<span class="op">**:</span> Convert `PartitionKey<span class="op">/</span>RowKey` to composite `id` field</span>
<span id="cb43-1730"><a href="#cb43-1730" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Entity inheritance<span class="op">**:</span> Replace `TableEntity` <span class="kw">base</span> <span class="kw">class</span> with POCO models</span>
<span id="cb43-1731"><a href="#cb43-1731" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Property mapping<span class="op">**:</span> Handle special Table Storage <span class="fu">types</span> <span class="op">(</span><span class="dt">byte</span> arrays<span class="op">,</span> etc<span class="op">.)</span></span>
<span id="cb43-1732"><a href="#cb43-1732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1733"><a href="#cb43-1733" aria-hidden="true" tabindex="-1"></a>#### <span class="op">**</span><span class="fl">2.</span> Performance Implications<span class="op">**</span></span>
<span id="cb43-1734"><a href="#cb43-1734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1735"><a href="#cb43-1735" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Throughput provisioning<span class="op">**:</span> Cosmos DB uses RU<span class="op">/</span>s instead of storage<span class="op">-</span>based pricing</span>
<span id="cb43-1736"><a href="#cb43-1736" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Indexing<span class="op">**:</span> SQL API provides richer indexing than Table API</span>
<span id="cb43-1737"><a href="#cb43-1737" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Query patterns<span class="op">**:</span> SQL queries vs Table queries have different performance characteristics</span>
<span id="cb43-1738"><a href="#cb43-1738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1739"><a href="#cb43-1739" aria-hidden="true" tabindex="-1"></a>#### <span class="op">**</span><span class="fl">3.</span> Feature Migration<span class="op">**</span></span>
<span id="cb43-1740"><a href="#cb43-1740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1741"><a href="#cb43-1741" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Authentication<span class="op">**:</span> Migrate from connection strings to AAD<span class="op">/</span>Managed Identity</span>
<span id="cb43-1742"><a href="#cb43-1742" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Error handling<span class="op">**:</span> Update exception handling <span class="kw">for</span> <span class="kw">new</span> exception types</span>
<span id="cb43-1743"><a href="#cb43-1743" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Batch operations<span class="op">**:</span> Leverage bulk operations <span class="kw">in</span> modern SDKs</span>
<span id="cb43-1744"><a href="#cb43-1744" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Monitoring<span class="op">**:</span> Implement RU consumption monitoring</span>
<span id="cb43-1745"><a href="#cb43-1745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1746"><a href="#cb43-1746" aria-hidden="true" tabindex="-1"></a>### Migration Benefits</span>
<span id="cb43-1747"><a href="#cb43-1747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1748"><a href="#cb43-1748" aria-hidden="true" tabindex="-1"></a>Moving to `Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span>` provides<span class="op">:</span></span>
<span id="cb43-1749"><a href="#cb43-1749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1750"><a href="#cb43-1750" aria-hidden="true" tabindex="-1"></a>✅ <span class="op">**</span>Unified Experience<span class="op">**</span> <span class="op">-</span> Single SDK <span class="kw">for</span> all Cosmos DB APIs  </span>
<span id="cb43-1751"><a href="#cb43-1751" aria-hidden="true" tabindex="-1"></a>✅ <span class="op">**</span>Better Performance<span class="op">**</span> <span class="op">-</span> Optimized <span class="kw">for</span> modern async patterns  </span>
<span id="cb43-1752"><a href="#cb43-1752" aria-hidden="true" tabindex="-1"></a>✅ <span class="op">**</span>Advanced Features<span class="op">**</span> <span class="op">-</span> Bulk operations<span class="op">,</span> change feed<span class="op">,</span> global distribution  </span>
<span id="cb43-1753"><a href="#cb43-1753" aria-hidden="true" tabindex="-1"></a>✅ <span class="op">**</span>Enhanced Authentication<span class="op">**</span> <span class="op">-</span> AAD<span class="op">,</span> Managed Identity<span class="op">,</span> fine<span class="op">-</span>grained access  </span>
<span id="cb43-1754"><a href="#cb43-1754" aria-hidden="true" tabindex="-1"></a>✅ <span class="op">**</span>Rich Diagnostics<span class="op">**</span> <span class="op">-</span> Detailed metrics and performance insights  </span>
<span id="cb43-1755"><a href="#cb43-1755" aria-hidden="true" tabindex="-1"></a>✅ <span class="op">**</span>Future<span class="op">-</span>Proof<span class="op">**</span> <span class="op">-</span> Active development and <span class="kw">new</span> feature support  </span>
<span id="cb43-1756"><a href="#cb43-1756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1757"><a href="#cb43-1757" aria-hidden="true" tabindex="-1"></a>### Support Timeline</span>
<span id="cb43-1758"><a href="#cb43-1758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1759"><a href="#cb43-1759" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> SDK <span class="op">|</span> Final Version <span class="op">|</span> End of Support <span class="op">|</span> Security Updates <span class="op">|</span> Recommendation <span class="op">|</span></span>
<span id="cb43-1760"><a href="#cb43-1760" aria-hidden="true" tabindex="-1"></a><span class="op">|-----|---------------|----------------|------------------|----------------|</span></span>
<span id="cb43-1761"><a href="#cb43-1761" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> `Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">DocumentDB</span>` <span class="op">|</span> <span class="dv">2</span><span class="op">.</span><span class="fu">18</span><span class="fl">.0</span> <span class="op">|</span> March <span class="dv">2020</span> <span class="op">|</span> ❌ None <span class="op">|</span> ⚠️ Migrate immediately <span class="op">|</span></span>
<span id="cb43-1762"><a href="#cb43-1762" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> `Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span><span class="op">.</span><span class="fu">Table</span>` <span class="op">|</span> <span class="dv">1</span><span class="op">.</span><span class="fu">0</span><span class="fl">.8</span> <span class="op">|</span> August <span class="dv">2021</span> <span class="op">|</span> ❌ None <span class="op">|</span> ⚠️ Migrate immediately <span class="op">|</span></span>
<span id="cb43-1763"><a href="#cb43-1763" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> `WindowsAzure<span class="op">.</span><span class="fu">Storage</span>` <span class="op">|</span> <span class="dv">9</span><span class="op">.</span><span class="fu">3</span><span class="fl">.3</span> <span class="op">|</span> November <span class="dv">2023</span> <span class="op">|</span> ❌ None <span class="op">|</span> ⚠️ Migrate immediately <span class="op">|</span></span>
<span id="cb43-1764"><a href="#cb43-1764" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> `Azure<span class="op">.</span><span class="fu">Data</span><span class="op">.</span><span class="fu">Tables</span>` <span class="op">|</span> Current <span class="op">|</span> ✅ Active <span class="op">|</span> ✅ Yes <span class="op">|</span> ✅ Use <span class="kw">for</span> Table Storage <span class="op">|</span></span>
<span id="cb43-1765"><a href="#cb43-1765" aria-hidden="true" tabindex="-1"></a><span class="op">|</span> `Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span>` <span class="op">|</span> Current <span class="op">|</span> ✅ Active <span class="op">|</span> ✅ Yes <span class="op">|</span> ✅ Use <span class="kw">for</span> Cosmos DB <span class="op">|</span></span>
<span id="cb43-1766"><a href="#cb43-1766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1767"><a href="#cb43-1767" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> <span class="op">**</span>⚠️ Important<span class="op">**:</span> Microsoft will not provide security updates or bug fixes <span class="kw">for</span> legacy SDKs<span class="op">.</span> Migration to `Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span>` <span class="kw">is</span> strongly recommended <span class="kw">for</span> security and compatibility reasons<span class="op">.</span></span>
<span id="cb43-1768"><a href="#cb43-1768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1769"><a href="#cb43-1769" aria-hidden="true" tabindex="-1"></a>## Useful Resources</span>
<span id="cb43-1770"><a href="#cb43-1770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1771"><a href="#cb43-1771" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Official Documentation<span class="op">**:</span> <span class="op">[</span>Azure Cosmos DB Documentation<span class="op">](</span>https<span class="op">:</span><span class="co">//learn.microsoft.com/en-us/azure/cosmos-db/)&lt;br&gt;</span></span>
<span id="cb43-1772"><a href="#cb43-1772" aria-hidden="true" tabindex="-1"></a>  Comprehensive documentation covering Azure Cosmos DB concepts<span class="op">,</span> capabilities<span class="op">,</span> APIs<span class="op">,</span> and service<span class="op">-</span>level features<span class="op">.</span> Essential <span class="kw">for</span> understanding provisioning models<span class="op">,</span> consistency levels<span class="op">,</span> indexing policies<span class="op">,</span> and architectural considerations <span class="kw">for</span> designing Cosmos DB solutions<span class="op">.</span></span>
<span id="cb43-1773"><a href="#cb43-1773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1774"><a href="#cb43-1774" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>SDK Reference<span class="op">**:</span> <span class="op">[</span>Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span> SDK Reference<span class="op">](</span>https<span class="op">:</span><span class="co">//learn.microsoft.com/en-us/dotnet/api/microsoft.azure.cosmos)&lt;br&gt;</span></span>
<span id="cb43-1775"><a href="#cb43-1775" aria-hidden="true" tabindex="-1"></a>  Complete API reference documentation <span class="kw">for</span> the Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span> SDK<span class="op">,</span> including all classes<span class="op">,</span> methods<span class="op">,</span> properties<span class="op">,</span> and their signatures<span class="op">.</span> Critical development resource <span class="kw">for</span> understanding method parameters<span class="op">,</span> <span class="kw">return</span> types<span class="op">,</span> exceptions<span class="op">,</span> and proper usage patterns when writing Cosmos DB applications<span class="op">.</span></span>
<span id="cb43-1776"><a href="#cb43-1776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1777"><a href="#cb43-1777" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Code Samples<span class="op">**:</span> <span class="op">[</span>Azure Cosmos DB <span class="op">.</span><span class="fu">NET</span> SDK Samples<span class="op">](</span>https<span class="op">:</span><span class="co">//github.com/Azure/azure-cosmos-dotnet-v3/tree/master/Microsoft.Azure.Cosmos.Samples)&lt;br&gt;</span></span>
<span id="cb43-1778"><a href="#cb43-1778" aria-hidden="true" tabindex="-1"></a>  Official code samples demonstrating real<span class="op">-</span>world implementation patterns<span class="op">,</span> performance optimization techniques<span class="op">,</span> and advanced scenarios like change feed processing and bulk operations<span class="op">.</span> Provides practical examples of best practices<span class="op">,</span> error handling<span class="op">,</span> and common use cases<span class="op">.</span></span>
<span id="cb43-1779"><a href="#cb43-1779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1780"><a href="#cb43-1780" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Performance Tips<span class="op">**:</span> <span class="op">[</span>Performance Tips <span class="kw">for</span> Azure Cosmos DB<span class="op">](</span>https<span class="op">:</span><span class="co">//learn.microsoft.com/en-us/azure/cosmos-db/nosql/performance-tips-dotnet-sdk)&lt;br&gt;</span></span>
<span id="cb43-1781"><a href="#cb43-1781" aria-hidden="true" tabindex="-1"></a>  Expert guidance on optimizing your applications <span class="kw">for</span> maximum performance and cost<span class="op">-</span>efficiency with Azure Cosmos DB<span class="op">,</span> including connection management<span class="op">,</span> query optimization<span class="op">,</span> indexing strategies<span class="op">,</span> and RU optimization techniques to ensure your applications run efficiently<span class="op">.</span></span>
<span id="cb43-1782"><a href="#cb43-1782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1783"><a href="#cb43-1783" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> <span class="op">**</span>Migration Guide<span class="op">**:</span> <span class="op">[</span>Migrating from DocumentDB SDK to Cosmos DB SDK<span class="op">](</span>https<span class="op">:</span><span class="co">//github.com/Azure/azure-cosmos-dotnet-v3/blob/master/Microsoft.Azure.Cosmos/MIGRATE.md)&lt;br&gt;</span></span>
<span id="cb43-1784"><a href="#cb43-1784" aria-hidden="true" tabindex="-1"></a>  Detailed migration guide <span class="kw">for</span> transitioning from the legacy Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">DocumentDB</span> SDK to the modern Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span> SDK<span class="op">,</span> with code comparisons<span class="op">,</span> breaking change explanations<span class="op">,</span> and step<span class="op">-</span>by<span class="op">-</span>step migration strategies<span class="op">.</span></span>
<span id="cb43-1785"><a href="#cb43-1785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1786"><a href="#cb43-1786" aria-hidden="true" tabindex="-1"></a>## Summary</span>
<span id="cb43-1787"><a href="#cb43-1787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1788"><a href="#cb43-1788" aria-hidden="true" tabindex="-1"></a>The <span class="op">**</span>Microsoft<span class="op">.</span><span class="fu">Azure</span><span class="op">.</span><span class="fu">Cosmos</span><span class="op">**</span> SDK <span class="kw">is</span> the recommended approach <span class="kw">for</span> accessing Azure Cosmos DB from C#<span class="op">.</span> It provides<span class="op">:</span></span>
<span id="cb43-1789"><a href="#cb43-1789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1790"><a href="#cb43-1790" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> ✅ Modern async<span class="op">/</span>await patterns <span class="kw">for</span> responsive applications</span>
<span id="cb43-1791"><a href="#cb43-1791" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> ✅ Comprehensive support <span class="kw">for</span> all Cosmos DB SQL API features</span>
<span id="cb43-1792"><a href="#cb43-1792" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> ✅ Better performance and throughput optimization</span>
<span id="cb43-1793"><a href="#cb43-1793" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> ✅ Built<span class="op">-</span><span class="kw">in</span> retry logic and error handling</span>
<span id="cb43-1794"><a href="#cb43-1794" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> ✅ Support <span class="kw">for</span> AAD and managed identity authentication</span>
<span id="cb43-1795"><a href="#cb43-1795" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> ✅ Rich diagnostic information <span class="kw">for</span> monitoring and troubleshooting</span>
<span id="cb43-1796"><a href="#cb43-1796" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> ✅ Optimized bulk operations <span class="kw">for</span> high<span class="op">-</span>throughput scenarios</span>
<span id="cb43-1797"><a href="#cb43-1797" aria-hidden="true" tabindex="-1"></a><span class="op">-</span> ✅ Simplified change feed processing</span>
<span id="cb43-1798"><a href="#cb43-1798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1799"><a href="#cb43-1799" aria-hidden="true" tabindex="-1"></a>Azure Cosmos DB offers a globally distributed<span class="op">,</span> multi<span class="op">-</span>model database service with comprehensive SLAs <span class="kw">for</span> throughput<span class="op">,</span> latency<span class="op">,</span> availability<span class="op">,</span> and consistency<span class="op">,</span> making it ideal <span class="kw">for</span> modern cloud applications requiring global scale and low latency<span class="op">.</span></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Built with <a href="https://quarto.org/">Quarto</a> by Dario Airoldi</p>
</div>   
    <div class="nav-footer-center">
<p>Learning Journey - Technical Notes &amp; Insights</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/darioairoldi/Learn/edit/main/20250706 CosmosDB Access options/README.md" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/darioairoldi/Learn/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Last updated: <strong>?meta:date</strong></p>
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>